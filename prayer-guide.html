  <div id="gps-alert" style="display:none;position:fixed;top:0;left:0;right:0;z-index:2000;background:#ffd700;color:#222;padding:16px 0;text-align:center;font-weight:700;font-size:1.1em;box-shadow:0 2px 12px #0002;transition:opacity 0.3s;opacity:0;">
    <span id="gps-alert-msg">يرجى تفعيل GPS والسماح بالوصول للموقع لتعمل خدمة القبلة والمواقيت بشكل صحيح.</span>
  </div>
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>دليل الصلاة التفاعلي</title>
  <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    /* قواعد responsive أساسية لجميع الأجهزة */
    html, body {
      max-width: 100vw;
      overflow-x: hidden;
    }
    @media (max-width: 600px) {
      body {
        font-size: 15px;
      }
      .container {
        padding: 5px !important;
      }
      .hero-card, .card {
        padding: 10px !important;
      }
      h1, h2, h3 {
        font-size: 1.2em !important;
      }
    }
    :root {
      --primary-gold: linear-gradient(135deg, #ffd700 0%, #ffb347 100%);
      --secondary-gold: linear-gradient(135deg, #ffb347 0%, #ffa500 100%);
      --dark-gold: linear-gradient(135deg, #daa520 0%, #b8860b 100%);
      --light-gold: linear-gradient(135deg, #fff8dc 0%, #fffacd 100%);
      --dark-bg: #1a1a1a;
      --darker-bg: #0f0f0f;
      --card-bg: rgba(255, 215, 0, 0.1);
      --text-light: #ffffff;
      --text-gold: #ffd700;
      --accent: #ff6b35;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Cairo', sans-serif;
      background: var(--darker-bg);
      background-image: 
        radial-gradient(circle at 20% 50%, rgba(255, 215, 0, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(255, 179, 71, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 80%, rgba(218, 165, 32, 0.1) 0%, transparent 50%);
      color: var(--text-light);
      overflow-x: hidden;
      min-height: 100vh;
    }

    .header {
      background: rgba(26, 26, 26, 0.95);
      backdrop-filter: blur(20px);
      padding: 15px 0;
      position: fixed;
      width: 100%;
      top: 0;
      z-index: 1000;
      box-shadow: 0 8px 32px rgba(255, 215, 0, 0.2);
      border-bottom: 2px solid rgba(255, 215, 0, 0.3);
    }

    .nav-container {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 20px;
    }

    .logo {
      font-family: 'Amiri', serif;
      font-size: 28px;
      font-weight: 700;
      background: var(--primary-gold);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
    }

    .nav-tabs {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .nav-tab {
      padding: 12px 18px;
      background: rgba(255, 215, 0, 0.1);
      border: 2px solid rgba(255, 215, 0, 0.3);
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Cairo', sans-serif;
      font-weight: 600;
      color: var(--text-gold);
      backdrop-filter: blur(10px);
      font-size: 14px;
    }

    .nav-tab:hover, .nav-tab.active {
      background: var(--primary-gold);
      color: var(--darker-bg);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
      border-color: #ffd700;
    }

    .menu-toggle {
      display: none;
      background: rgba(255, 215, 0, 0.1);
      border: 2px solid rgba(255, 215, 0, 0.3);
      border-radius: 10px;
      color: var(--text-gold);
      font-size: 18px;
      padding: 10px 12px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .menu-toggle:hover {
      background: var(--primary-gold);
      color: var(--darker-bg);
    }

    .container {
      max-width: 1200px;
      margin: 100px auto 60px;
      padding: 0 20px;
    }

    .tab-content {
      display: none;
      animation: fadeInUp 0.6s ease;
    }

    .tab-content.active {
      display: block;
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .hero-card {
      background: rgba(26, 26, 26, 0.8);
      backdrop-filter: blur(20px);
      border-radius: 25px;
      padding: 40px;
      margin-bottom: 30px;
      box-shadow: 0 20px 60px rgba(255, 215, 0, 0.1);
      border: 2px solid rgba(255, 215, 0, 0.3);
      position: relative;
      overflow: hidden;
    }

    .hero-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--primary-gold);
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 25px;
      margin-bottom: 30px;
    }

    .card {
      background: rgba(26, 26, 26, 0.8);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
      border: 2px solid rgba(255, 215, 0, 0.3);
      position: relative;
      overflow: hidden;
    }

    .card:hover {
      transform: translateY(-10px);
      box-shadow: 0 25px 50px rgba(255, 215, 0, 0.2);
      border-color: #ffd700;
    }

    .card-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--primary-gold);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 20px;
      color: var(--darker-bg);
      font-size: 24px;
      box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
    }

    .card-title {
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 15px;
      color: var(--text-gold);
    }

    .step-list {
      list-style: none;
      padding: 0;
    }

    .step-item {
      display: flex;
      align-items: center;
      padding: 15px;
      margin-bottom: 10px;
      background: rgba(255, 215, 0, 0.1);
      border-radius: 15px;
      transition: all 0.3s ease;
      cursor: pointer;
      border-right: 4px solid #ffd700;
    }

    .step-item:hover, .step-item.active {
      background: rgba(255, 215, 0, 0.2);
      transform: translateX(-10px);
      box-shadow: 0 5px 20px rgba(255, 215, 0, 0.2);
    }

    .step-number {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: var(--primary-gold);
      color: var(--darker-bg);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-left: 15px;
      font-weight: 700;
    }

    .prayer-times {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }

    .prayer-time {
      background: rgba(26, 26, 26, 0.8);
      backdrop-filter: blur(15px);
      padding: 20px;
      border-radius: 15px;
      text-align: center;
      transition: all 0.3s ease;
      border: 2px solid rgba(255, 215, 0, 0.3);
    }

    .prayer-time:hover, .prayer-time.current {
      border-color: #ffd700;
      transform: scale(1.05);
      box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
    }

    .prayer-time.current {
      background: var(--primary-gold);
      color: var(--darker-bg);
    }

    .prayer-name {
      font-weight: 700;
      font-size: 16px;
      margin-bottom: 10px;
    }

    .prayer-time-value {
      font-size: 20px;
      font-weight: 700;
      font-family: 'Amiri', serif;
    }

    .qibla-compass {
      width: 200px;
      height: 200px;
      margin: 30px auto;
      position: relative;
      background: conic-gradient(from 0deg, #ffd700, #ffb347, #ffd700);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      animation: rotate 20s linear infinite;
      box-shadow: 0 0 50px rgba(255, 215, 0, 0.3);
    }

    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .compass-inner {
      width: 160px;
      height: 160px;
      background: var(--darker-bg);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      box-shadow: inset 0 0 30px rgba(255, 215, 0, 0.2);
      border: 2px solid rgba(255, 215, 0, 0.5);
    }

    .compass-needle {
      width: 4px;
      height: 60px;
      background: linear-gradient(to top, #ff6b35, #ffd700);
      border-radius: 2px;
      position: absolute;
      top: 50px;
      transform-origin: bottom center;
    }

    .dua-card {
      background: rgba(26, 26, 26, 0.8);
      border: 2px solid rgba(255, 215, 0, 0.5);
      border-radius: 20px;
      padding: 25px;
      margin-bottom: 20px;
      position: relative;
      transition: all 0.3s ease;
    }

    .dua-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(255, 215, 0, 0.2);
      border-color: #ffd700;
    }

    .dua-text {
      font-family: 'Amiri', serif;
      font-size: 18px;
      line-height: 1.8;
      text-align: center;
      margin-bottom: 15px;
      color: var(--text-light);
    }

    .audio-controls {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .audio-btn {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--primary-gold);
      border: none;
      color: var(--darker-bg);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      font-size: 18px;
      position: relative;
    }

    .audio-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
    }

    .progress-circle {
      width: 100px;
      height: 100px;
      margin: 20px auto;
      position: relative;
    }

    .progress-ring {
      transform: rotate(-90deg);
    }

    .progress-ring-circle {
      stroke: rgba(255, 215, 0, 0.3);
      stroke-width: 8;
      fill: transparent;
      r: 40;
      cx: 50;
      cy: 50;
    }

    .progress-ring-fill {
      stroke: #ffd700;
      stroke-width: 8;
      fill: transparent;
      r: 40;
      cx: 50;
      cy: 50;
      stroke-dasharray: 251.2;
      stroke-dashoffset: 251.2;
      transition: stroke-dashoffset 0.5s ease;
    }

    .floating-action {
      position: fixed;
      bottom: 30px;
      left: 30px;
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background: var(--primary-gold);
      border: none;
      color: var(--darker-bg);
      font-size: 24px;
      cursor: pointer;
      box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
      transition: all 0.3s ease;
      z-index: 1000;
    }

    .floating-action:hover {
      transform: scale(1.1) rotate(15deg);
      box-shadow: 0 12px 35px rgba(255, 215, 0, 0.6);
    }


    .counter-badge {
      position: absolute;
      top: -10px;
      right: -10px;
      background: #ff6b35;
      color: white;
      border-radius: 50%;
      width: 25px;
      height: 25px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 700;
    }

    .adhan-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .sheikh-card {
      background: rgba(26, 26, 26, 0.8);
      border: 2px solid rgba(255, 215, 0, 0.3);
      border-radius: 20px;
      padding: 25px;
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .sheikh-card:hover {
      transform: translateY(-5px);
      border-color: #ffd700;
      box-shadow: 0 15px 40px rgba(255, 215, 0, 0.2);
    }

    .sheikh-image {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background: var(--primary-gold);
      margin: 0 auto 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 25px;
      color: var(--darker-bg);
    }

    .sheikh-name {
      font-size: 16px;
      font-weight: 700;
      color: var(--text-gold);
      margin-bottom: 10px;
    }

    .sheikh-description {
      font-size: 13px;
      color: var(--text-light);
      opacity: 0.8;
      margin-bottom: 15px;
    }

    .language-section {
      background: rgba(26, 26, 26, 0.8);
      backdrop-filter: blur(20px);
      border-radius: 25px;
      padding: 40px;
      margin-bottom: 30px;
      box-shadow: 0 20px 60px rgba(255, 215, 0, 0.1);
      border: 2px solid rgba(255, 215, 0, 0.3);
      text-align: center;
    }

    .language-toggle {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 30px;
      flex-wrap: wrap;
    }

    .lang-btn {
      padding: 15px 30px;
      background: rgba(255, 215, 0, 0.1);
      border: 2px solid rgba(255, 215, 0, 0.3);
      border-radius: 25px;
      color: var(--text-gold);
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 16px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .lang-btn.active, .lang-btn:hover {
      background: var(--primary-gold);
      color: var(--darker-bg);
      border-color: #ffd700;
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
    }

    .footer {
      background: rgba(26, 26, 26, 0.95);
      backdrop-filter: blur(20px);
      padding: 30px 0;
      text-align: center;
      border-top: 2px solid rgba(255, 215, 0, 0.3);
      margin-top: 50px;
    }

    .footer-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    .developer-info {
      color: var(--text-gold);
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .copyright {
      color: var(--text-light);
      opacity: 0.8;
      font-size: 14px;
    }

    .floating-shape {
      position: absolute;
      background: rgba(255, 215, 0, 0.1);
      border-radius: 50%;
      animation: float 15s ease-in-out infinite;
    }

    .floating-shape:nth-child(1) { width: 60px; height: 60px; top: 20%; right: 10%; animation-delay: 0s; }
    .floating-shape:nth-child(2) { width: 40px; height: 40px; top: 60%; right: 80%; animation-delay: 3s; }
    .floating-shape:nth-child(3) { width: 80px; height: 80px; top: 80%; right: 20%; animation-delay: 6s; }

    @keyframes float {
      0%, 100% { transform: translate(0, 0) rotate(0deg); }
      33% { transform: translate(30px, -30px) rotate(120deg); }
      66% { transform: translate(-20px, 20px) rotate(240deg); }
    }

    .active-playing {
      animation: pulse 1s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .settings-section {
      margin-bottom: 30px;
      padding: 20px;
      background: rgba(255, 215, 0, 0.05);
      border-radius: 15px;
      border: 1px solid rgba(255, 215, 0, 0.2);
    }

    .settings-section h3 {
      color: var(--text-gold);
      margin-bottom: 15px;
      font-size: 18px;
    }

    .control-group {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      align-items: center;
      justify-content: center;
      margin-bottom: 15px;
    }

    .control-group label {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--text-light);
      font-size: 14px;
    }

    .control-group select,
    .control-group input[type="range"] {
      padding: 8px 12px;
      border-radius: 8px;
      border: 2px solid rgba(255, 215, 0, 0.3);
      background: rgba(26, 26, 26, 0.8);
      color: var(--text-light);
      font-size: 14px;
    }

    .control-group input[type="range"] {
      width: 100px;
    }

    .range-value {
      background: var(--primary-gold);
      color: var(--darker-bg);
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      min-width: 35px;
      text-align: center;
    }

    /* تحسينات للأجهزة المحمولة */
    @media (max-width: 768px) {
      .nav-tabs { 
        display: none;
      }
      
      .menu-toggle {
        display: block;
      }
      
      .nav-tabs.mobile-show {
        display: flex;
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: rgba(26, 26, 26, 0.98);
        backdrop-filter: blur(20px);
        flex-direction: column;
        padding: 20px;
        gap: 10px;
        border-top: 2px solid rgba(255, 215, 0, 0.3);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      }
      
      .nav-tab { 
        padding: 15px 20px; 
        font-size: 16px;
        justify-content: center;
        width: 100%;
      }
      
      .hero-card { 
        padding: 25px;
        margin-bottom: 20px;
      }
      
      .grid { 
        grid-template-columns: 1fr;
        gap: 15px;
      }
      
      .qibla-compass { 
        width: 180px; 
        height: 180px; 
      }
      
      .compass-inner { 
        width: 140px; 
        height: 140px; 
      }
      
      .compass-needle {
        height: 50px;
        top: 45px;
      }
      
      .container {
        margin-top: 90px;
        padding: 0 15px;
      }
      
      .prayer-times {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
      }
      
      .prayer-time {
        padding: 15px 10px;
      }
      
      .prayer-name {
        font-size: 14px;
      }
      
      .prayer-time-value {
        font-size: 18px;
      }
      
      .adhan-section {
        grid-template-columns: 1fr;
        gap: 15px;
      }
      
      .sheikh-card {
        padding: 20px;
      }
      
      .sheikh-image {
        width: 60px;
        height: 60px;
        font-size: 20px;
      }
      
      .sheikh-name {
        font-size: 15px;
      }
      
      .sheikh-description {
        font-size: 12px;
      }
      
      .dua-text {
        font-size: 16px;
      }
      
      .language-toggle {
        flex-direction: column;
        gap: 15px;
        align-items: center;
      }
      
      .lang-btn {
        width: 100%;
        max-width: 250px;
        justify-content: center;
      }
      
      .floating-action {
        bottom: 20px;
        left: 20px;
        width: 60px;
        height: 60px;
        font-size: 20px;
      }
      
      
      .step-item {
        padding: 12px;
        font-size: 14px;
      }
      
      .step-number {
        width: 25px;
        height: 25px;
        font-size: 12px;
        margin-left: 10px;
      }
      
      .card-title {
        font-size: 18px;
      }
      
      .card {
        padding: 20px;
      }
      
      .card-icon {
        width: 50px;
        height: 50px;
        font-size: 20px;
      }

      .control-group {
        flex-direction: column;
        align-items: stretch;
      }

      .control-group label {
        justify-content: space-between;
      }
    }

    @media (max-width: 480px) {
      .logo {
        font-size: 20px;
      }
      
      .hero-card {
        padding: 15px;
      }
      
      .card {
        padding: 15px;
      }
      
      .qibla-compass {
        width: 150px;
        height: 150px;
      }
      
      .compass-inner {
        width: 120px;
        height: 120px;
      }
      
      .dua-text {
        font-size: 14px;
      }
      
      .audio-btn {
        width: 40px;
        height: 40px;
        font-size: 16px;
      }
      
      .progress-circle {
        width: 80px;
        height: 80px;
      }
      
      .floating-shape {
        display: none;
      }
    }

    /* تحسينات للأجهزة اللوحية */
    @media (min-width: 769px) and (max-width: 1024px) {
      .grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .adhan-section {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .prayer-times {
        grid-template-columns: repeat(3, 1fr);
      }
      
      .container {
        padding: 0 25px;
      }
    }

    /* تحسينات للشاشات الكبيرة */
    @media (min-width: 1200px) {
      .grid {
        grid-template-columns: repeat(3, 1fr);
      }
      
      .adhan-section {
        grid-template-columns: repeat(3, 1fr);
      }
      
      .prayer-times {
        grid-template-columns: repeat(6, 1fr);
      }
      
      .container {
        padding: 0 40px;
      }
    }
  </style>
</head>

<body>
  <div class="floating-shape"></div>
  <div class="floating-shape"></div>
  <div class="floating-shape"></div>

  <header class="header">
    <div class="nav-container">
      <div class="logo">
        <i class="fas fa-mosque"></i>
        دليل الصلاة التفاعلي
      </div>
      <button class="menu-toggle" onclick="toggleMobileMenu()">
        <i class="fas fa-bars"></i>
      </button>
      <div class="nav-tabs" id="nav-tabs">
        <!-- ...باقي أزرار التبويب... -->
        <button class="nav-tab active" onclick="showTab('home')">
          <i class="fas fa-home"></i> الرئيسية
        </button>
        <button class="nav-tab" onclick="toggleFullscreen()" title="ملء الشاشة">
          <i class="fas fa-expand"></i> ملء الشاشة
        </button>
        <button class="nav-tab" onclick="showTab('wudu')">
          <i class="fas fa-hand-sparkles"></i> الوضوء
        </button>
        <button class="nav-tab" onclick="showTab('prayer')">
          <i class="fas fa-praying-hands"></i> الصلاة
        </button>
        <button class="nav-tab" onclick="showTab('qibla')">
          <i class="fas fa-compass"></i> القبلة
        </button>
        <button class="nav-tab" onclick="showTab('madhahib')">
          <i class="fas fa-balance-scale"></i> المذاهب
        </button>
        <button class="nav-tab" onclick="showTab('adhan')">
          <i class="fas fa-bullhorn"></i> الأذان
        </button>
        <button class="nav-tab" onclick="showTab('stories')">
          <i class="fas fa-book-reader"></i> قصص عن الصلاة
        </button>
        <button class="nav-tab" onclick="showTab('settings')">
          <i class="fas fa-cog"></i> الإعدادات
        </button>
        <a class="nav-tab" href="index.html" style="text-decoration:none;">
          <i class="fas fa-arrow-right"></i> العودة
        </a>
      </div>
    </div>
  </header>

  <div class="container">
    <!-- قسم المذاهب -->
    <div id="madhahib" class="tab-content">
      <div class="hero-card">
        <div id="speakable-madhahib" style="cursor:pointer; background:#000000; padding:10px; border-radius:8px;" title="اضغط للاستماع للنص">
          <h2 style="color:var(--text-gold);text-align:center;margin-bottom:18px;">الصلاة في المذاهب الأربعة</h2>
          <p style="font-size:1.1em;line-height:2;text-align:center;max-width:700px;margin:auto;color:#ffd700cc;">
            الفرق بين الصلاة في المذاهب الأربعة (الحنفي، المالكي، الشافعي، والحنبلي) هو في بعض التفاصيل الفقهية، وليس في أصل الصلاة، فجميع المذاهب تتفق على أركان الصلاة الأساسية (النية، تكبيرة الإحرام، القراءة، الركوع، السجود، إلخ)، وتختلف فقط في بعض الصفات والهيئات.
          </p>
        </div>
        <div style="display: flex; justify-content: center; gap: 16px; margin-top: 12px;">
          <button id="play-madhahib-btn" style="background: #ffd700; color: #222; border: none; border-radius: 8px; padding: 8px 22px; font-weight: bold; font-size: 1em; cursor: pointer;">تشغيل الصوت</button>
          <button id="stop-madhahib-btn" style="background: #333; color: #ffd700; border: 1px solid #ffd700; border-radius: 8px; padding: 8px 22px; font-weight: bold; font-size: 1em; cursor: pointer;">إيقاف الصوت</button>
        </div>
        <script>
  // زر ملء الشاشة
  function toggleFullscreen() {
    if (!document.fullscreenElement && !document.webkitFullscreenElement) {
      var docElm = document.documentElement;
      if (docElm.requestFullscreen) {
        docElm.requestFullscreen();
      } else if (docElm.webkitRequestFullscreen) {
        docElm.webkitRequestFullscreen();
      }
    } else {
      if (document.exitFullscreen) {
        document.exitFullscreen();
      } else if (document.webkitExitFullscreen) {
        document.webkitExitFullscreen();
      }
    }
  }
        var madhahibUtterance;
        document.getElementById('speakable-madhahib').onclick = function() {
          var text = this.innerText;
          madhahibUtterance = new (window.SpeechSynthesisUtterance || window.webkitSpeechSynthesisUtterance)(text);
          madhahibUtterance.lang = 'ar-SA';
          window.speechSynthesis.speak(madhahibUtterance);
        };
        document.getElementById('play-madhahib-btn').onclick = function() {
          var text = document.getElementById('speakable-madhahib').innerText;
          madhahibUtterance = new (window.SpeechSynthesisUtterance || window.webkitSpeechSynthesisUtterance)(text);
          madhahibUtterance.lang = 'ar-SA';
          window.speechSynthesis.speak(madhahibUtterance);
        };
        document.getElementById('stop-madhahib-btn').onclick = function() {
          window.speechSynthesis.cancel();
        };
        </script>
      </div>
      <div style="display: flex; justify-content: center; margin-top: 24px;">
        <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
          <div style="position: relative; padding-bottom: 56.25%; height: 0;">
            <iframe src="https://www.youtube.com/embed/bhsNo_dgyPM?si=lLWW7VZCbDHOamUR" title="الفرق بين المذاهب الأربعة الشافعي ومالك وأبو حنيفة وبن حنبل" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
          </div>
          <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">الفرق بين المذاهب الأربعة الشافعي ومالك وأبو حنيفة وبن حنبل</div>
        </div>
      </div>

      <!-- جدول الفروقات بين المذاهب الأربعة -->
      <div id="speakable-madhahib-table" style="margin: 32px auto 0; max-width: 800px; background: #222; border-radius: 16px; box-shadow: 0 4px 16px #ffd70033; border: 2px solid #ffd700; padding: 24px 12px; cursor:pointer;" title="اضغط للاستماع للجدول">
        <h3 style="color: var(--text-gold); text-align: right; margin-bottom: 18px;">إليك أهم الفروقات في الصلاة بين المذاهب الأربعة:</h3>
        <style>
          .madhahib-table { width: 100%; border-collapse: collapse; margin-bottom: 18px; direction: rtl; }
          .madhahib-table th, .madhahib-table td { border: 1px solid #ffd70099; padding: 8px 6px; text-align: center; color: #ffd700; background: #222; font-size: 1em; }
          .madhahib-table th { background: #333; color: #fffbe6; font-weight: bold; }
          .madhahib-table tr:nth-child(even) { background: #232323; }
          .madhahib-table .section-title { background: #ffd70022; color: #ffeb99; font-weight: bold; text-align: right; }
        </style>
        <table class="madhahib-table">
          <tr class="section-title"><td colspan="5"> 1. تكبيرة الإحرام ورفع اليدين</td></tr>
          <tr><th>المسألة</th><th>الحنفي</th><th>المالكي</th><th>الشافعي</th><th>الحنبلي</th></tr>
          <tr><td>رفع اليدين</td><td>عند تكبيرة الإحرام فقط</td><td>عند التكبيرة فقط</td><td>عند التكبيرة، والركوع، والرفع منه</td><td>عند التكبيرة، والركوع، والرفع منه</td></tr>
          <tr><td>موضع اليدين</td><td>تحت السرّة</td><td>لا يُشدّان، ويُرسلهما بعد التكبيرة</td><td>على الصدر</td><td>على الصدر</td></tr>
          <tr class="section-title"><td colspan="5"> 2. قراءة الفاتحة وما بعدها</td></tr>
          <tr><th>المسألة</th><th>الحنفي</th><th>المالكي</th><th>الشافعي</th><th>الحنبلي</th></tr>
          <tr><td>قراءة الفاتحة للمأموم</td><td>لا يقرأ خلف الإمام</td><td>لا يقرأ خلف الإمام في الجهرية</td><td>يقرأ الفاتحة في كل ركعة</td><td>يقرأ الفاتحة في كل ركعة</td></tr>
          <tr><td>السورة بعد الفاتحة</td><td>في الركعتين الأوليين</td><td>مستحبة في الأوليين</td><td>في الأوليين</td><td>في الأوليين</td></tr>
          <tr class="section-title"><td colspan="5"> 3. قول "آمين" بعد الفاتحة</td></tr>
          <tr><th>المسألة</th><th>الحنفي</th><th>المالكي</th><th>الشافعي</th><th>الحنبلي</th></tr>
          <tr><td>قول "آمين"</td><td>يُستحب سرًّا</td><td>لا تُقال غالبًا</td><td>يُقال جهرًا</td><td>يُقال جهرًا</td></tr>
          <tr class="section-title"><td colspan="5"> 4. التشهد ووضع الأصبع</td></tr>
          <tr><th>المسألة</th><th>الحنفي</th><th>المالكي</th><th>الشافعي</th><th>الحنبلي</th></tr>
          <tr><td>الجلوس للتشهد</td><td>مفروش</td><td>التورك في الأخير</td><td>الافتراش ثم التورك</td><td>الافتراش ثم التورك</td></tr>
          <tr><td>تحريك السبابة</td><td>عند الشهادة فقط</td><td>تبقى ساكنة</td><td>من "إلا الله" حتى السلام</td><td>يُحركها مع كل دعاء</td></tr>
          <tr class="section-title"><td colspan="5"> 5. التسليم (السلام)</td></tr>
          <tr><th>المسألة</th><th>الحنفي</th><th>المالكي</th><th>الشافعي</th><th>الحنبلي</th></tr>
          <tr><td>عدد التسليمات</td><td>تسليمتان واجبتان</td><td>تسليمة واحدة تكفي</td><td>تسليمتان</td><td>تسليمتان</td></tr>
          <tr class="section-title"><td colspan="5"> 6. قراءة دعاء الاستفتاح</td></tr>
          <tr><th>المسألة</th><th>الحنفي</th><th>المالكي</th><th>الشافعي</th><th>الحنبلي</th></tr>
          <tr><td>الاستفتاح</td><td>مستحب</td><td>لا يُقال</td><td>مستحب</td><td>مستحب</td></tr>
        </table>
        <script>
        document.getElementById('speakable-madhahib-table').addEventListener('click', function(e) {
          // شغل الصوت فقط إذا كان الضغط على خلية (td أو th)
          if (e.target.tagName === 'TD' || e.target.tagName === 'TH') {
            var text = e.target.innerText.trim();
            if (text) {
              var utterance = new (window.SpeechSynthesisUtterance || window.webkitSpeechSynthesisUtterance)(text);
              utterance.lang = 'ar-SA';
              window.speechSynthesis.speak(utterance);
            }
          }
        });
        </script>
      </div>
      <!-- فيديو الفرق بين المذاهب الأربعة في الصلاة -->
      <div style="display: flex; justify-content: center; margin-top: 32px;">
        <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
          <div style="position: relative; padding-bottom: 56.25%; height: 0;">
            <iframe src="https://www.youtube.com/embed/ew0ikbFhEDs?si=g38VIdhNFc-F_H0j" title="الفرق بين المذاهب الأربعة في الصلاة" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
          </div>
          <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">الفرق بين المذاهب الأربعة في الصلاة</div>
        </div>
      </div>
      <!-- فيديو صفة الصلاة الصحيحة (على المذهب المالكي) -->
      <div style="display: flex; justify-content: center; margin-top: 24px;">
        <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
          <div style="position: relative; padding-bottom: 56.25%; height: 0;">
            <iframe src="https://www.youtube.com/embed/ZsAjve8Pp68?si=a2txHThozPsE9L4D" title="صفة الصلاة الصحيحة (على المذهب المالكي)" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
          </div>
          <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">صفة الصلاة الصحيحة (على المذهب المالكي)</div>
        </div>
      </div>  

      <!-- فيديو صفة الصلاة الصحيحة (على المذهب الحنبلي) -->
      <div style="display: flex; justify-content: center; margin-top: 24px;">
        <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
          <div style="position: relative; padding-bottom: 56.25%; height: 0;">
            <iframe src="https://www.youtube.com/embed/IH1RFqbHrJk?si=MXHBE9JOlxvR6zMu" title="صفة الصلاة الصحيحة (على المذهب الحنبلي)" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
          </div>
          <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">صفة الصلاة الصحيحة (على المذهب الحنبلي)</div>
        </div>
      </div>

      <!-- فيديو صفة الصلاة الصحيحة (على المذهب الشافعي) -->
      <div style="display: flex; justify-content: center; margin-top: 24px;">
        <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
          <div style="position: relative; padding-bottom: 56.25%; height: 0;">
            <iframe src="https://www.youtube.com/embed/6xSp55mtfZU?si=d5Vq9Xe62JKXgvWf" title="صفة الصلاة الصحيحة (على المذهب الشافعي)" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
          </div>
          <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">صفة الصلاة الصحيحة (على المذهب الشافعي)</div>
        </div>
      </div>

      <!-- فيديو صفة الصلاة الصحيحة (على المذهب الحنفي) -->
      <div style="display: flex; justify-content: center; margin-top: 24px;">
        <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
          <div style="position: relative; padding-bottom: 56.25%; height: 0;">
            <iframe src="https://www.youtube.com/embed/DQUDV-zVQOs?si=TtmLjmuZSnTkRZwC" title="صفة الصلاة الصحيحة (على المذهب الحنفي)" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
          </div>
          <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">صفة الصلاة الصحيحة (على المذهب الحنفي)</div>
        </div>
      </div>
      <!-- ملاحظات مهمة حول المذاهب -->
      <div style="max-width: 680px; margin: 40px auto 0; background: #222; border: 2px solid #ffd700; border-radius: 14px; box-shadow: 0 4px 16px #ffd70033; padding: 18px 20px; color: #ffd700; font-size: 1.08em; line-height: 1.8; text-align: right;">
        <div style="font-size:1.2em; font-weight: bold; color: #dd0707; margin-bottom: 8px;">⚠️ ملاحظات مهمة:</div>
          <li style="margin-bottom:8px;">الصلاة صحيحة في كل المذاهب، والاختلاف لا يبطل الصلاة.</li>
          <li style="margin-bottom:8px;">يُفضل للمسلم أن يتبع مذهب بلده أو معلمه، ولكن لا حرج في التنقل بين المذاهب إذا دعت الحاجة.</li>
          <li>هذه الخلافات فقهية اجتهادية، وكلها مأخوذة من الكتاب والسنة بتفسيرات مختلفة.</li>
        </ul>
      </div>
    </div>
    <!-- قسم الأذان -->
    <div id="adhan" class="tab-content">
      <div class="hero-card">
        <div style="display: flex; justify-content: center; margin-top: 24px;">
          <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
            <div style="position: relative; padding-bottom: 56.25%; height: 0;">
              <iframe src="https://www.youtube.com/embed/ysdhLKxufSc?si=l6qfG2XE1L8V70zN" title="الأذان الحجازي مكة والمدينة" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
            </div>
            <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">الأذان الحجازي - مكة والمدينة</div>
          </div>
        </div>
        <div style="display: flex; justify-content: center; margin-top: 32px;">
          <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
            <div style="position: relative; padding-bottom: 56.25%; height: 0;">
              <iframe src="https://www.youtube.com/embed/TMUqiV68CEE?si=TgGYnZSszwsA75zS" title="الأذان المصري - مصر" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
            </div>
            <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">الأذان المصري - مصر</div>
          </div>
          </div>
        <div style="display: flex; justify-content: center; margin-top: 32px;">
          <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
            <div style="position: relative; padding-bottom: 56.25%; height: 0;">
              <iframe src="https://www.youtube.com/embed/P2PlwDrEtbM?si=kOz0vvz88gcMxmsZ" title="الأذان الشامي - سوريا ولبنان وفلسطين والأردن" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
            </div>
            <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">الأذان الشامي - سوريا ولبنان وفلسطين والأردن</div>
          </div>
        </div>
        <div style="display: flex; justify-content: center; margin-top: 32px;">
          <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
            <div style="position: relative; padding-bottom: 56.25%; height: 0;">
              <iframe src="https://www.youtube.com/embed/KTdzvqT7Zv8?si=E46zO8xPdiQUP4s6" title="الأذان العراقي - العراق" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
            </div>
            <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">الأذان العراقي - العراق</div>
          </div>
        </div>
        <div style="display: flex; justify-content: center; margin-top: 32px;">
          <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
            <div style="position: relative; padding-bottom: 56.25%; height: 0;">
              <iframe src="https://www.youtube.com/embed/3mCyc5w9yc8?si=jdO9UJaQlB1f_Zhn" title="الأذان المغربي/الأندلسي - المغرب، الجزائر، تونس، موريتانيا" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
            </div>
            <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">الأذان المغربي/الأندلسي - المغرب، الجزائر، تونس، موريتانيا</div>
          </div>
        </div>
        <div style="display: flex; justify-content: center; margin-top: 32px;">
          <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
            <div style="position: relative; padding-bottom: 56.25%; height: 0;">
              <iframe src="https://www.youtube.com/embed/t95UJxiGwgg?si=9SgzHumwNK6Ttyf-" title="الأذان الإندونيسي/الآسيوي - إندونيسيا، ماليزيا، الهند، باكستان" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
            </div>
            <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">الأذان الإندونيسي/الآسيوي - إندونيسيا، ماليزيا، الهند، باكستان</div>
          </div>
        </div>
        <div style="display: flex; justify-content: center; margin-top: 32px;">
          <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
            <div style="position: relative; padding-bottom: 56.25%; height: 0;">
              <iframe src="https://www.youtube.com/embed/3a24LkJxM-g?si=cwbQgMH9TP5Nm-XK" title="الأذان التركي - تركيا والبلقان" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
            </div>
            <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">الأذان التركي - تركيا والبلقان</div>
          </div>
        </div>
        <div style="display: flex; justify-content: center; margin-top: 32px;">
          <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
            <div style="position: relative; padding-bottom: 56.25%; height: 0;">
              <iframe src="https://www.youtube.com/embed/lj7PkMtuTeQ?si=trPgpZTz6O9Rta8l" title="الأذان الإفريقي - نيجيريا، السنغال، مالي، تشاد" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
            </div>
            <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">الأذان الإفريقي - نيجيريا، السنغال، مالي، تشاد</div>
          </div>
        </div>
        </div>
      </div>
    </div>
    <!-- قسم قصص عن الصلاة -->
    <div id="stories" class="tab-content">
      <div class="hero-card">
        <h2 style="text-align: center; margin-bottom: 30px; color: var(--text-gold);">
          <i class="fas fa-book-reader"></i>
          قصص عن الصلاة
        </h2>
        <div style="display: flex; justify-content: center; margin-top: 24px;">
          <div style="display: flex; flex-direction: column; gap: 32px; width: 100%; align-items: center;">
            <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
              <div style="position: relative; padding-bottom: 56.25%; height: 0;">
                <iframe src="https://www.youtube.com/embed/e8yeigZCwMw?si=2a0A_qYt6ufvsMjT" title="قصة عن الصلاة" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
              </div>
              <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">قصة مؤثرة عن الصلاة</div>
            </div>
            <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
              <div style="position: relative; padding-bottom: 56.25%; height: 0;">
                <iframe src="https://www.youtube.com/embed/S_o3I0ro6Xk" title="أجمل قصص عن الرسول عليه أفضل الصلاة والسلام - خطب بدر المشاري" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
              </div>
              <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">أجمل قصص عن الرسول عليه أفضل الصلاة والسلام - خطب بدر المشاري</div>
            </div>
            <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
              <div style="position: relative; padding-bottom: 56.25%; height: 0;">
                <iframe src="https://www.youtube.com/embed/fOOv4haSBao" title="رحلة الصلاة وروحها | أحمد الرئيسي" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
              </div>
              <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">رحلة الصلاة وروحها | أحمد الرئيسي</div>
            </div>
            <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
              <div style="position: relative; padding-bottom: 56.25%; height: 0;">
                <iframe src="https://www.youtube.com/embed/63_AOCldyXo?si=HU1bvP8WM2-VTYlb" title="تذوق العبادات - الصلاة | مع د. أحمد العربي" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
              </div>
              <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">تذوق العبادات - الصلاة | مع د. أحمد العربي</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- الصفحة الرئيسية -->
    <div id="home" class="tab-content active">
      <div class="hero-card">
        <h1 style="text-align: center; font-size: 36px; margin-bottom: 20px; background: var(--primary-gold); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
          <i class="fas fa-mosque"></i>
          مرحباً بك في دليل الصلاة التفاعلي
        </h1>
        <p style="text-align: center; font-size: 18px; line-height: 1.8; color: var(--text-light); margin-bottom: 30px; opacity: 0.9;">
          دليلك الشامل لتعلم الصلاة والوضوء مع ميزات تفاعلية متطورة وأذان الشيوخ المميزين
        </p>
        <div class="audio-controls">
          <button class="audio-btn" onclick="playWelcomeAudio()">
            <i class="fas fa-play"></i>
          </button>
        </div>
      </div>

      <div class="grid">
        <div class="card" onclick="showTab('wudu')">
          <div class="card-icon">
            <i class="fas fa-hand-sparkles"></i>
          </div>
          <h3 class="card-title">تعلم الوضوء</h3>
          <p>خطوات الوضوء الصحيح مع الإرشادات الصوتية والمرئية</p>
        </div>

        <div class="card" onclick="showTab('prayer')">
          <div class="card-icon">
            <i class="fas fa-praying-hands"></i>
          </div>
          <h3 class="card-title">أداء الصلاة</h3>
          <p>دليل شامل لأداء الصلاة مع التوجيه خطوة بخطوة</p>
        </div>

        <div class="card" onclick="showTab('qibla')">
          <div class="card-icon">
            <i class="fas fa-compass"></i>
          </div>
          <h3 class="card-title">اتجاه القبلة</h3>
          <p>بوصلة ذكية لتحديد اتجاه القبلة بدقة</p>
        </div>

        <div class="card" onclick="showTab('duas')">
          <div class="card-icon">
            <i class="fas fa-book-open"></i>
          </div>
          <h3 class="card-title">الأذكار والأدعية</h3>
          <p>مجموعة شاملة من الأذكار اليومية والأدعية المأثورة</p>
        </div>

        <div class="card" onclick="showTab('times')">
          <div class="card-icon">
            <i class="fas fa-clock"></i>
          </div>
          <h3 class="card-title">مواقيت الصلاة</h3>
          <p>أوقات الصلاة الدقيقة مع التنبيهات الذكية</p>
        </div>
        <div class="card" onclick="window.location.href='mushaf.html'">
          <div class="card-icon">
            <i class="fas fa-quran"></i>
          </div>
          <h3 class="card-title">المصحف الشريف</h3>
          <p>تصفح واستمع للقرآن الكريم كاملاً مع التحكم في الخط والصوت</p>
        </div>
        <div class="card" onclick="showTab('book-explanation')">
          <div class="card-icon">
            <i class="fas fa-book"></i>
          </div>
          <h3 class="card-title">شرح كتاب الصلاة</h3>
          <p>   كتاب الصلاة وأهم أحكامه بأسلوب مبسط د.عامر بهجت </p>
        </div>
      </div>
    </div>

    <!-- قسم شرح كتاب الصلاة -->
    <div id="book-explanation" class="tab-content">
      <div class="hero-card">
        <h2 style="text-align: center; margin-bottom: 30px; color: var(--text-gold);">
          <i class="fas fa-book-open"></i>
          شرح كتاب الصلاة
        </h2>
        <div style="margin-bottom: 20px;">
          <b>مدخل إلى كتاب الصلاة</b>
          <p id="book-intro-text" style="margin-top: 10px; font-size: 1.1em; line-height: 2;">
            الصلاة في اللغة تعني الدعاء، وهي من الجذر الثلاثي (ص ل و). أما في الاصطلاح الشرعي، فالصلاة عبادة تتضمن أقوالًا وأفعالًا مخصوصة، تبدأ بالتكبير وتنتهي بالتسليم، وتؤدى بشروط وأركان معلومة في أوقات محددة، وهي الركن الثاني من أركان الإسلام بعد الشهادتين.<br><br>
            تعد الصلاة أعظم العبادات البدنية، وهي الصلة اليومية التي تربط العبد بربه، تربي في النفس الخشوع، وفي القلب الطمأنينة، وفي السلوك الاتزان. كما أنها أول ما يُحاسب عليه العبد يوم القيامة، فإن صلحت صلح سائر العمل، وإن فسدت فسد سائر العمل.<br><br>
            بعد الإلمام بهذا التعريف، يمكن الانتقال إلى دراسة تبويبات كتاب الصلاة التي تشمل الأذان، شروط الصلاة، صفتها، أركانها، أحكام السهو، النوافل، وصلاة الجماعة والجمعة والعيدين وغيرها، وهي تبويبات تهدف إلى فهم هذه العبادة فهمًا منهجيًا يجمع بين الجانب العلمي والعملي.
          </p>
          <div style="margin: 10px 0 20px 0; display: flex; gap: 10px; align-items: center;">
            <button id="intro-tts-btn" class="audio-btn" onclick="toggleIntroTTS()" title="تشغيل أو إيقاف الصوت" style="font-size:1.5em; background:none; border:none; color:var(--text-gold); cursor:pointer;">
              <i id="intro-tts-icon" class="fas fa-play-circle"></i>
            </button>
          </div>
        </div>
        <div style="overflow-x:auto;">
          <table style="width:100%; background:rgba(255,215,0,0.07); border-radius:12px; border:1.5px solid #ffd700; margin-bottom:20px; text-align:center;">
            <thead>
              <tr style="background:rgba(255,215,0,0.15); color:#ffd700;">
                <th>رقم</th>
                <th>التبويب</th>
                <th>النبذة المختصرة</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>1</td>
                <td onclick="speakText('الأذان والإقامة')" style="cursor:pointer;">
                  الأذان والإقامة
                </td>
                <td onclick="speakText('يتناول أحكام الأذان والإقامة، شروطهما وصيغتهما ووقتهما وأفضالهما.')" style="cursor:pointer;">
                  يتناول أحكام الأذان والإقامة، شروطهما وصيغتهما ووقتهما وأفضالهما.
                </td>
              </tr>
              <tr>
                <td>2</td>
                <td onclick="speakText('شرائط الصلاة')" style="cursor:pointer;">
                  شرائط الصلاة
                </td>
                <td onclick="speakText('يوضح الشروط التي لا تصح الصلاة بدونها مثل الطهارة، ستر العورة، استقبال القبلة.')" style="cursor:pointer;">
                  يوضح الشروط التي لا تصح الصلاة بدونها مثل الطهارة، ستر العورة، استقبال القبلة.
                </td>
              </tr>
              <tr>
                <td>3</td>
                <td onclick="speakText('آداب المشي إلى الصلاة')" style="cursor:pointer;">
                  آداب المشي إلى الصلاة
                </td>
                <td onclick="speakText('يستعرض السنن والآداب المتعلقة بالخروج إلى المسجد مثل السكينة والدعاء.')" style="cursor:pointer;">
                  يستعرض السنن والآداب المتعلقة بالخروج إلى المسجد مثل السكينة والدعاء.
                </td>
              </tr>
              <tr>
                <td>4</td>
                <td onclick="speakText('صفة الصلاة')" style="cursor:pointer;">
                  صفة الصلاة
                </td>
                <td onclick="speakText('شرح لأداء الصلاة خطوة بخطوة منذ التكبير وحتى التسليم.')" style="cursor:pointer;">
                  شرح لأداء الصلاة خطوة بخطوة منذ التكبير وحتى التسليم.
                </td>
              </tr>
              <tr>
                <td>5</td>
                <td onclick="speakText('أركان الصلاة وواجباتها')" style="cursor:pointer;">
                  أركان الصلاة وواجباتها
                </td>
                <td onclick="speakText('يفرق بين ما لا تصح الصلاة بدونه (الأركان) وبين ما يجبر بالسهو (الواجبات).')" style="cursor:pointer;">
                  يفرق بين ما لا تصح الصلاة بدونه (الأركان) وبين ما يجبر بالسهو (الواجبات).
                </td>
              </tr>
              <tr>
                <td>6</td>
                <td onclick="speakText('سجدتي السهو')" style="cursor:pointer;">
                  سجدتي السهو
                </td>
                <td onclick="speakText('يبين أسباب سجود السهو، ومواضعه وكيفيته وأحكامه المختلفة.')" style="cursor:pointer;">
                  يبين أسباب سجود السهو، ومواضعه وكيفيته وأحكامه المختلفة.
                </td>
              </tr>
              <tr>
                <td>7</td>
                <td onclick="speakText('الساعات التي نهي عن الصلاة فيها')" style="cursor:pointer;">
                  الساعات التي نهي عن الصلاة فيها
                </td>
                <td onclick="speakText('يوضح الأوقات التي نهى الشرع عن الصلاة فيها وما يستثنى من ذلك.')" style="cursor:pointer;">
                  يوضح الأوقات التي نهى الشرع عن الصلاة فيها وما يستثنى من ذلك.
                </td>
              </tr>
              <tr>
                <td>8</td>
                <td onclick="speakText('صلاة التطوع')" style="cursor:pointer;">
                  صلاة التطوع
                </td>
                <td onclick="speakText('يتناول أنواع النوافل، وأفضل أوقاتها، وفضلها، وسنن الرواتب وغيرها.')" style="cursor:pointer;">
                  يتناول أنواع النوافل، وأفضل أوقاتها، وفضلها، وسنن الرواتب وغيرها.
                </td>
              </tr>
              <tr>
                <td>9</td>
                <td onclick="speakText('الإمامة')" style="cursor:pointer;">
                  الإمامة
                </td>
                <td onclick="speakText('يشرح أحكام إمامة الصلاة، من يصلح لها، ومن يُقدَّم فيها، وأحكام المأموم.')" style="cursor:pointer;">
                  يشرح أحكام إمامة الصلاة، من يصلح لها، ومن يُقدَّم فيها، وأحكام المأموم.
                </td>
              </tr>
              <tr>
                <td>10</td>
                <td onclick="speakText('صلاة المريض')" style="cursor:pointer;">
                  صلاة المريض
                </td>
                <td onclick="speakText('يوضح كيفية أداء المريض للصلاة حسب استطاعته قيامًا أو قعودًا أو على جنب.')" style="cursor:pointer;">
                  يوضح كيفية أداء المريض للصلاة حسب استطاعته قيامًا أو قعودًا أو على جنب.
                </td>
              </tr>
              <tr>
                <td>11</td>
                <td onclick="speakText('صلاة المسافر')" style="cursor:pointer;">
                  صلاة المسافر
                </td>
                <td onclick="speakText('أحكام قصر الصلاة وجمعها في السفر، وشروط ذلك.')" style="cursor:pointer;">
                  أحكام قصر الصلاة وجمعها في السفر، وشروط ذلك.
                </td>
              </tr>
              <tr>
                <td>12</td>
                <td onclick="speakText('صلاة الخوف')" style="cursor:pointer;">
                  صلاة الخوف
                </td>
                <td onclick="speakText('أحكام خاصة بالصلاة في حال الخوف أو الحرب، وصورها المختلفة كما جاءت في السنة.')" style="cursor:pointer;">
                  أحكام خاصة بالصلاة في حال الخوف أو الحرب، وصورها المختلفة كما جاءت في السنة.
                </td>
              </tr>
              <tr>
                <td>13</td>
                <td onclick="speakText('صلاة الجمعة')" style="cursor:pointer;">
                  صلاة الجمعة
                </td>
                <td onclick="speakText('يشرح شروطها، خطبتها، عدد ركعاتها، وأحكام التخلف عنها.')" style="cursor:pointer;">
                  يشرح شروطها، خطبتها، عدد ركعاتها، وأحكام التخلف عنها.
                </td>
              </tr>
              <tr>
                <td>14</td>
                <td onclick="speakText('صلاة العيدين')" style="cursor:pointer;">
                  صلاة العيدين
                </td>
                <td onclick="speakText('يتناول أحكام صلاة عيد الفطر وعيد الأضحى، صفتها ووقتها وخطبتها.')" style="cursor:pointer;">
                  يتناول أحكام صلاة عيد الفطر وعيد الأضحى، صفتها ووقتها وخطبتها.
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <audio id="book-intro-audio" src="audio/book-intro.mp3"></audio>

        <!-- فيديو الدرس 1 - كتاب الصلاة -->
        <div style="display: flex; justify-content: center; margin-top: 32px;">
          <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
            <div style="position: relative; padding-bottom: 56.25%; height: 0;">
              <iframe src="https://www.youtube.com/embed/wBzojnXLItM?si=3syLd_UjioNTUM_N" title="الدرس 1 - كتاب الصلاة" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
            </div>
            <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">فيديو الدرس 1 - كتاب الصلاة</div>
          </div>
        </div>
        <!-- فيديو الدرس 2 - الأذان والإقامة -->
        <div style="display: flex; justify-content: center; margin-top: 32px;">
          <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
            <div style="position: relative; padding-bottom: 56.25%; height: 0;">
              <iframe src="https://www.youtube.com/embed/6xAZWTKgAfc?si=YS-baW8kQHugWTky" title="الدرس 2 - الأذان والإقامة" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
            </div>
            <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">فيديو الدرس 2 - الأذان والإقامة</div>
          </div>
        </div>
        <!-- فيديو الدرس 3 - شرائط الصلاة -->
        <div style="display: flex; justify-content: center; margin-top: 32px;">
          <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
            <div style="position: relative; padding-bottom: 56.25%; height: 0;">
              <iframe src="https://www.youtube.com/embed/ib1ScCX7XUg?si=H0XZ5PvUrVNHkJ25" title="الدرس 3 - شرائط الصلاة" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
            </div>
            <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">فيديو الدرس 3 - شرائط الصلاة</div>
          </div>
        </div>
        <!-- فيديو الدرس 4 - شرائط الصلاة - الجزء الثاني -->
        <div style="display: flex; justify-content: center; margin-top: 32px;">
          <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
            <div style="position: relative; padding-bottom: 56.25%; height: 0;">
              <iframe src="https://www.youtube.com/embed/PfAySJRoBNc?si=dOS-V_g1A8mwQXyl" title="الدرس 4 - شرائط الصلاة - الجزء الثاني" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
            </div>
            <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">فيديو الدرس 4 - شرائط الصلاة - الجزء الثاني</div>
          </div>
        </div>
        <!-- فيديو الدرس 5 - آداب المشي إلى الصلاة -->
        <div style="display: flex; justify-content: center; margin-top: 32px;">
          <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
            <div style="position: relative; padding-bottom: 56.25%; height: 0;">
              <iframe src="https://www.youtube.com/embed/_-n21K7QH8E?si=lqRiKZWBK8OTJHPl" title="الدرس 5 - آداب المشي إلى الصلاة" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
            </div>
            <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">فيديو الدرس 5 - آداب المشي إلى الصلاة</div>
          </div>
        </div>
        <!-- فيديو الدرس 6 - صفة الصلاة -->
        <div style="display: flex; justify-content: center; margin-top: 32px;">
          <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
            <div style="position: relative; padding-bottom: 56.25%; height: 0;">
              <iframe src="https://www.youtube.com/embed/JCbvDbCQ9DQ?si=SiTu5lAbqJkDJEYO" title="الدرس 6 - صفة الصلاة" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
            </div>
            <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">فيديو الدرس 6 - صفة الصلاة</div>
          </div>
        </div>
        <!-- فيديو الدرس 7 - سجدتي السهو -->
        <div style="display: flex; justify-content: center; margin-top: 32px;">
          <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
            <div style="position: relative; padding-bottom: 56.25%; height: 0;">
              <iframe src="https://www.youtube.com/embed/hR1g9kPjFeQ?si=dxylkNceWPgqTtbL" title="الدرس 7 - سجدتي السهو" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
            </div>
            <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">فيديو الدرس 7 - سجدتي السهو</div>
          </div>
        </div>
        <!-- فيديو الدرس 8 - صلاة التطوع -->
        <div style="display: flex; justify-content: center; margin-top: 32px;">
          <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
            <div style="position: relative; padding-bottom: 56.25%; height: 0;">
              <iframe src="https://www.youtube.com/embed/iHuhr_916tE?si=p_3qGDKpmQCDFH6-" title="الدرس 8 - صلاة التطوع" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
            </div>
            <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">فيديو الدرس 8 - صلاة التطوع</div>
          </div>
        </div>
        <!-- فيديو الدرس 9 - الساعات التي نهي عن الصلاة فيها -->
        <div style="display: flex; justify-content: center; margin-top: 32px;">
          <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
            <div style="position: relative; padding-bottom: 56.25%; height: 0;">
              <iframe src="https://www.youtube.com/embed/Fip3G-HBiyM?si=hlfX4ZZk4sSdIQkK" title="الدرس 9 - الساعات التي نهي عن الصلاة فيها" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
            </div>
            <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">فيديو الدرس 9 - الساعات التي نهي عن الصلاة فيها</div>
          </div>
        </div>
        <!-- فيديو الدرس 10 - الإمامة -->
        <div style="display: flex; justify-content: center; margin-top: 32px;">
          <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
            <div style="position: relative; padding-bottom: 56.25%; height: 0;">
              <iframe src="https://www.youtube.com/embed/QRYeSnjThbw?si=6EiCn63SjhXbZr_4" title="الدرس 10 - الإمامة" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
            </div>
            <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">فيديو الدرس 10 - الإمامة</div>
          </div>
        </div>
        <!-- فيديو الدرس 11 - صلاة المريض -->
        <div style="display: flex; justify-content: center; margin-top: 32px;">
          <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
            <div style="position: relative; padding-bottom: 56.25%; height: 0;">
              <iframe src="https://www.youtube.com/embed/VQL_fpEtgDQ?si=UMrY0NFOGssp92NG" title="الدرس 11 - صلاة المريض" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
            </div>
            <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">فيديو الدرس 11 - صلاة المريض</div>
          </div>
        </div>
        <!-- فيديو الدرس 12 - صلاة المسافر -->
        <div style="display: flex; justify-content: center; margin-top: 32px;">
          <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
            <div style="position: relative; padding-bottom: 56.25%; height: 0;">
              <iframe src="https://www.youtube.com/embed/RSv0S0bEW5U?si=Zjhl_FOSVandkgEg" title="الدرس 12 - صلاة المسافر" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
            </div>
            <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">فيديو الدرس 12 - صلاة المسافر</div>
          </div>
        </div>
        <!-- فيديو الدرس 13 - صلاة الخوف -->
        <div style="display: flex; justify-content: center; margin-top: 32px;">
          <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
            <div style="position: relative; padding-bottom: 56.25%; height: 0;">
              <iframe src="https://www.youtube.com/embed/H5WZvxiZ9zs?si=GmGpxUryETNmEZch" title="الدرس 13 - صلاة الخوف" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
            </div>
            <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">فيديو الدرس 13 - صلاة الخوف</div>
          </div>
        </div>
        <!-- فيديو الدرس 14 - صلاة الجمعة -->
        <div style="display: flex; justify-content: center; margin-top: 32px;">
          <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
            <div style="position: relative; padding-bottom: 56.25%; height: 0;">
              <iframe src="https://www.youtube.com/embed/S6Gj8Dbt6h0?si=ftuh6r13fcYZFaig" title="الدرس 14 - صلاة الجمعة" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
            </div>
            <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">فيديو الدرس 14 - صلاة الجمعة</div>
          </div>
        </div>
        <!-- فيديو الدرس 15 والأخيرة - صلاة العيدين -->
        <div style="display: flex; justify-content: center; margin-top: 32px;">
          <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
            <div style="position: relative; padding-bottom: 56.25%; height: 0;">
              <iframe src="https://www.youtube.com/embed/aBlRuqr2EDs?si=n8ovXRKZcsSr7o_3" title="الدرس 15 - صلاة العيدين" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
            </div>
            <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">فيديو الدرس 15 والأخيرة - صلاة العيدين</div>
          </div>
        </div>
        <!-- فيديو تمرينات كتاب الصلاة - المسائل المعاصرة (1/2) -->
        <div style="display: flex; justify-content: center; margin-top: 32px;">
          <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
            <div style="position: relative; padding-bottom: 56.25%; height: 0;">
              <iframe src="https://www.youtube.com/embed/jDqiExnuFSs?si=-rDfpezuh9edCVAA" title="تمرينات كتاب الصلاة - المسائل المعاصرة (1/2)" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
            </div>
            <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">فيديو تمرينات كتاب الصلاة - المسائل المعاصرة (1/2)</div>
          </div>
        </div>
        <!-- فيديو تمرينات كتاب الصلاة - المسائل المعاصرة (2/2) -->
        <div style="display: flex; justify-content: center; margin-top: 32px;">
          <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
            <div style="position: relative; padding-bottom: 56.25%; height: 0;">
              <iframe src="https://www.youtube.com/embed/UImuHnjWzTc?si=2MAd1sGd8AadYXcd" title="تمرينات كتاب الصلاة - المسائل المعاصرة (2/2)" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
            </div>
            <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">فيديو تمرينات كتاب الصلاة - المسائل المعاصرة (2/2)</div>
          </div>
        </div>
    </div>

    <!-- قسم الوضوء -->
    <div id="wudu" class="tab-content">
      <div class="hero-card">
        <h2 style="text-align: center; margin-bottom: 30px; color: var(--text-gold);">
          <i class="fas fa-hand-sparkles"></i>
          دليل الوضوء التفاعلي
        </h2>
        
        <div class="progress-circle">
          <svg class="progress-ring" width="100" height="100">
            <circle class="progress-ring-circle"></circle>
            <circle class="progress-ring-fill" id="wudu-progress"></circle>
          </svg>
          <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-weight: 700; color: var(--text-gold);">
            <span id="wudu-step-number">1</span>/7
          </div>
        </div>

        <ul class="step-list" id="wudu-steps">
          <li class="step-item active" onclick="selectWuduStep(1)">
            <div class="step-number">1</div>
            <div>النية للوضوء في القلب</div>
          </li>
          <li class="step-item" onclick="selectWuduStep(2)">
            <div class="step-number">2</div>
            <div>غسل الكفين ثلاث مرات</div>
          </li>
          <li class="step-item" onclick="selectWuduStep(3)">
            <div class="step-number">3</div>
            <div>المضمضة والاستنشاق ثلاث مرات</div>
          </li>
          <li class="step-item" onclick="selectWuduStep(4)">
            <div class="step-number">4</div>
            <div>غسل الوجه ثلاث مرات من الأذن إلى الأذن</div>
          </li>
          <li class="step-item" onclick="selectWuduStep(5)">
            <div class="step-number">5</div>
            <div>غسل اليدين إلى المرفقين ثلاث مرات</div>
          </li>
          <li class="step-item" onclick="selectWuduStep(6)">
            <div class="step-number">6</div>
            <div>مسح الرأس والأذنين مرة واحدة</div>
          </li>
          <li class="step-item" onclick="selectWuduStep(7)">
            <div class="step-number">7</div>
            <div>غسل الرجلين إلى الكعبين ثلاث مرات</div>
          </li>
        </ul>

        <div class="audio-controls">
          <button class="audio-btn" onclick="playStepAudio()">
            <i class="fas fa-play"></i>
          </button>
          <button class="audio-btn" onclick="pauseAudio()">
            <i class="fas fa-pause"></i>
          </button>
          <button class="audio-btn" onclick="resetWudu()">
            <i class="fas fa-redo"></i>
          </button>
        </div>

        <!-- فيديو تعليمي للوضوء في الأسفل -->
        <div style="display: flex; justify-content: center; margin-top: 40px;">
          <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
            <div style="position: relative; padding-bottom: 56.25%; height: 0;">
              <iframe src="https://www.youtube.com/embed/ww7fulDUUNk?si=1puiF3C7TJ5Sz1Cs" title="فيديو تعليم الوضوء" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- قسم الصلاة -->
    <div id="prayer" class="tab-content">
      <div class="hero-card">
        <h2 style="text-align: center; margin-bottom: 30px; color: var(--text-gold);">
          <i class="fas fa-praying-hands"></i>
          دليل الصلاة التفاعلي
        </h2>

        <div class="grid">
          <div class="card">
            <h3 class="card-title">أركان الصلاة</h3>
            <ul class="step-list">
              <li class="step-item" onclick="playPrayerStep(1)">
                <div class="step-number">1</div>
                <div>القيام مع القدرة</div>
              </li>
              <li class="step-item" onclick="playPrayerStep(2)">
                <div class="step-number">2</div>
                <div>تكبيرة الإحرام</div>
              </li>
              <li class="step-item" onclick="playPrayerStep(3)">
                <div class="step-number">3</div>
                <div>قراءة الفاتحة</div>
              </li>
              <li class="step-item" onclick="playPrayerStep(4)">
                <div class="step-number">4</div>
                <div>الركوع والرفع منه</div>
              </li>
              <li class="step-item" onclick="playPrayerStep(5)">
                <div class="step-number">5</div>
                <div>السجود والجلوس بين السجدتين</div>
              </li>
              <li class="step-item" onclick="playPrayerStep(6)">
                <div class="step-number">6</div>
                <div>الجلوس للتشهد الأخير</div>
              </li>
              <li class="step-item" onclick="playPrayerStep(7)">
                <div class="step-number">7</div>
                <div>السلام</div>
              </li>
            </ul>
          </div>

          <div class="card">
            <h3 class="card-title">خطوات الصلاة</h3>
            <ul class="step-list">
              <li class="step-item" onclick="playDetailedPrayerStep(1)">
                <div class="step-number">1</div>
                <div>استقبال القبلة والنية</div>
              </li>
              <li class="step-item" onclick="playDetailedPrayerStep(2)">
                <div class="step-number">2</div>
                <div>تكبيرة الإحرام "الله أكبر"</div>
              </li>
              <li class="step-item" onclick="playDetailedPrayerStep(3)">
                <div class="step-number">3</div>
                <div>دعاء الاستفتاح</div>
              </li>
              <li class="step-item" onclick="playDetailedPrayerStep(4)">
                <div class="step-number">4</div>
                <div>قراءة الفاتحة وسورة</div>
              </li>
              <li class="step-item" onclick="playDetailedPrayerStep(5)">
                <div class="step-number">5</div>
                <div>الركوع مع التسبيح</div>
              </li>
              <li class="step-item" onclick="playDetailedPrayerStep(6)">
                <div class="step-number">6</div>
                <div>الرفع من الركوع</div>
              </li>
              <li class="step-item" onclick="playDetailedPrayerStep(7)">
                <div class="step-number">7</div>
                <div>السجود مرتين</div>
              </li>
              <li class="step-item" onclick="playDetailedPrayerStep(8)">
                <div class="step-number">8</div>
                <div>التشهد والسلام</div>
              </li>
            </ul>
          </div>
        </div>

        <!-- فيديو تعليمي للصلاة في الأسفل -->
        <div style="display: flex; justify-content: center; margin-top: 40px;">
          <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
            <div style="position: relative; padding-bottom: 56.25%; height: 0;">
              <iframe src="https://www.youtube.com/embed/RFDdPpChgH8?si=DGDWmBOpjrbpQ1bp" title="فيديو تعليم الصلاة" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
            </div>
          </div>
        </div>
      </div>
    </div>


    <!-- قسم القبلة -->
    <div id="qibla" class="tab-content">
      <div class="hero-card" style="text-align: center;">
        <h2 style="margin-bottom: 30px; color: var(--text-gold);">
          <i class="fas fa-compass"></i>
          بوصلة القبلة الذكية
        </h2>
        <div class="qibla-compass" style="margin: 0 auto 18px;">
          <div class="compass-inner">
            <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:32px;height:32px;background:var(--primary-gold);border-radius:50%;box-shadow:0 0 12px #ffd70055;"></div>
            <div class="compass-needle" id="qibla-needle" style="z-index:2;"></div>
            <div style="position:absolute;top:38px;left:50%;transform:translateX(-50%);z-index:3;">
              <svg width="18" height="24" viewBox="0 0 18 24"><polygon points="9,0 18,24 9,18 0,24" fill="#ff6b35" stroke="#ffd700" stroke-width="1.5"/></svg>
            </div>
            <div style="position: absolute; top: 10px; left: 50%; transform: translateX(-50%); font-weight: 700; color: #ff6b35; font-size: 1.2em;">N</div>
            <div style="position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); font-weight: 700; color: var(--text-light); font-size: 1.1em;">S</div>
            <div style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); font-weight: 700; color: var(--text-light); font-size: 1.1em;">W</div>
            <div style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); font-weight: 700; color: var(--text-light); font-size: 1.1em;">E</div>
            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-weight: 700; color: var(--darker-bg); font-size: 1.5em; z-index:4;">
              <i class="fas fa-kaaba"></i>
            </div>
          </div>
        </div>
        <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 18px; margin-bottom: 10px;">
          <div style="min-width:180px;">
            <span style="color:var(--text-gold);font-weight:700;">الاتجاه:</span>
            <span id="qibla-angle">--°</span>
          </div>
          <div style="min-width:180px;">
            <span style="color:var(--text-gold);font-weight:700;">المسافة إلى مكة:</span>
            <span id="qibla-distance">-- كم</span>
          </div>
          <div style="min-width:220px;">
            <span style="color:var(--text-gold);font-weight:700;">موقعك:</span>
            <span id="qibla-coords">--</span>
          </div>
        </div>
        <div style="margin-bottom: 10px;">
          <label style="color:var(--text-gold);font-weight:700;">حسب الدولة المختارة:</label>
          <select id="country-select" style="padding:4px 10px;border-radius:6px;">
            <option value="">اختر الدولة (بديل GPS)</option>
            <option value="MA">المغرب</option>
            <option value="SA">السعودية</option>
            <option value="EG">مصر</option>
            <option value="DZ">الجزائر</option>
            <option value="AE">الإمارات</option>
            <option value="TR">تركيا</option>
            <option value="FR">فرنسا</option>
            <option value="GB">بريطانيا</option>
            <option value="US">أمريكا</option>
            <!-- أضف المزيد حسب الحاجة -->
          </select>
        </div>
        <div class="audio-controls" style="margin-bottom: 10px;">
          <button class="audio-btn" onclick="findQibla()" title="استخدام GPS">
            <i class="fas fa-location-arrow"></i>
          </button>
        </div>
        <div style="background:#ffd70022;padding:10px 18px;border-radius:10px;margin:0 auto 10px;max-width:500px;text-align:right;">
          <b>تعليمات الاستخدام:</b><br>
          - تأكد من السماح للمتصفح بالوصول إلى الموقع<br>
          - ضع الجهاز في وضع أفقي للحصول على نتائج أكثر دقة<br>
          - السهم الذهبي يشير إلى اتجاه القبلة الشريفة<br>
          - يمكنك استخدام موقع الدولة المختارة كبديل
        </div>
        <div id="qibla-success-msg" style="color:var(--text-gold);font-weight:700;margin-top:8px;"></div>
      </div>
    </div>

  <!-- قسم الأذكار -->
<div id="duas" class="tab-content">
  <div class="hero-card">
    <h2 style="text-align: center; margin-bottom: 30px; color: var(--text-gold);">
      <i class="fas fa-book-open"></i>
      الأذكار والأدعية
    </h2>

    <!-- الشهادة -->
    <div class="dua-card">
      <div class="dua-text">
        <b>الشهادة:</b><br>
        أَشْهَدُ أَنْ لاَ إِلَهَ إِلاَّ اللَّهُ وَحْدَهُ لاَ شَرِيكَ لَهُ، وَأَشْهَدُ أَنَّ مُحَمَّدًا عَبْدُهُ وَرَسُولُهُ<br>
        <span style="color: var(--text-gold); font-size: 13px;">
          معناها: الإقرار بوحدانية الله ونبوة محمد ﷺ.<br>
          الفضل: أعظم كلمة في الإسلام، من قالها دخل الجنة بإذن الله.
        </span>
      </div>
      <div class="audio-controls">
        <button class="audio-btn" onclick="playDua('shahada')">
          <i class="fas fa-volume-up"></i>
        </button>
        <button class="audio-btn" onclick="repeatDua('shahada')">
          <i class="fas fa-repeat"></i>
        </button>
      </div>
    </div>



    <!-- اختيار عدد التسبيحات المطلوب لجميع الأذكار -->
    <div style="text-align:center; margin-bottom: 10px;">
      <label for="tasbihTarget" style="color:var(--text-gold);font-weight:bold;">عدد التسبيحات المطلوب:</label>
      <input type="number" id="tasbihTarget" value="33" min="1" max="1000" style="width:60px;text-align:center;direction:ltr;">
    </div>

    <!-- التسبيح -->
    <div class="dua-card">
      <div class="dua-text">
        <b>التسبيح:</b><br>
        سُبْحَانَ اللَّهِ وَالْحَمْدُ لِلَّهِ وَلاَ إِلَهَ إِلاَّ اللَّهُ وَاللَّهُ أَكْبَرُ<br>
        <span style="color: var(--text-gold); font-size: 13px;">
          معناها: تنزيه الله عن النقص، وحمده، وتوحيده، وتعظيمه.<br>
          الفضل: أحب الكلام إلى الله، ويقال بعد كل صلاة 33 مرة.
        </span>
      </div>
      <div class="audio-controls">
        <button class="audio-btn" onclick="playDua('tasbih')">
          <i class="fas fa-volume-up"></i>
        </button>
        <span id="tasbihCounter" class="counter-badge">0</span>
        <button class="audio-btn" onclick="startCounter('tasbihCounter')">
          <i class="fas fa-plus"></i>
        </button>
      </div>
    </div>

    <!-- لا حول ولا قوة إلا بالله -->
    <div class="dua-card">
      <div class="dua-text">
        <b>الذكر:</b><br>
        لا حول ولا قوة إلا بالله<br>
        <span style="color: var(--text-gold); font-size: 13px;">
          معناها: لا تحول للعبد من حال إلى حال ولا قوة له إلا بالله.<br>
          الفضل: كنز من كنوز الجنة، وتقال عند الكرب وعند الاستعانة بالله.
        </span>
      </div>
      <div class="audio-controls">
        <button class="audio-btn" onclick="playDua('la_hawla')">
          <i class="fas fa-volume-up"></i>
        </button>
        <span id="laHawlaCounter" class="counter-badge">0</span>
        <button class="audio-btn" onclick="startCounter('laHawlaCounter')">
          <i class="fas fa-plus"></i>
        </button>
      </div>
    </div>

    <!-- سبحان الله -->
    <div class="dua-card">
      <div class="dua-text">
        <b>الذكر:</b><br>
        سبحان الله<br>
        <span style="color: var(--text-gold); font-size: 13px;">
          معناها: تنزيه الله عن كل نقص.<br>
          الفضل: تملأ الميزان، وتقال كثيرًا في الأذكار.
        </span>
      </div>
      <div class="audio-controls">
        <button class="audio-btn" onclick="playDua('subhanallah')">
          <i class="fas fa-volume-up"></i>
        </button>
        <span id="subhanallahCounter" class="counter-badge">0</span>
        <button class="audio-btn" onclick="startCounter('subhanallahCounter')">
          <i class="fas fa-plus"></i>
        </button>
      </div>
    </div>

    <!-- الحمد لله -->
    <div class="dua-card">
      <div class="dua-text">
        <b>الذكر:</b><br>
        الحمد لله<br>
        <span style="color: var(--text-gold); font-size: 13px;">
          معناها: الثناء على الله وحمده على نعمه.<br>
          الفضل: تملأ الميزان، وتقال كثيرًا في الأذكار.
        </span>
      </div>
      <div class="audio-controls">
        <button class="audio-btn" onclick="playDua('alhamdulillah')">
          <i class="fas fa-volume-up"></i>
        </button>
        <span id="alhamdulillahCounter" class="counter-badge">0</span>
        <button class="audio-btn" onclick="startCounter('alhamdulillahCounter')">
          <i class="fas fa-plus"></i>
        </button>
      </div>
    </div>

    <!-- الله أكبر -->
    <div class="dua-card">
      <div class="dua-text">
        <b>الذكر:</b><br>
        الله أكبر<br>
        <span style="color: var(--text-gold); font-size: 13px;">
          معناها: الله أعظم من كل شيء.<br>
          الفضل: ترفع الذكر وتقال في الأذان والصلاة.
        </span>
      </div>
      <div class="audio-controls">
        <button class="audio-btn" onclick="playDua('allahuakbar')">
          <i class="fas fa-volume-up"></i>
        </button>
        <span id="allahuakbarCounter" class="counter-badge">0</span>
        <button class="audio-btn" onclick="startCounter('allahuakbarCounter')">
          <i class="fas fa-plus"></i>
        </button>
      </div>
    </div>

    <!-- دعاء بعد الصلاة -->
    <div class="dua-card">
      <div class="dua-text">
        <b>دعاء بعد الصلاة:</b><br>
        اللَّهُمَّ أَنْتَ السَّلاَمُ وَمِنْكَ السَّلاَمُ، تَبَارَكْتَ يَا ذَا الْجَلاَلِ وَالإِكْرَامِ<br>
        <span style="color: var(--text-gold); font-size: 13px;">
          معناه: الاعتراف بأن السلام من الله وحده، والثناء عليه.<br>
          الفضل: من أذكار ختم الصلاة، يقال بعد التسليم مباشرة.
        </span>
      </div>
      <div class="audio-controls">
        <button class="audio-btn" onclick="playDua('after_prayer')">
          <i class="fas fa-volume-up"></i>
        </button>
      </div>
    </div>

    <!-- دعاء الاستفتاح -->
    <div class="dua-card">
      <div class="dua-text">
        <b>دعاء الاستفتاح:</b><br>
        سُبْحَانَكَ اللَّهُمَّ وَبِحَمْدِكَ، وَتَبَارَكَ اسْمُكَ، وَتَعَالَى جَدُّكَ، وَلاَ إِلَهَ غَيْرُكَ<br>
        <span style="color: var(--text-gold); font-size: 13px;">
          معناه: تنزيه الله وتمجيده والثناء عليه.<br>
          الفضل: يقال في بداية الصلاة بعد تكبيرة الإحرام.
        </span>
      </div>
      <div class="audio-controls">
        <button class="audio-btn" onclick="playDua('istiftah')">
          <i class="fas fa-volume-up"></i>
        </button>
        <button class="audio-btn" onclick="repeatDua('istiftah')">
          <i class="fas fa-repeat"></i>
        </button>
      </div>
    </div>

    <!-- دعاء الخروج من المنزل -->
    <div class="dua-card">
      <div class="dua-text">
        <b>دعاء الخروج من المنزل:</b><br>
        بِسْمِ اللَّهِ، تَوَكَّلْتُ عَلَى اللَّهِ، لاَ حَوْلَ وَلاَ قُوَّةَ إِلاَّ بِاللَّهِ<br>
        <span style="color: var(--text-gold); font-size: 13px;">
          معناه: التوكل على الله والاعتماد عليه.<br>
          الفضل: يحمي من الشر ويحفظ المسلم عند خروجه.
        </span>
      </div>
      <div class="audio-controls">
        <button class="audio-btn" onclick="playDua('leaving_home')">
          <i class="fas fa-volume-up"></i>
        </button>
      </div>
    </div>

    <!-- دعاء دخول المسجد -->
    <div class="dua-card">
      <div class="dua-text">
        <b>دعاء دخول المسجد:</b><br>
        اللَّهُمَّ افْتَحْ لِي أَبْوَابَ رَحْمَتِكَ<br>
        <span style="color: var(--text-gold); font-size: 13px;">
          معناه: طلب فتح أبواب رحمة الله عند دخول المسجد.<br>
          الفضل: يستحب قوله عند دخول المسجد لنيل الرحمة.
        </span>
      </div>
      <div class="audio-controls">
        <button class="audio-btn" onclick="playDua('enter_mosque')">
          <i class="fas fa-volume-up"></i>
        </button>
      </div>
    </div>

    <!-- دعاء الاستخارة -->
    <div class="dua-card">
      <div class="dua-text">
        <b>دعاء الاستخارة:</b><br>
        اللَّهُمَّ إِنِّي أَسْتَخِيرُكَ بِعِلْمِكَ وَأَسْتَقْدِرُكَ بِقُدْرَتِكَ، وَأَسْأَلُكَ مِنْ فَضْلِكَ الْعَظِيمِ...<br>
        <span style="color: var(--text-gold); font-size: 13px;">
          معناه: طلب الخيرة من الله في أمر ما.<br>
          الفضل: يُقال بعد صلاة الاستخارة لتيسير الأمور.
        </span>
      </div>
      <div class="audio-controls">
        <button class="audio-btn" onclick="playDua('istikharah')">
          <i class="fas fa-volume-up"></i>
        </button>
        <button class="audio-btn" onclick="repeatDua('istikharah')">
          <i class="fas fa-repeat"></i>
        </button>
      </div>
    </div>

    <!-- فيديو أذكار المساء -->
    <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 24px; margin-top: 40px;">
      <!-- فيديو أذكار المساء -->
      <div style="flex: 1 1 320px; max-width: 600px; min-width: 280px; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
        <div style="position: relative; padding-bottom: 56.25%; height: 0;">
          <iframe src="https://www.youtube.com/embed/Gc7xzVqjv0Q?si=Jkm6UE4SU-XvodcB" title="فيديو أذكار المساء" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
        </div>
        <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">أذكار المساء</div>
      </div>
      <!-- فيديو أذكار الصباح -->
      <div style="flex: 1 1 320px; max-width: 600px; min-width: 280px; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
        <div style="position: relative; padding-bottom: 56.25%; height: 0;">
          <iframe src="https://www.youtube.com/embed/EDD4A9HzHfs?si=xlKXa_CpIdWkSxTM" title="فيديو أذكار الصباح" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
        </div>
        <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">أذكار الصباح</div>
      </div>
    </div>
  </div>
</div>

    <!-- قسم المواقيت -->
    <div id="times" class="tab-content">
      <div class="hero-card">
        <h2 style="text-align: center; margin-bottom: 30px; color: var(--text-gold);">
          <i class="fas fa-clock"></i>
          مواقيت الصلاة
        </h2>
        
        <div class="prayer-times">
          <div class="prayer-time">
            <div class="prayer-name">الفجر</div>
            <div class="prayer-time-value" id="fajr-time">05:30</div>
          </div>
          <div class="prayer-time">
            <div class="prayer-name">الشروق</div>
            <div class="prayer-time-value" id="sunrise-time">07:00</div>
          </div>
          <div class="prayer-time current">
            <div class="prayer-name">الظهر</div>
            <div class="prayer-time-value" id="dhuhr-time">12:45</div>
          </div>
          <div class="prayer-time">
            <div class="prayer-name">العصر</div>
            <div class="prayer-time-value" id="asr-time">16:15</div>
          </div>
          <div class="prayer-time">
            <div class="prayer-name">المغرب</div>
            <div class="prayer-time-value" id="maghrib-time">19:30</div>
          </div>
          <div class="prayer-time">
            <div class="prayer-name">العشاء</div>
            <div class="prayer-time-value" id="isha-time">21:00</div>
          </div>
          <!-- خانة التوقيت المحلي -->
          <div class="prayer-time" style="background:#000000ef; border-radius:10px; margin-top:10px; grid-column: 1 / -1; text-align:center; display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 32px;">
            <div style="flex:1; min-width:160px;">
              <div class="prayer-name" style="color:#ffd905;font-weight:bold;">التوقيت المحلي الآن</div>
              <div class="prayer-time-value" id="local-time" style="font-size:1.3em;color:#ffd207;font-weight:bold;direction:ltr;">--:--:--</div>
            </div>
            <div style="flex:1; min-width:160px;">
              <div class="prayer-name" style="color:#ffd905;font-weight:bold;">التاريخ الميلادي</div>
              <div class="prayer-time-value" id="gregorian-date" style="font-size:1.1em;color:#ffd207;font-weight:bold;direction:ltr;">--/--/----</div>
            </div>
          </div>
        </div>

        <div style="text-align: center; margin-top: 30px;">
          <div id="prayer-times-msg" style="margin-top: 12px; color: #e7be04; font-size: 1em;"></div>
        </div>
        <script>
        // تحديث التوقيت المحلي والتاريخ الميلادي كل ثانية
        function updateLocalTimeAndDate() {
          var now = new Date();
          var h = now.getHours().toString().padStart(2, '0');
          var m = now.getMinutes().toString().padStart(2, '0');
          var s = now.getSeconds().toString().padStart(2, '0');
          var timeStr = h + ':' + m + ':' + s;
          var el = document.getElementById('local-time');
          if (el) el.textContent = timeStr;
          // التاريخ الميلادي
          var day = now.getDate().toString().padStart(2, '0');
          var month = (now.getMonth() + 1).toString().padStart(2, '0');
          var year = now.getFullYear();
          var dateStr = day + '/' + month + '/' + year;
          var dateEl = document.getElementById('gregorian-date');
          if (dateEl) dateEl.textContent = dateStr;
        }
        setInterval(updateLocalTimeAndDate, 1000);
        updateLocalTimeAndDate();
        </script>
      </div>
    </div>

    <!-- قسم الإعدادات واللغة -->
    <div id="settings" class="tab-content">
      <div class="language-section">
        <h2 style="text-align: center; margin-bottom: 20px; color: var(--text-gold);">
          <i class="fas fa-cog"></i>
          إعدادات التطبيق
        </h2>
        <p style="text-align: center; font-size: 16px; line-height: 1.8; color: var(--text-light); margin-bottom: 30px; opacity: 0.9;">
          اختر اللغة المفضلة لديك وخصص تجربة الاستخدام
        </p>
        
        <div class="settings-section">
          <h3>
            <i class="fas fa-language"></i>
            اختيار اللغة / Language Selection
          </h3>
          <div class="language-toggle">
            <button class="lang-btn active" onclick="setLanguage('ar')" id="lang-ar">
              <i class="fas fa-flag"></i>
              العربية
            </button>
            <button class="lang-btn" onclick="setLanguage('en')" id="lang-en">
              <i class="fas fa-flag"></i>
              English
            </button>
          </div>
        </div>

        <div class="settings-section">
          <h3>
            <i class="fas fa-volume-up"></i>
            إعدادات الصوت (Text-to-Speech)
          </h3>
          <div class="control-group">
            <label>
              الصوت:
              <select id="tts-voice-select"></select>
            </label>
            <label>
              السرعة:
              <input type="range" id="tts-rate" min="0.5" max="2" step="0.1" value="1">
              <span class="range-value" id="tts-rate-value">1</span>
            </label>
            <label>
              النبرة:
              <input type="range" id="tts-pitch" min="0.5" max="2" step="0.1" value="1">
              <span class="range-value" id="tts-pitch-value">1</span>
            </label>
          </div>
          <div id="tts-support-msg" style="color: #ff6b35; margin: 10px 0; text-align: center;"></div>
          <div class="audio-controls">
            <button class="audio-btn" onclick="testTTS()">
              <i class="fas fa-play"></i>
            </button>
            <button class="audio-btn" onclick="toggleMute()">
              <i class="fas fa-volume-high" id="mute-icon"></i>
            </button>
          </div>
        </div>

        <div class="settings-section">
          <h3>
            <i class="fas fa-palette"></i>
            إعدادات المظهر
          </h3>
          <div class="audio-controls">
            <button class="audio-btn" onclick="toggleTheme()">
              <i class="fas fa-moon"></i>
            </button>
            <button class="audio-btn" onclick="resetSettings()">
              <i class="fas fa-redo"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>


  <footer class="footer">
    <div class="footer-content">
      <div class="developer-info">
        <i class="fas fa-code"></i>
        تطوير وتصميم: عبد الصمد بوركيبات
      </div>
      <div class="copyright">
        <i class="fas fa-copyright"></i>
        جميع الحقوق محفوظة © 2025
      </div>
    </div>
  </footer>

  <script>
  function showGpsAlert(msg) {
    var alertDiv = document.getElementById('gps-alert');
    var alertMsg = document.getElementById('gps-alert-msg');
    if (alertDiv && alertMsg) {
      alertMsg.textContent = msg;
      alertDiv.style.display = 'block';
      setTimeout(function(){ alertDiv.style.opacity = '1'; }, 10);
      setTimeout(function(){ hideGpsAlert(); }, 5000);
    }
  }
  function hideGpsAlert() {
    var alertDiv = document.getElementById('gps-alert');
    if (alertDiv) {
      alertDiv.style.opacity = '0';
      setTimeout(function(){ alertDiv.style.display = 'none'; }, 300);
    }
  }
    // مثال عملي: معالجة أخطاء برمجية بشكل احترافي
    window.addEventListener('error', function(e) {
      // رسالة ودية للمستخدم فقط
      const friendlyMsg = currentLanguage === 'ar'
        ? 'حدث خلل بسيط، يرجى إعادة المحاولة أو تحديث الصفحة.'
        : 'A minor issue occurred, please try again or refresh the page.';
      // سجل الخطأ للمطور فقط
      if (window.console && window.console.error) {
        console.error('JavaScript Error:', e.error || e);
      }
      // منع ظهور رسالة الخطأ الافتراضية
      return true;
    });

    // مثال عملي: استخدام try/catch في دوال تتعامل مع الأجهزة أو الشبكة
    function safeRun(fn) {
      try {
        fn();
      } catch (err) {
        const friendlyMsg = currentLanguage === 'ar'
          ? 'حدث خطأ أثناء تنفيذ العملية، يرجى المحاولة لاحقاً.'
          : 'An error occurred, please try again later.';
        if (window.console && window.console.error) {
          console.error('SafeRun Error:', err);
        }
      }
    }
    // استخدم safeRun(() => { ... }) حول أي كود حساس
    // متغيرات عامة
    let currentWuduStep = 1;
    let currentAudio = null;
    let duaCounter = 0;
    let isMuted = false;
    let currentLanguage = 'ar';
    let mobileMenuOpen = false;

    // إعدادات TTS
    let ttsVoice = null;
    let ttsRate = 1;
    let ttsPitch = 1;
    let availableVoices = [];

    // بيانات النصوص للقراءة الصوتية
    const audioTexts = {
      ar: {
        welcome: "مرحباً بك في دليل الصلاة التفاعلي، دليلك الشامل لتعلم الصلاة والوضوء",
        wudu_steps: [
          "الخطوة الأولى: النية للوضوء في القلب",
          "الخطوة الثانية: غسل الكفين ثلاث مرات",
          "الخطوة الثالثة: المضمضة والاستنشاق ثلاث مرات",
          "الخطوة الرابعة: غسل الوجه ثلاث مرات من الأذن إلى الأذن",
          "الخطوة الخامسة: غسل اليدين إلى المرفقين ثلاث مرات",
          "الخطوة السادسة: مسح الرأس والأذنين مرة واحدة",
          "الخطوة السابعة: غسل الرجلين إلى الكعبين ثلاث مرات"
        ],
        prayer_steps: [
          "القيام مع القدرة للصلاة",
          "تكبيرة الإحرام بقول الله أكبر",
          "قراءة سورة الفاتحة",
          "الركوع والرفع منه مع التسبيح",
          "السجود والجلوس بين السجدتين",
          "الجلوس للتشهد الأخير",
          "السلام للخروج من الصلاة"
        ],
        detailed_prayer_steps: [
          "استقبال القبلة والنية للصلاة",
          "تكبيرة الإحرام بقول الله أكبر",
          "دعاء الاستفتاح",
          "قراءة الفاتحة وسورة من القرآن",
          "الركوع مع التسبيح",
          "الرفع من الركوع",
          "السجود مرتين مع التسبيح",
          "التشهد والسلام"
        ],
        duas: {
          shahada: "أشهد أن لا إله إلا الله وحده لا شريك له، وأشهد أن محمداً عبده ورسوله",
          tasbih: "سبحان الله والحمد لله ولا إله إلا الله والله أكبر",
          after_prayer: "اللَّهُمَّ أَنْتَ السَّلاَمُ وَمِنْكَ السَّلاَمُ، تَبَارَكْتَ يَا ذَا الْجَلاَلِ وَالإِكْرَامِ. معناه: الاعتراف بأن السلام من الله وحده، والثناء عليه. الفضل: من أذكار ختم الصلاة، يقال بعد التسليم مباشرة.",
          istiftah: "سُبْحَانَكَ اللَّهُمَّ وَبِحَمْدِكَ، وَتَبَارَكَ اسْمُكَ، وَتَعَالَى جَدُّكَ، وَلاَ إِلَهَ غَيْرُكَ. معناه: تنزيه الله وتمجيده والثناء عليه. الفضل: يقال في بداية الصلاة بعد تكبيرة الإحرام.",
          leaving_home: "بِسْمِ اللَّهِ، تَوَكَّلْتُ عَلَى اللَّهِ، لاَ حَوْلَ وَلاَ قُوَّةَ إِلاَّ بِاللَّهِ. معناه: التوكل على الله والاعتماد عليه. الفضل: يحمي من الشر ويحفظ المسلم عند خروجه.",
          enter_mosque: "اللَّهُمَّ افْتَحْ لِي أَبْوَابَ رَحْمَتِكَ. معناه: طلب فتح أبواب رحمة الله عند دخول المسجد. الفضل: يستحب قوله عند دخول المسجد لنيل الرحمة.",
          istikharah: "اللَّهُمَّ إِنِّي أَسْتَخِيرُكَ بِعِلْمِكَ وَأَسْتَقْدِرُكَ بِقُدْرَتِكَ، وَأَسْأَلُكَ مِنْ فَضْلِكَ الْعَظِيمِ... معناه: طلب الخيرة من الله في أمر ما. الفضل: يُقال بعد صلاة الاستخارة لتيسير الأمور."
        }
      },
      en: {
        welcome: "Welcome to the Interactive Prayer Guide, your comprehensive guide to learning prayer and ablution",
        wudu_steps: [
          "Step 1: Intention for ablution in the heart",
          "Step 2: Wash hands three times",
          "Step 3: Rinse mouth and nose three times",
          "Step 4: Wash face three times from ear to ear",
          "Step 5: Wash arms up to elbows three times",
          "Step 6: Wipe head and ears once",
          "Step 7: Wash feet up to ankles three times"
        ],
        prayer_steps: [
          "Standing with ability for prayer",
          "Opening takbir saying Allahu Akbar",
          "Reciting Surah Al-Fatiha",
          "Bowing and rising with glorification",
          "Prostration and sitting between prostrations",
          "Sitting for final tashahhud",
          "Salutation to exit prayer"
        ],
        detailed_prayer_steps: [
          "Facing Qibla and intention for prayer",
          "Opening takbir saying Allahu Akbar",
          "Opening supplication",
          "Reciting Al-Fatiha and a Surah from Quran",
          "Bowing with glorification",
          "Rising from bowing",
          "Prostrating twice with glorification",
          "Tashahhud and salutation"
        ],
        duas: {
          shahada: "I bear witness that there is no god but Allah alone with no partner, and I bear witness that Muhammad is His servant and messenger",
          tasbih: "Glory be to Allah, praise be to Allah, there is no god but Allah, and Allah is the Greatest",
          after_prayer: "O Allah, You are peace and from You comes peace, blessed are You, O Possessor of majesty and honor"
        }
      }
    };

    // تهيئة TTS
    function initializeTTS() {
      if (!('speechSynthesis' in window)) {
        document.getElementById('tts-support-msg').textContent = 
          currentLanguage === 'ar' ? 
          'متصفحك لا يدعم ميزة تحويل النص إلى كلام' :
          'Your browser does not support text-to-speech';
        return;
      }

      // تحديث قائمة الأصوات
      function loadVoices() {
        availableVoices = speechSynthesis.getVoices();
        populateVoiceList();
      }

      // تحميل الأصوات عند التوفر
      if (availableVoices.length === 0) {
        speechSynthesis.onvoiceschanged = loadVoices;
      } else {
        loadVoices();
      }
    }

    // ملء قائمة الأصوات
    function populateVoiceList() {
      const voiceSelect = document.getElementById('tts-voice-select');
      voiceSelect.innerHTML = '';

      // أصوات مخصصة عالية الجودة
      const customVoices = [
        { name: 'Microsoft Naayf - Arabic (Saudi)', lang: 'ar-SA', gender: ' (ذكر)', isCustom: true },
        { name: 'Microsoft Hoda - Arabic (Egypt)', lang: 'ar-EG', gender: ' (أنثى)', isCustom: true },
        { name: 'Google français', lang: 'fr-FR', gender: ' (Femme)', isCustom: true },
        { name: 'Google US English', lang: 'en-US', gender: ' (Female)', isCustom: true }
      ];

      // دمج أصوات النظام مع الأصوات المخصصة (مع تمييز المخصصة)
      let voicesToShow = [];
      if (availableVoices.length > 0) {
        // فلترة أصوات النظام حسب اللغة
        const filteredVoices = availableVoices.filter(voice => {
          if (currentLanguage === 'ar') {
            return voice.lang.includes('ar') || voice.lang.includes('Arabic');
          } else if (currentLanguage === 'fr') {
            return voice.lang.toLowerCase().includes('fr');
          } else {
            return voice.lang.includes('en') || voice.lang.includes('English');
          }
        });
        // إذا لم توجد أصوات للغة، أظهر جميع أصوات النظام
        voicesToShow = filteredVoices.length > 0 ? filteredVoices : availableVoices;
        // أضف الأصوات المخصصة دائماً في النهاية
        voicesToShow = voicesToShow.concat(customVoices);
      } else {
        // إذا لم تتوفر أصوات النظام، أظهر فقط الأصوات المخصصة
        voicesToShow = customVoices;
      }

      voicesToShow.forEach((voice, index) => {
        const option = document.createElement('option');
        option.value = voice.name;
        // تحديد الجنس
        let gender = '';
        if (voice.gender) {
          gender = voice.gender;
        } else if (voice.name && typeof voice.name === 'string') {
          const n = voice.name.toLowerCase();
          if (n.includes('female') || n.includes('femme') || n.includes('woman')) {
            gender = currentLanguage === 'fr' ? ' (Femme)' : currentLanguage === 'ar' ? ' (أنثى)' : ' (Female)';
          } else if (n.includes('male') || n.includes('homme') || n.includes('man')) {
            gender = currentLanguage === 'fr' ? ' (Homme)' : currentLanguage === 'ar' ? ' (ذكر)' : ' (Male)';
          }
        }
        // تمييز الأصوات المخصصة
        let customLabel = '';
        if (voice.isCustom) {
          customLabel = currentLanguage === 'ar' ? ' (صوت مخصص)' : ' (Custom Voice)';
        }
        option.textContent = `${voice.name} (${voice.lang})${gender}${voice.default ? ' - الافتراضي' : ''}${customLabel}`;
        voiceSelect.appendChild(option);

        // تحديد الصوت الافتراضي
        if ((voice.default && !voice.isCustom) || (index === 0 && !ttsVoice)) {
          option.selected = true;
          ttsVoice = voice;
        }
      });
    }

    // دالة تشغيل النص الصوتي المحسّنة
    function speakText(text, lang = null) {
      if (!('speechSynthesis' in window)) {
        return;
      }

      if (isMuted) {
        return;
      }

      // إيقاف أي صوت سابق
      if (speechSynthesis.speaking) {
        speechSynthesis.cancel();
      }

      const utterance = new SpeechSynthesisUtterance(text);
      
      // تحديد اللغة
      utterance.lang = lang || (currentLanguage === 'ar' ? 'ar-SA' : 'en-US');
      
      // تطبيق الإعدادات
      utterance.rate = ttsRate;
      utterance.pitch = ttsPitch;
      utterance.volume = 1;
      
      // تحديد الصوت إذا كان متاحاً
      if (ttsVoice) {
        utterance.voice = ttsVoice;
      }

      // التأثيرات البصرية
      document.body.style.filter = 'brightness(1.1) saturate(1.1)';
      
      // معالجة الأحداث
      utterance.onstart = function() {
        currentAudio = utterance;
        // إضافة تأثير للزر النشط
        const activeBtn = document.querySelector('.audio-btn:hover, .audio-btn:focus, .audio-btn:active');
        if (activeBtn) {
          activeBtn.classList.add('active-playing');
        }
      };

      utterance.onend = function() {
        document.body.style.filter = 'brightness(1)';
        document.querySelectorAll('.active-playing').forEach(btn => {
          btn.classList.remove('active-playing');
        });
        currentAudio = null;
      };

      utterance.onerror = function(event) {
        console.error('TTS Error:', event.error);
        document.body.style.filter = 'brightness(1)';
        document.querySelectorAll('.active-playing').forEach(btn => {
          btn.classList.remove('active-playing');
        });
        currentAudio = null;
      };

      // تشغيل الصوت
      speechSynthesis.speak(utterance);
    }

    // تبديل التبويبات
    function showTab(tabName) {
      // إخفاء جميع التبويبات
      const tabContents = document.querySelectorAll('.tab-content');
      tabContents.forEach(tab => tab.classList.remove('active'));
      
      // إظهار التبويب المحدد
      const targetTab = document.getElementById(tabName);
      if (targetTab) {
        targetTab.classList.add('active');
      }
      
      // تحديث أزرار التنقل
      const navTabs = document.querySelectorAll('.nav-tab');
      navTabs.forEach(tab => tab.classList.remove('active'));
      
      // تفعيل الزر الحالي
      const clickedButton = event?.target?.closest('.nav-tab');
      if (clickedButton) {
        clickedButton.classList.add('active');
      }
      
      // إغلاق القائمة المحمولة إذا كانت مفتوحة
      if (mobileMenuOpen) {
        toggleMobileMenu();
      }
      
      // تحديث المحتوى حسب التبويب
      if (tabName === 'times') {
        updatePrayerTimes();
      } else if (tabName === 'qibla') {
        updateQiblaDirection();
      }
    }

    // تبديل القائمة المحمولة
    function toggleMobileMenu() {
      const navTabs = document.getElementById('nav-tabs');
      mobileMenuOpen = !mobileMenuOpen;
      
      if (mobileMenuOpen) {
        navTabs.classList.add('mobile-show');
      } else {
        navTabs.classList.remove('mobile-show');
      }
    }

    // اختيار خطوة الوضوء
    function selectWuduStep(stepNumber) {
      currentWuduStep = stepNumber;
      
      // تحديث العناصر النشطة
      const steps = document.querySelectorAll('#wudu-steps .step-item');
      steps.forEach(step => step.classList.remove('active'));
      if (steps[stepNumber - 1]) {
        steps[stepNumber - 1].classList.add('active');
      }
      
      // تحديث رقم الخطوة
      const stepNumberElement = document.getElementById('wudu-step-number');
      if (stepNumberElement) {
        stepNumberElement.textContent = stepNumber;
      }
      
      // تحديث شريط التقدم
      updateWuduProgress(stepNumber);
    }

    // تحديث شريط التقدم للوضوء
    function updateWuduProgress(step) {
      const progressFill = document.getElementById('wudu-progress');
      if (progressFill) {
        const circumference = 2 * Math.PI * 40;
        const progress = (step / 7) * circumference;
        progressFill.style.strokeDashoffset = circumference - progress;
      }
    }

    // تشغيل الصوت للخطوة الحالية
    function playStepAudio() {
      const stepText = audioTexts[currentLanguage].wudu_steps[currentWuduStep - 1];
      if (stepText) {
        speakText(stepText);
      }
    }

    // إعادة تعيين الوضوء
    function resetWudu() {
      currentWuduStep = 1;
      selectWuduStep(1);
    }

    // إيقاف الصوت
    function pauseAudio() {
      if (speechSynthesis.speaking) {
        speechSynthesis.cancel();
        document.body.style.filter = 'brightness(1)';
        document.querySelectorAll('.active-playing').forEach(btn => {
          btn.classList.remove('active-playing');
        });
        currentAudio = null;
      }
    }

    // تشغيل خطوات الصلاة
    function playPrayerStep(stepNumber) {
      const stepText = audioTexts[currentLanguage].prayer_steps[stepNumber - 1];
      if (stepText) {
        speakText(stepText);
        
        // تحديث العرض البصري
        const steps = document.querySelectorAll('.step-item');
        steps.forEach(step => step.classList.remove('active'));
        
        // البحث عن الخطوة في القسم الصحيح
        const prayerSection = document.querySelector('#prayer .card:first-child .step-list');
        if (prayerSection) {
          const prayerSteps = prayerSection.querySelectorAll('.step-item');
          if (prayerSteps[stepNumber - 1]) {
            prayerSteps[stepNumber - 1].classList.add('active');
          }
        }
      }
    }

    // تشغيل خطوات الصلاة المفصلة
    function playDetailedPrayerStep(stepNumber) {
      const stepText = audioTexts[currentLanguage].detailed_prayer_steps[stepNumber - 1];
      if (stepText) {
        speakText(stepText);
        
        // تحديث العرض البصري
        const prayerSection = document.querySelector('#prayer .card:last-child .step-list');
        if (prayerSection) {
          const steps = prayerSection.querySelectorAll('.step-item');
          steps.forEach(step => step.classList.remove('active'));
          if (steps[stepNumber - 1]) {
            steps[stepNumber - 1].classList.add('active');
          }
        }
      }
    }

    // تشغيل الأذان الحقيقي من Adhan API (mp3)
    async function playGeneralAdhan() {
      if (!navigator.geolocation) {
        showGpsAlert(currentLanguage === 'ar' ? 'متصفحك لا يدعم تحديد الموقع الجغرافي. يرجى تفعيل GPS.' : 'Your browser does not support geolocation. Please enable GPS.');
        return;
      }
      navigator.geolocation.getCurrentPosition(async position => {
        // يمكنك تخصيص mp3 حسب الوقت أو الاكتفاء بصوت ثابت
        const adhanMp3 = 'https://cdn.islamic.network/adhan/audio/128/ar.mishary.rashid.mp3';
        const audio = new Audio(adhanMp3);
        audio.play();
      }, () => {
        showGpsAlert(currentLanguage === 'ar' ? 'يرجى السماح بالوصول للموقع لتشغيل الأذان.' : 'Please allow location access to play the adhan.');
      });
    }

    // البحث عن القبلة
    function findQibla() {
      const searchingMsg = currentLanguage === 'ar' ? 
        'جاري تحديد موقعك وحساب اتجاه القبلة...' : 
        'Finding your location and calculating Qibla direction...';
      speakText(searchingMsg);
      const countrySelect = document.getElementById('country-select');
      let lat = null, lng = null;
      let usedCountry = false;
      if (countrySelect && countrySelect.value) {
        // مواقع تقريبية لعواصم بعض الدول
        const countryCoords = {
          MA: {lat: 33.5809, lng: -7.4923}, // المغرب - الدار البيضاء
          SA: {lat: 24.7136, lng: 46.6753}, // السعودية - الرياض
          EG: {lat: 30.0444, lng: 31.2357}, // مصر - القاهرة
          DZ: {lat: 36.7538, lng: 3.0588},  // الجزائر - الجزائر العاصمة
          AE: {lat: 25.2048, lng: 55.2708}, // الإمارات - دبي
          TR: {lat: 41.0082, lng: 28.9784}, // تركيا - اسطنبول
          FR: {lat: 48.8566, lng: 2.3522},  // فرنسا - باريس
          GB: {lat: 51.5074, lng: -0.1278}, // بريطانيا - لندن
          US: {lat: 40.7128, lng: -74.0060} // أمريكا - نيويورك
        };
        const coords = countryCoords[countrySelect.value];
        if (coords) {
          lat = coords.lat;
          lng = coords.lng;
          usedCountry = true;
        }
      }
      function afterCoords(lat, lng) {
        // مكة
        const makkah = {lat: 21.4225, lng: 39.8262};
        // حساب زاوية القبلة
        const d2r = deg => deg * Math.PI / 180;
        const r2d = rad => rad * 180 / Math.PI;
        const dLon = d2r(makkah.lng - lng);
        const lat1 = d2r(lat);
        const lat2 = d2r(makkah.lat);
        let y = Math.sin(dLon);
        let x = Math.cos(lat1) * Math.tan(lat2) - Math.sin(lat1) * Math.cos(dLon);
        let angle = Math.atan2(y, x);
        angle = r2d(angle);
        angle = (angle + 360) % 360;
        // حساب المسافة
        const R = 6371; // نصف قطر الأرض كم
        const dLat = d2r(makkah.lat - lat);
        const dLng = d2r(makkah.lng - lng);
        const a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(lat1) * Math.cos(lat2) * Math.sin(dLng/2) * Math.sin(dLng/2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        const distance = Math.round(R * c);
        // تحديث الواجهة
        document.getElementById('qibla-angle').textContent = angle.toFixed(0) + '°';
        document.getElementById('qibla-distance').textContent = distance + ' كم';
        document.getElementById('qibla-coords').textContent = lat.toFixed(4) + ', ' + lng.toFixed(4);
        // تدوير الإبرة حسب مستشعر الاتجاه إذا توفر
        const needle = document.getElementById('qibla-needle');
        if (needle) {
          // إزالة أي مستمع سابق
          if (window._qiblaOrientationListener) {
            window.removeEventListener('deviceorientationabsolute', window._qiblaOrientationListener);
            window.removeEventListener('deviceorientation', window._qiblaOrientationListener);
            window._qiblaOrientationListener = null;
          }
          let orientationSupported = false;
          window._qiblaOrientationListener = function(event) {
            let heading = null;
            if (typeof event.webkitCompassHeading !== 'undefined') {
              heading = event.webkitCompassHeading;
            } else if (typeof event.alpha !== 'undefined') {
              heading = 360 - event.alpha;
            }
            if (heading === null || isNaN(heading)) {
              needle.style.transform = `rotate(${angle}deg)`;
              return;
            }
            orientationSupported = true;
            let rotation = angle - heading;
            rotation = ((rotation % 360) + 360) % 360;
            needle.style.transform = `rotate(${rotation}deg)`;
          };
          if ('ondeviceorientationabsolute' in window) {
            window.addEventListener('deviceorientationabsolute', window._qiblaOrientationListener, true);
          } else if ('ondeviceorientation' in window) {
            window.addEventListener('deviceorientation', window._qiblaOrientationListener, true);
          }
          // fallback: إذا لم يدعم المستشعر
          setTimeout(function() {
            if (!orientationSupported) {
              needle.style.transform = `rotate(${angle}deg)`;
            }
          }, 1500);
        }
        // رسالة نجاح
        document.getElementById('qibla-success-msg').textContent = usedCountry
          ? (currentLanguage === 'ar' ? 'تم تحديد القبلة حسب الدولة المختارة.' : 'Qibla set by selected country.')
          : (currentLanguage === 'ar' ? 'تم تحديد موقعك بنجاح.' : 'Location determined successfully.');
        // تحديث نص القبلة
        const qiblaDir = document.getElementById('qibla-direction');
        if (qiblaDir) qiblaDir.textContent = angle.toFixed(0) + '°';
      }
      if (lat !== null && lng !== null) {
        afterCoords(lat, lng);
        return;
      }
      if (!navigator.geolocation) {
        showGpsAlert(currentLanguage === 'ar' ? 'متصفحك لا يدعم تحديد الموقع الجغرافي. يرجى تفعيل GPS.' : 'Your browser does not support geolocation. Please enable GPS.');
        return;
      }
      navigator.geolocation.getCurrentPosition(
        position => {
          lat = position.coords.latitude;
          lng = position.coords.longitude;
          afterCoords(lat, lng);
        },
        error => {
          showGpsAlert(currentLanguage === 'ar' ? 'لم يتمكن من تحديد موقعك. يرجى السماح بالوصول للموقع.' : 'Could not determine your location. Please allow location access.');
        }
      );
    }
function updateQiblaDirection() {
  if (!navigator.geolocation) {
    showGpsAlert(currentLanguage === 'ar' ? 'متصفحك لا يدعم تحديد الموقع الجغرافي. يرجى تفعيل GPS.' : 'Your browser does not support geolocation. Please enable GPS.');
    return;
  }
  navigator.geolocation.getCurrentPosition(async position => {
    const lat = position.coords.latitude;
    const lng = position.coords.longitude;
    try {
      const res = await fetch(`https://api.aladhan.com/v1/qibla/${lat}/${lng}`);
      const data = await res.json();
      if (data.code === 200) {
        const direction = Math.round(data.data.direction);
        const qiblaElement = document.getElementById('qibla-direction');
        if (qiblaElement) {
          qiblaElement.textContent = `${direction}°`;
        }
      }
    } catch (e) {}
  }, () => {
    showGpsAlert(currentLanguage === 'ar' ? 'لم يتمكن من تحديد موقعك. يرجى السماح بالوصول للموقع.' : 'Could not determine your location. Please allow location access.');
  });
}

    // تشغيل الأدعية
    function playDua(duaType) {
      const duaText = audioTexts[currentLanguage].duas[duaType];
      if (duaText) {
        speakText(duaText);
        
        // تأثير بصري
        const duaCard = event?.target?.closest('.dua-card');
        if (duaCard) {
          duaCard.classList.add('active-playing');
          setTimeout(() => {
            duaCard.classList.remove('active-playing');
          }, 3000);
        }
      }
    }

    // تكرار الدعاء
    function repeatDua(duaType) {
      const repeatMsg = currentLanguage === 'ar' ? 
        'تم تفعيل وضع التكرار' : 
        'Repeat mode activated';
      
      speakText(repeatMsg);
    }

    // بدء العداد
    // عداد خاص بالتسبيح
    let tasbihCounterValue = 0;
    function startCounter(counterId) {
      // جلب العدد المطلوب من input
      let target = parseInt(document.getElementById('tasbihTarget')?.value || '33');
      if (isNaN(target) || target < 1) target = 33;
      if (typeof window[counterId + 'Value'] === 'undefined') {
        window[counterId + 'Value'] = 0;
      }
      window[counterId + 'Value']++;
      const counterElement = document.getElementById(counterId);
      if (counterElement) {
        counterElement.textContent = window[counterId + 'Value'];
        counterElement.style.transform = 'scale(1.2)';
        setTimeout(() => {
          counterElement.style.transform = 'scale(1)';
        }, 200);
      }
      if (window[counterId + 'Value'] % target === 0) {
        const milestoneMsg = currentLanguage === 'ar' ?
          `مبارك! أكملت ${window[counterId + 'Value']} تكرار` :
          `Congratulations! You completed ${window[counterId + 'Value']} recitations`;
        speakText(milestoneMsg);
      }
    }

    // تشغيل الأذان العام
    function playGeneralAdhan() {
      const adhanMsg = currentLanguage === 'ar' ? 
        'تشغيل الأذان...' : 
        'Playing Adhan...';
      
      speakText(adhanMsg);
      
      // تأثير بصري
      const btn = event?.target;
      if (btn) {
        btn.classList.add('active-playing');
        setTimeout(() => {
          btn.classList.remove('active-playing');
        }, 5000);
      }
    }

    // تغيير اللغة
    function setLanguage(language) {
      currentLanguage = language;
      
      // تحديث أزرار اللغة
      document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      const langButton = document.getElementById(`lang-${language}`);
      if (langButton) {
        langButton.classList.add('active');
      }
      
      // تحديث قائمة الأصوات
      populateVoiceList();
      
      const langMsg = language === 'en' ? 
        'Language changed to English' : 
        'تم تغيير اللغة إلى العربية';
      
      showNotification(langMsg);
      speakText(langMsg);
    }

    // اختبار TTS
    function testTTS() {
      const testMsg = currentLanguage === 'ar' ? 
        'هذا اختبار للصوت - يعمل بشكل طبيعي' : 
        'This is a voice test - working normally';
      
      speakText(testMsg);
    }

    // كتم/إلغاء كتم الصوت
    function toggleMute() {
      isMuted = !isMuted;
      const icon = document.getElementById('mute-icon');
      
      if (isMuted) {
        if (icon) icon.className = 'fas fa-volume-mute';
        speechSynthesis.cancel(); // إيقاف أي صوت حالي
        showNotification(currentLanguage === 'ar' ? 'تم كتم الصوت' : 'Audio muted');
      } else {
        if (icon) icon.className = 'fas fa-volume-high';
        showNotification(currentLanguage === 'ar' ? 'تم إلغاء كتم الصوت' : 'Audio unmuted');
      }
    }

    // تبديل المظهر
    function toggleTheme() {
      const themeMsg = currentLanguage === 'ar' ? 
        'ميزة تغيير المظهر ستتوفر قريباً' : 
        'Theme switching feature coming soon';
      
      showNotification(themeMsg);
      speakText(themeMsg);
    }

    // إعادة تعيين الإعدادات
    function resetSettings() {
      currentLanguage = 'ar';
      isMuted = false;
      duaCounter = 0;
      ttsRate = 1;
      ttsPitch = 1;
      
      // إعادة تعيين واجهة اللغة
      document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      const arabicBtn = document.getElementById('lang-ar');
      if (arabicBtn) {
        arabicBtn.classList.add('active');
      }
      
      // إعادة تعيين العداد
      const counterElement = document.getElementById('counter');
      if (counterElement) {
        counterElement.textContent = '0';
      }
      
      // إعادة تعيين شرائح التحكم
      const rateSlider = document.getElementById('tts-rate');
      const pitchSlider = document.getElementById('tts-pitch');
      const rateValue = document.getElementById('tts-rate-value');
      const pitchValue = document.getElementById('tts-pitch-value');
      
      if (rateSlider) rateSlider.value = 1;
      if (pitchSlider) pitchSlider.value = 1;
      if (rateValue) rateValue.textContent = '1';
      if (pitchValue) pitchValue.textContent = '1';
      
      // إعادة تعيين أيقونة الكتم
      const muteIcon = document.getElementById('mute-icon');
      if (muteIcon) {
        muteIcon.className = 'fas fa-volume-high';
      }
      
      showNotification('تم إعادة تعيين جميع الإعدادات');
      speakText('تم إعادة تعيين جميع الإعدادات');
    }


    // تشغيل الصوت الترحيبي
    function playWelcomeAudio() {
      speakText(audioTexts[currentLanguage].welcome);
    }

    // تحديث مواقيت الصلاة باستخدام GPS وAdhan API
    function updatePrayerTimes() {
      if (!navigator.geolocation) {
        showNotification(currentLanguage === 'ar' ? 'متصفحك لا يدعم تحديد الموقع' : 'Your browser does not support geolocation');
        return;
      }
      // طلب تفعيل GPS من المستخدم برسالة واضحة
      showNotification(currentLanguage === 'ar' ? 'يرجى تفعيل GPS والموافقة على تحديد الموقع للحصول على مواقيت الصلاة بدقة' : 'Please enable GPS and allow location access for accurate prayer times');
      navigator.geolocation.getCurrentPosition(
        position => {
          const lat = position.coords.latitude;
          const lng = position.coords.longitude;
          const today = new Date();
          const day = today.getDate();
          const month = today.getMonth() + 1;
          const year = today.getFullYear();
          const url = `https://api.aladhan.com/v1/timings/${day}-${month}-${year}?latitude=${lat}&longitude=${lng}&method=5&school=0&lang=${currentLanguage}`;
          fetch(url)
            .then(res => res.json())
            .then(data => {
              if (data.code !== 200) throw new Error('API Error');
              const timings = data.data.timings;
              document.getElementById('fajr-time').textContent = timings.Fajr;
              document.getElementById('sunrise-time').textContent = timings.Sunrise;
              document.getElementById('dhuhr-time').textContent = timings.Dhuhr;
              document.getElementById('asr-time').textContent = timings.Asr;
              document.getElementById('maghrib-time').textContent = timings.Maghrib;
              document.getElementById('isha-time').textContent = timings.Isha;
              highlightCurrentPrayer(timings);
            })
            .catch(() => {
              showNotification(currentLanguage === 'ar' ? 'تعذر جلب مواقيت الصلاة' : 'Could not fetch prayer times');
            });
        },
        error => {
          if (error.code === error.PERMISSION_DENIED) {
            showNotification(currentLanguage === 'ar' ? 'يرجى السماح بالوصول إلى الموقع من إعدادات المتصفح أو النظام' : 'Please allow location access from your browser or system settings');
          } else if (error.code === error.POSITION_UNAVAILABLE) {
            showNotification(currentLanguage === 'ar' ? 'تعذر تحديد موقعك. تأكد من تفعيل GPS.' : 'Location unavailable. Please enable GPS.');
          } else if (error.code === error.TIMEOUT) {
            showNotification(currentLanguage === 'ar' ? 'انتهت مهلة تحديد الموقع. حاول مجدداً.' : 'Location request timed out. Please try again.');
          } else {
            showNotification(currentLanguage === 'ar' ? 'تعذر تحديد موقعك' : 'Could not determine your location');
          }
        }
      );
    }

    // تمييز الصلاة الحالية بناءً على الوقت
    function highlightCurrentPrayer(timings) {
      const now = new Date();
      const toMinutes = t => {
        const [h, m] = t.split(':');
        return parseInt(h) * 60 + parseInt(m);
      };
      const currentMins = now.getHours() * 60 + now.getMinutes();
      const prayerOrder = [
        { id: 'fajr-time', time: timings.Fajr },
        { id: 'sunrise-time', time: timings.Sunrise },
        { id: 'dhuhr-time', time: timings.Dhuhr },
        { id: 'asr-time', time: timings.Asr },
        { id: 'maghrib-time', time: timings.Maghrib },
        { id: 'isha-time', time: timings.Isha }
      ];
      let currentIdx = 0;
      for (let i = 0; i < prayerOrder.length; i++) {
        if (currentMins >= toMinutes(prayerOrder[i].time)) {
          currentIdx = i;
        }
      }
      document.querySelectorAll('.prayer-time').forEach((el, idx) => {
        el.classList.toggle('current', idx === currentIdx);
      });
    }

    // تحديث اتجاه القبلة وتحريك الإبرة بدقة حسب مستشعر الهاتف
    let qiblaAngle = null;
    let deviceOrientationListener = null;
    function updateQiblaDirection() {
      if (!navigator.geolocation) {
        showNotification(currentLanguage === 'ar' ? 'متصفحك لا يدعم تحديد الموقع' : 'Your browser does not support geolocation');
        return;
      }
      showNotification(currentLanguage === 'ar' ? 'يرجى السماح بالوصول إلى الموقع لتحديد اتجاه القبلة' : 'Please allow location access to determine Qibla direction');
      navigator.geolocation.getCurrentPosition(
        position => {
          const lat = position.coords.latitude;
          const lng = position.coords.longitude;
          fetch(`https://api.aladhan.com/v1/qibla/${lat}/${lng}`)
            .then(res => res.json())
            .then(data => {
              if (data.code === 200) {
                qiblaAngle = data.data.direction; // زاوية القبلة الحقيقية
                const direction = Math.round(qiblaAngle);
                const qiblaElement = document.getElementById('qibla-direction');
                if (qiblaElement) {
                  qiblaElement.textContent = `${direction}°`;
                }
                showNotification((currentLanguage === 'ar' ? 'اتجاه القبلة: ' : 'Qibla direction: ') + direction + '°');
                setupCompassNeedle();
              } else {
                showNotification(currentLanguage === 'ar' ? 'تعذر جلب اتجاه القبلة' : 'Could not fetch Qibla direction');
              }
            })
            .catch(() => {
              showNotification(currentLanguage === 'ar' ? 'تعذر جلب اتجاه القبلة' : 'Could not fetch Qibla direction');
            });
        },
        () => {
          showNotification(currentLanguage === 'ar' ? 'تعذر تحديد موقعك' : 'Could not determine your location');
        }
      );
    }

    // تحريك إبرة القبلة بدقة: الإبرة تشير دائماً إلى اتجاه القبلة الحقيقي
    function setupCompassNeedle() {
      // إزالة أي مستمع سابق
      if (deviceOrientationListener) {
        window.removeEventListener('deviceorientationabsolute', deviceOrientationListener);
        window.removeEventListener('deviceorientation', deviceOrientationListener);
        deviceOrientationListener = null;
      }
      const needle = document.querySelector('.compass-needle');
      if (!needle || qiblaAngle === null) return;

      let orientationSupported = false;
      // مستمع جديد
      deviceOrientationListener = function(event) {
        let heading = null;
        // iOS/Safari
        if (typeof event.webkitCompassHeading !== 'undefined') {
          heading = event.webkitCompassHeading;
        } else if (typeof event.alpha !== 'undefined') {
          // معظم أجهزة أندرويد
          // alpha: 0 = الشمال الحقيقي
          heading = 360 - event.alpha;
        }
        if (heading === null || isNaN(heading)) {
          // إذا لم يكن هناك مستشعر أو رفض المستخدم الإذن
          showGpsAlert(currentLanguage === 'ar' ? 'يرجى تفعيل مستشعر الاتجاه (البوصلة) والسماح بالوصول للموقع من إعدادات الهاتف.' : 'Please enable orientation sensor (compass) and allow location access from your phone settings.');
          return;
        }
        orientationSupported = true;
        // الزاوية المطلوبة: الفرق بين زاوية القبلة وheading (الشمال)
        let rotation = qiblaAngle - heading;
        // تصحيح الدوران ليبقى بين 0 و 360
        rotation = ((rotation % 360) + 360) % 360;
        needle.style.transform = `rotate(${rotation}deg)`;
        // إخفاء التنبيه إذا كان ظاهراً
        hideGpsAlert();
      };
      // دعم الأحداث المختلفة حسب المتصفح
      if ('ondeviceorientationabsolute' in window) {
        window.addEventListener('deviceorientationabsolute', deviceOrientationListener, true);
      } else if ('ondeviceorientation' in window) {
        window.addEventListener('deviceorientation', deviceOrientationListener, true);
      }

      // إذا لم يتم دعم المستشعر، تدوير الإبرة مباشرة إلى زاوية القبلة مع تنبيه المستخدم
      setTimeout(function() {
        if (!orientationSupported) {
          needle.style.transform = `rotate(${qiblaAngle}deg)`;
          showGpsAlert(currentLanguage === 'ar' ? 'جهازك لا يدعم مستشعر الاتجاه أو لم يتم تفعيله. ستظهر القبلة بشكل تقريبي فقط.' : 'Your device does not support orientation sensor or it is not enabled. Qibla direction will be approximate only.');
        }
      }, 1500); // انتظر قليلاً للتأكد من عدم وجود مستشعر
    }

    // معالجة أحداث التحكم في TTS
    function setupTTSControls() {
      const voiceSelect = document.getElementById('tts-voice-select');
      const rateSlider = document.getElementById('tts-rate');
      const pitchSlider = document.getElementById('tts-pitch');
      const rateValue = document.getElementById('tts-rate-value');
      const pitchValue = document.getElementById('tts-pitch-value');

      if (voiceSelect) {
        voiceSelect.addEventListener('change', function() {
          const selectedVoice = availableVoices.find(voice => voice.name === this.value);
          if (selectedVoice) {
            ttsVoice = selectedVoice;
          }
        });
      }

      if (rateSlider && rateValue) {
        rateSlider.addEventListener('input', function() {
          ttsRate = parseFloat(this.value);
          rateValue.textContent = ttsRate.toFixed(1);
        });
      }

      if (pitchSlider && pitchValue) {
        pitchSlider.addEventListener('input', function() {
          ttsPitch = parseFloat(this.value);
          pitchValue.textContent = ttsPitch.toFixed(1);
        });
      }
    }

    // تهيئة التطبيق عند التحميل
    document.addEventListener('DOMContentLoaded', function() {
      // تهيئة TTS
      initializeTTS();
      
      // إعداد عناصر التحكم
      setupTTSControls();
      
      // تحديث مواقيت الصلاة
      updatePrayerTimes();
      
      // تحديث شريط تقدم الوضوء
      updateWuduProgress(1);
      
      // إعداد التحديث التلقائي للوقت
      setInterval(updatePrayerTimes, 60000); // كل دقيقة
      
      // رسالة ترحيب
      setTimeout(() => {
        const welcomeMsg = currentLanguage === 'ar' ? 
          'مرحباً بك! اختر القسم الذي تريد التعلم منه' : 
          'Welcome! Choose the section you want to learn from';
        showNotification(welcomeMsg);
      }, 1000);

      // زر تحديث المواقيت اليدوي
      const refreshBtn = document.getElementById('refresh-prayer-times');
      if (refreshBtn) {
        refreshBtn.addEventListener('click', function() {
          document.getElementById('prayer-times-msg').textContent = currentLanguage === 'ar' ? 'جاري تحديث المواقيت...' : 'Updating prayer times...';
          updatePrayerTimes();
          setTimeout(() => { document.getElementById('prayer-times-msg').textContent = ''; }, 4000);
        });
      }
    });

    // التعامل مع تغيير حجم الشاشة
    window.addEventListener('resize', function() {
      // إغلاق القائمة المحمولة عند تكبير الشاشة
      if (window.innerWidth > 768 && mobileMenuOpen) {
        toggleMobileMenu();
      }
    });

    // منع النقر المتعدد السريع
    let clickTimeout = false;
    document.addEventListener('click', function(e) {
      if (clickTimeout) return;
      clickTimeout = true;
      setTimeout(() => clickTimeout = false, 300);
    });

    // تأثيرات إضافية للتفاعل
    document.addEventListener('mousemove', function(e) {
      const floatingShapes = document.querySelectorAll('.floating-shape');
      floatingShapes.forEach((shape, index) => {
        const speed = 0.02 + (index * 0.01);
        const x = (e.clientX * speed) - (shape.offsetWidth / 2);
        const y = (e.clientY * speed) - (shape.offsetHeight / 2);
        
        shape.style.transform = `translate(${x}px, ${y}px)`;
      });
    });

    // معالجة أخطاء JavaScript: إخفاء التفاصيل عن المستخدم وعرض رسالة ودية فقط
    window.addEventListener('error', function(e) {
      // لا تظهر أي تفاصيل تقنية للمستخدم
      const friendlyMsg = currentLanguage === 'ar'
        ? 'حدث خلل بسيط، يرجى إعادة المحاولة أو تحديث الصفحة.'
        : 'A minor issue occurred, please try again or refresh the page.';
      showNotification(friendlyMsg);
      // سجل الخطأ للمطور فقط
      if (window.console && window.console.error) {
        console.error('JavaScript Error:', e.error || e);
      }
      // منع ظهور رسالة الخطأ الافتراضية
      return true;
    });

    // تصدير الدوال للاستخدام العام
    window.prayerGuideApp = {
      showTab,
      toggleMobileMenu,
      selectWuduStep,
      playStepAudio,
      resetWudu,
      pauseAudio,
      playPrayerStep,
      playDetailedPrayerStep,
      playAdhanSheikh,
      findQibla,
      calibrateCompass,
      playDua,
      repeatDua,
      startCounter,
      playGeneralAdhan,
      setLanguage,
      testTTS,
      toggleMute,
      toggleTheme,
      resetSettings,
      showNotification,
      playWelcomeAudio,
      speakText
    };

    // إضافة معالج للتحكم في الأصوات عند إغلاق الصفحة
    window.addEventListener('beforeunload', function() {
      if (speechSynthesis.speaking) {
        speechSynthesis.cancel();
      }
    });

    // إضافة معالج لإيقاف الصوت عند تغيير التبويب
    document.addEventListener('visibilitychange', function() {
      if (document.hidden && speechSynthesis.speaking) {
        speechSynthesis.pause();
      } else if (!document.hidden && speechSynthesis.paused) {
        speechSynthesis.resume();
      }
    });

    // معالج خاص للأجهزة المحمولة
    if ('ontouchstart' in window) {
      // إضافة دعم اللمس للعناصر التفاعلية
      document.querySelectorAll('.audio-btn, .nav-tab, .step-item, .card').forEach(element => {
        element.addEventListener('touchstart', function() {
          this.style.transform = 'scale(0.95)';
        });
        
        element.addEventListener('touchend', function() {
          this.style.transform = 'scale(1)';
        });
      });
    }

    // دالة مساعدة لتحديد ما إذا كان المتصفح يدعم TTS
    function isTTSSupported() {
      return 'speechSynthesis' in window && 'SpeechSynthesisUtterance' in window;
    }

    // دالة مساعدة للحصول على أفضل صوت للغة المحددة
    function getBestVoiceForLanguage(lang) {
      if (!isTTSSupported()) return null;
      
      const voices = speechSynthesis.getVoices();
      
      // البحث عن صوت بنفس اللغة
      let voice = voices.find(v => v.lang.startsWith(lang));
      
      // البحث عن صوت افتراضي إذا لم يوجد
      if (!voice) {
        voice = voices.find(v => v.default);
      }
      
      // استخدام أول صوت متاح كحل أخير
      if (!voice && voices.length > 0) {
        voice = voices[0];
      }
      
      return voice;
    }

    // تحسين دالة تهيئة TTS
    function enhancedInitializeTTS() {
      if (!isTTSSupported()) {
        const msg = currentLanguage === 'ar' ? 
          'متصفحك لا يدعم ميزة تحويل النص إلى كلام' :
          'Your browser does not support text-to-speech';
        document.getElementById('tts-support-msg').textContent = msg;
        return;
      }

      // تحديث الأصوات مع محاولات متعددة
      let attempts = 0;
      const maxAttempts = 3;
      
      function tryLoadVoices() {
        const voices = speechSynthesis.getVoices();
        
        if (voices.length > 0) {
          availableVoices = voices;
          populateVoiceList();
          
          // تحديد أفضل صوت للغة الحالية
          const bestVoice = getBestVoiceForLanguage(currentLanguage === 'ar' ? 'ar' : 'en');
          if (bestVoice) {
            ttsVoice = bestVoice;
            const voiceSelect = document.getElementById('tts-voice-select');
            if (voiceSelect) {
              voiceSelect.value = bestVoice.name;
            }
          }
        } else if (attempts < maxAttempts) {
          attempts++;
          setTimeout(tryLoadVoices, 500);
        }
      }

      // محاولة تحميل الأصوات
      if (speechSynthesis.onvoiceschanged !== undefined) {
        speechSynthesis.onvoiceschanged = tryLoadVoices;
      }
      
      // محاولة فورية أيضاً
      tryLoadVoices();
    }

    // استبدال دالة initializeTTS بالنسخة المحسّنة
    initializeTTS = enhancedInitializeTTS;
  </script>
  <script>

    // نص إلى صوت لشرح كتاب الصلاة (تشغيل/إيقاف) عبر أيقونة واحدة
    var introTTSPlaying = false;
    var introTTSUtterance = null;
    var introText = `الصلاة في اللغة تعني الدعاء، وهي من الجذر الثلاثي (ص ل و). أما في الاصطلاح الشرعي، فالصلاة عبادة تتضمن أقوالًا وأفعالًا مخصوصة، تبدأ بالتكبير وتنتهي بالتسليم، وتؤدى بشروط وأركان معلومة في أوقات محددة، وهي الركن الثاني من أركان الإسلام بعد الشهادتين. تعد الصلاة أعظم العبادات البدنية، وهي الصلة اليومية التي تربط العبد بربه، تربي في النفس الخشوع، وفي القلب الطمأنينة، وفي السلوك الاتزان. كما أنها أول ما يُحاسب عليه العبد يوم القيامة، فإن صلحت صلح سائر العمل، وإن فسدت فسد سائر العمل. بعد الإلمام بهذا التعريف، يمكن الانتقال إلى دراسة تبويبات كتاب الصلاة التي تشمل الأذان، شروط الصلاة، صفتها، أركانها، أحكام السهو، النوافل، وصلاة الجماعة والجمعة والعيدين وغيرها، وهي تبويبات تهدف إلى فهم هذه العبادة فهمًا منهجيًا يجمع بين الجانب العلمي والعملي.`;
    function toggleIntroTTS() {
      var synth = window.speechSynthesis;
      var btn = document.getElementById('intro-tts-btn');
      var icon = document.getElementById('intro-tts-icon');
      if (!introTTSPlaying) {
        if (synth.speaking) synth.cancel();
        introTTSUtterance = new SpeechSynthesisUtterance(introText);
        introTTSUtterance.lang = 'ar-SA';
        introTTSUtterance.rate = 1;
        introTTSUtterance.onend = function() {
          introTTSPlaying = false;
          icon.className = 'fas fa-play-circle';
        };
        synth.speak(introTTSUtterance);
        introTTSPlaying = true;
        icon.className = 'fas fa-pause-circle';
      } else {
        synth.cancel();
        introTTSPlaying = false;
        icon.className = 'fas fa-play-circle';
      }
    }

    // تحويل نص الجدول إلى صوت باستخدام Web Speech API
    var synth = window.speechSynthesis;
    var currentUtterance = null;
    function speakText(text) {
      if (synth.speaking) {
        synth.cancel();
      }
      var utter = new SpeechSynthesisUtterance(text);
      utter.lang = 'ar-SA';
      utter.rate = 1;
      currentUtterance = utter;
      synth.speak(utter);
    }
  </script>
  </body>
</html>