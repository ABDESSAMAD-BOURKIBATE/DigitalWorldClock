<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>دليل الصلاة التفاعلي</title>
  <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    /* قواعد responsive أساسية لجميع الأجهزة */
    html, body {
      max-width: 100vw;
      overflow-x: hidden;
    }
    @media (max-width: 600px) {
      body {
        font-size: 15px;
      }
      .container {
        padding: 5px !important;
      }
      .hero-card, .card {
        padding: 10px !important;
      }
      h1, h2, h3 {
        font-size: 1.2em !important;
      }
    }
    :root {
      --primary-gold: linear-gradient(135deg, #ffd700 0%, #ffb347 100%);
      --secondary-gold: linear-gradient(135deg, #ffb347 0%, #ffa500 100%);
      --dark-gold: linear-gradient(135deg, #daa520 0%, #b8860b 100%);
      --light-gold: linear-gradient(135deg, #fff8dc 0%, #fffacd 100%);
      --dark-bg: #1a1a1a;
      --darker-bg: #0f0f0f;
      --card-bg: rgba(255, 215, 0, 0.1);
      --text-light: #ffffff;
      --text-gold: #ffd700;
      --accent: #ff6b35;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Cairo', sans-serif;
      background: var(--darker-bg);
      background-image: 
        radial-gradient(circle at 20% 50%, rgba(255, 215, 0, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(255, 179, 71, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 80%, rgba(218, 165, 32, 0.1) 0%, transparent 50%);
      color: var(--text-light);
      overflow-x: hidden;
      min-height: 100vh;
    }

    .header {
      background: rgba(26, 26, 26, 0.95);
      backdrop-filter: blur(20px);
      padding: 15px 0;
      position: fixed;
      width: 100%;
      top: 0;
      z-index: 1000;
      box-shadow: 0 8px 32px rgba(255, 215, 0, 0.2);
      border-bottom: 2px solid rgba(255, 215, 0, 0.3);
    }

    .nav-container {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 20px;
    }

    .logo {
      font-family: 'Amiri', serif;
      font-size: 28px;
      font-weight: 700;
      background: var(--primary-gold);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
    }

    .nav-tabs {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .nav-tab {
      padding: 12px 18px;
      background: rgba(255, 215, 0, 0.1);
      border: 2px solid rgba(255, 215, 0, 0.3);
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Cairo', sans-serif;
      font-weight: 600;
      color: var(--text-gold);
      backdrop-filter: blur(10px);
      font-size: 14px;
    }

    .nav-tab:hover, .nav-tab.active {
      background: var(--primary-gold);
      color: var(--darker-bg);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
      border-color: #ffd700;
    }

    .menu-toggle {
      display: none;
      background: rgba(255, 215, 0, 0.1);
      border: 2px solid rgba(255, 215, 0, 0.3);
      border-radius: 10px;
      color: var(--text-gold);
      font-size: 18px;
      padding: 10px 12px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .menu-toggle:hover {
      background: var(--primary-gold);
      color: var(--darker-bg);
    }

    .container {
      max-width: 1200px;
      margin: 100px auto 60px;
      padding: 0 20px;
    }

    .tab-content {
      display: none;
      animation: fadeInUp 0.6s ease;
    }

    .tab-content.active {
      display: block;
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .hero-card {
      background: rgba(26, 26, 26, 0.8);
      backdrop-filter: blur(20px);
      border-radius: 25px;
      padding: 40px;
      margin-bottom: 30px;
      box-shadow: 0 20px 60px rgba(255, 215, 0, 0.1);
      border: 2px solid rgba(255, 215, 0, 0.3);
      position: relative;
      overflow: hidden;
    }

    .hero-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--primary-gold);
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 25px;
      margin-bottom: 30px;
    }

    .card {
      background: rgba(26, 26, 26, 0.8);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
      border: 2px solid rgba(255, 215, 0, 0.3);
      position: relative;
      overflow: hidden;
    }

    .card:hover {
      transform: translateY(-10px);
      box-shadow: 0 25px 50px rgba(255, 215, 0, 0.2);
      border-color: #ffd700;
    }

    .card-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--primary-gold);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 20px;
      color: var(--darker-bg);
      font-size: 24px;
      box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
    }

    .card-title {
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 15px;
      color: var(--text-gold);
    }

    .step-list {
      list-style: none;
      padding: 0;
    }

    .step-item {
      display: flex;
      align-items: center;
      padding: 15px;
      margin-bottom: 10px;
      background: rgba(255, 215, 0, 0.1);
      border-radius: 15px;
      transition: all 0.3s ease;
      cursor: pointer;
      border-right: 4px solid #ffd700;
    }

    .step-item:hover, .step-item.active {
      background: rgba(255, 215, 0, 0.2);
      transform: translateX(-10px);
      box-shadow: 0 5px 20px rgba(255, 215, 0, 0.2);
    }

    .step-number {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: var(--primary-gold);
      color: var(--darker-bg);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-left: 15px;
      font-weight: 700;
    }

    .prayer-times {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }

    .prayer-time {
      background: rgba(26, 26, 26, 0.8);
      backdrop-filter: blur(15px);
      padding: 20px;
      border-radius: 15px;
      text-align: center;
      transition: all 0.3s ease;
      border: 2px solid rgba(255, 215, 0, 0.3);
    }

    .prayer-time:hover, .prayer-time.current {
      border-color: #ffd700;
      transform: scale(1.05);
      box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
    }

    .prayer-time.current {
      background: var(--primary-gold);
      color: var(--darker-bg);
    }

    .prayer-name {
      font-weight: 700;
      font-size: 16px;
      margin-bottom: 10px;
    }

    .prayer-time-value {
      font-size: 20px;
      font-weight: 700;
      font-family: 'Amiri', serif;
    }

    .qibla-compass {
      width: 200px;
      height: 200px;
      margin: 30px auto;
      position: relative;
      background: conic-gradient(from 0deg, #ffd700, #ffb347, #ffd700);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      animation: rotate 20s linear infinite;
      box-shadow: 0 0 50px rgba(255, 215, 0, 0.3);
    }

    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .compass-inner {
      width: 160px;
      height: 160px;
      background: var(--darker-bg);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      box-shadow: inset 0 0 30px rgba(255, 215, 0, 0.2);
      border: 2px solid rgba(255, 215, 0, 0.5);
    }

    .compass-needle {
      width: 4px;
      height: 60px;
      background: linear-gradient(to top, #ff6b35, #ffd700);
      border-radius: 2px;
      position: absolute;
      top: 50px;
      transform-origin: bottom center;
    }

    .dua-card {
      background: rgba(26, 26, 26, 0.8);
      border: 2px solid rgba(255, 215, 0, 0.5);
      border-radius: 20px;
      padding: 25px;
      margin-bottom: 20px;
      position: relative;
      transition: all 0.3s ease;
    }

    .dua-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(255, 215, 0, 0.2);
      border-color: #ffd700;
    }

    .dua-text {
      font-family: 'Amiri', serif;
      font-size: 18px;
      line-height: 1.8;
      text-align: center;
      margin-bottom: 15px;
      color: var(--text-light);
    }

    .audio-controls {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .audio-btn {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--primary-gold);
      border: none;
      color: var(--darker-bg);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      font-size: 18px;
      position: relative;
    }

    .audio-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
    }

    .progress-circle {
      width: 100px;
      height: 100px;
      margin: 20px auto;
      position: relative;
    }

    .progress-ring {
      transform: rotate(-90deg);
    }

    .progress-ring-circle {
      stroke: rgba(255, 215, 0, 0.3);
      stroke-width: 8;
      fill: transparent;
      r: 40;
      cx: 50;
      cy: 50;
    }

    .progress-ring-fill {
      stroke: #ffd700;
      stroke-width: 8;
      fill: transparent;
      r: 40;
      cx: 50;
      cy: 50;
      stroke-dasharray: 251.2;
      stroke-dashoffset: 251.2;
      transition: stroke-dashoffset 0.5s ease;
    }

    .floating-action {
      position: fixed;
      bottom: 30px;
      left: 30px;
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background: var(--primary-gold);
      border: none;
      color: var(--darker-bg);
      font-size: 24px;
      cursor: pointer;
      box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
      transition: all 0.3s ease;
      z-index: 1000;
    }

    .floating-action:hover {
      transform: scale(1.1) rotate(15deg);
      box-shadow: 0 12px 35px rgba(255, 215, 0, 0.6);
    }

    .notification {
      position: fixed;
      top: 100px;
      left: 20px;
      background: rgba(26, 26, 26, 0.95);
      backdrop-filter: blur(20px);
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      border-right: 4px solid #ffd700;
      transform: translateX(-400px);
      transition: all 0.3s ease;
      z-index: 1001;
      max-width: 300px;
      border: 2px solid rgba(255, 215, 0, 0.3);
    }

    .notification.show {
      transform: translateX(0);
    }

    .counter-badge {
      position: absolute;
      top: -10px;
      right: -10px;
      background: #ff6b35;
      color: white;
      border-radius: 50%;
      width: 25px;
      height: 25px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 700;
    }

    .adhan-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .sheikh-card {
      background: rgba(26, 26, 26, 0.8);
      border: 2px solid rgba(255, 215, 0, 0.3);
      border-radius: 20px;
      padding: 25px;
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .sheikh-card:hover {
      transform: translateY(-5px);
      border-color: #ffd700;
      box-shadow: 0 15px 40px rgba(255, 215, 0, 0.2);
    }

    .sheikh-image {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background: var(--primary-gold);
      margin: 0 auto 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 25px;
      color: var(--darker-bg);
    }

    .sheikh-name {
      font-size: 16px;
      font-weight: 700;
      color: var(--text-gold);
      margin-bottom: 10px;
    }

    .sheikh-description {
      font-size: 13px;
      color: var(--text-light);
      opacity: 0.8;
      margin-bottom: 15px;
    }

    .language-section {
      background: rgba(26, 26, 26, 0.8);
      backdrop-filter: blur(20px);
      border-radius: 25px;
      padding: 40px;
      margin-bottom: 30px;
      box-shadow: 0 20px 60px rgba(255, 215, 0, 0.1);
      border: 2px solid rgba(255, 215, 0, 0.3);
      text-align: center;
    }

    .language-toggle {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 30px;
      flex-wrap: wrap;
    }

    .lang-btn {
      padding: 15px 30px;
      background: rgba(255, 215, 0, 0.1);
      border: 2px solid rgba(255, 215, 0, 0.3);
      border-radius: 25px;
      color: var(--text-gold);
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 16px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .lang-btn.active, .lang-btn:hover {
      background: var(--primary-gold);
      color: var(--darker-bg);
      border-color: #ffd700;
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
    }

    .footer {
      background: rgba(26, 26, 26, 0.95);
      backdrop-filter: blur(20px);
      padding: 30px 0;
      text-align: center;
      border-top: 2px solid rgba(255, 215, 0, 0.3);
      margin-top: 50px;
    }

    .footer-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    .developer-info {
      color: var(--text-gold);
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .copyright {
      color: var(--text-light);
      opacity: 0.8;
      font-size: 14px;
    }

    .floating-shape {
      position: absolute;
      background: rgba(255, 215, 0, 0.1);
      border-radius: 50%;
      animation: float 15s ease-in-out infinite;
    }

    .floating-shape:nth-child(1) { width: 60px; height: 60px; top: 20%; right: 10%; animation-delay: 0s; }
    .floating-shape:nth-child(2) { width: 40px; height: 40px; top: 60%; right: 80%; animation-delay: 3s; }
    .floating-shape:nth-child(3) { width: 80px; height: 80px; top: 80%; right: 20%; animation-delay: 6s; }

    @keyframes float {
      0%, 100% { transform: translate(0, 0) rotate(0deg); }
      33% { transform: translate(30px, -30px) rotate(120deg); }
      66% { transform: translate(-20px, 20px) rotate(240deg); }
    }

    .active-playing {
      animation: pulse 1s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .settings-section {
      margin-bottom: 30px;
      padding: 20px;
      background: rgba(255, 215, 0, 0.05);
      border-radius: 15px;
      border: 1px solid rgba(255, 215, 0, 0.2);
    }

    .settings-section h3 {
      color: var(--text-gold);
      margin-bottom: 15px;
      font-size: 18px;
    }

    .control-group {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      align-items: center;
      justify-content: center;
      margin-bottom: 15px;
    }

    .control-group label {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--text-light);
      font-size: 14px;
    }

    .control-group select,
    .control-group input[type="range"] {
      padding: 8px 12px;
      border-radius: 8px;
      border: 2px solid rgba(255, 215, 0, 0.3);
      background: rgba(26, 26, 26, 0.8);
      color: var(--text-light);
      font-size: 14px;
    }

    .control-group input[type="range"] {
      width: 100px;
    }

    .range-value {
      background: var(--primary-gold);
      color: var(--darker-bg);
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      min-width: 35px;
      text-align: center;
    }

    /* تحسينات للأجهزة المحمولة */
    @media (max-width: 768px) {
      .nav-tabs { 
        display: none;
      }
      
      .menu-toggle {
        display: block;
      }
      
      .nav-tabs.mobile-show {
        display: flex;
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: rgba(26, 26, 26, 0.98);
        backdrop-filter: blur(20px);
        flex-direction: column;
        padding: 20px;
        gap: 10px;
        border-top: 2px solid rgba(255, 215, 0, 0.3);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      }
      
      .nav-tab { 
        padding: 15px 20px; 
        font-size: 16px;
        justify-content: center;
        width: 100%;
      }
      
      .hero-card { 
        padding: 25px;
        margin-bottom: 20px;
      }
      
      .grid { 
        grid-template-columns: 1fr;
        gap: 15px;
      }
      
      .qibla-compass { 
        width: 180px; 
        height: 180px; 
      }
      
      .compass-inner { 
        width: 140px; 
        height: 140px; 
      }
      
      .compass-needle {
        height: 50px;
        top: 45px;
      }
      
      .container {
        margin-top: 90px;
        padding: 0 15px;
      }
      
      .prayer-times {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
      }
      
      .prayer-time {
        padding: 15px 10px;
      }
      
      .prayer-name {
        font-size: 14px;
      }
      
      .prayer-time-value {
        font-size: 18px;
      }
      
      .adhan-section {
        grid-template-columns: 1fr;
        gap: 15px;
      }
      
      .sheikh-card {
        padding: 20px;
      }
      
      .sheikh-image {
        width: 60px;
        height: 60px;
        font-size: 20px;
      }
      
      .sheikh-name {
        font-size: 15px;
      }
      
      .sheikh-description {
        font-size: 12px;
      }
      
      .dua-text {
        font-size: 16px;
      }
      
      .language-toggle {
        flex-direction: column;
        gap: 15px;
        align-items: center;
      }
      
      .lang-btn {
        width: 100%;
        max-width: 250px;
        justify-content: center;
      }
      
      .floating-action {
        bottom: 20px;
        left: 20px;
        width: 60px;
        height: 60px;
        font-size: 20px;
      }
      
      .notification {
        left: 10px;
        right: 10px;
        max-width: none;
      }
      
      .step-item {
        padding: 12px;
        font-size: 14px;
      }
      
      .step-number {
        width: 25px;
        height: 25px;
        font-size: 12px;
        margin-left: 10px;
      }
      
      .card-title {
        font-size: 18px;
      }
      
      .card {
        padding: 20px;
      }
      
      .card-icon {
        width: 50px;
        height: 50px;
        font-size: 20px;
      }

      .control-group {
        flex-direction: column;
        align-items: stretch;
      }

      .control-group label {
        justify-content: space-between;
      }
    }

    @media (max-width: 480px) {
      .logo {
        font-size: 20px;
      }
      
      .hero-card {
        padding: 15px;
      }
      
      .card {
        padding: 15px;
      }
      
      .qibla-compass {
        width: 150px;
        height: 150px;
      }
      
      .compass-inner {
        width: 120px;
        height: 120px;
      }
      
      .dua-text {
        font-size: 14px;
      }
      
      .audio-btn {
        width: 40px;
        height: 40px;
        font-size: 16px;
      }
      
      .progress-circle {
        width: 80px;
        height: 80px;
      }
      
      .floating-shape {
        display: none;
      }
    }

    /* تحسينات للأجهزة اللوحية */
    @media (min-width: 769px) and (max-width: 1024px) {
      .grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .adhan-section {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .prayer-times {
        grid-template-columns: repeat(3, 1fr);
      }
      
      .container {
        padding: 0 25px;
      }
    }

    /* تحسينات للشاشات الكبيرة */
    @media (min-width: 1200px) {
      .grid {
        grid-template-columns: repeat(3, 1fr);
      }
      
      .adhan-section {
        grid-template-columns: repeat(3, 1fr);
      }
      
      .prayer-times {
        grid-template-columns: repeat(6, 1fr);
      }
      
      .container {
        padding: 0 40px;
      }
    }
  </style>
</head>

<body>
  <div class="floating-shape"></div>
  <div class="floating-shape"></div>
  <div class="floating-shape"></div>

  <header class="header">
    <div class="nav-container">
      <div class="logo">
        <i class="fas fa-mosque"></i>
        دليل الصلاة التفاعلي
      </div>
      <button class="menu-toggle" onclick="toggleMobileMenu()">
        <i class="fas fa-bars"></i>
      </button>
      <div class="nav-tabs" id="nav-tabs">
        <!-- ...باقي أزرار التبويب... -->
        <button class="nav-tab active" onclick="showTab('home')">
          <i class="fas fa-home"></i> الرئيسية
        </button>
        <button class="nav-tab" onclick="showTab('wudu')">
          <i class="fas fa-hand-sparkles"></i> الوضوء
        </button>
        <button class="nav-tab" onclick="showTab('prayer')">
          <i class="fas fa-praying-hands"></i> الصلاة
        </button>
        <button class="nav-tab" onclick="showTab('qibla')">
          <i class="fas fa-compass"></i> القبلة
        </button>
        <button class="nav-tab" onclick="showTab('duas')">
          <i class="fas fa-book-open"></i> الأذكار
        </button>
        <button class="nav-tab" onclick="showTab('times')">
          <i class="fas fa-clock"></i> المواقيت
        </button>
        <button class="nav-tab" onclick="showTab('settings')">
          <i class="fas fa-cog"></i> الإعدادات
        </button>
        <a class="nav-tab" href="index.html" style="text-decoration:none;">
          <i class="fas fa-arrow-right"></i> العودة
        </a>
      </div>
    </div>
  </header>

  <div class="container">
    <!-- الصفحة الرئيسية -->
    <div id="home" class="tab-content active">
      <div class="hero-card">
        <h1 style="text-align: center; font-size: 36px; margin-bottom: 20px; background: var(--primary-gold); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
          <i class="fas fa-mosque"></i>
          مرحباً بك في دليل الصلاة التفاعلي
        </h1>
        <p style="text-align: center; font-size: 18px; line-height: 1.8; color: var(--text-light); margin-bottom: 30px; opacity: 0.9;">
          دليلك الشامل لتعلم الصلاة والوضوء مع ميزات تفاعلية متطورة وأذان الشيوخ المميزين
        </p>
        <div class="audio-controls">
          <button class="audio-btn" onclick="playWelcomeAudio()">
            <i class="fas fa-play"></i>
          </button>
        </div>
      </div>

      <div class="grid">
        <div class="card" onclick="showTab('wudu')">
          <div class="card-icon">
            <i class="fas fa-hand-sparkles"></i>
          </div>
          <h3 class="card-title">تعلم الوضوء</h3>
          <p>خطوات الوضوء الصحيح مع الإرشادات الصوتية والمرئية</p>
        </div>

        <div class="card" onclick="showTab('prayer')">
          <div class="card-icon">
            <i class="fas fa-praying-hands"></i>
          </div>
          <h3 class="card-title">أداء الصلاة</h3>
          <p>دليل شامل لأداء الصلاة مع التوجيه خطوة بخطوة</p>
        </div>

        <div class="card" onclick="showTab('qibla')">
          <div class="card-icon">
            <i class="fas fa-compass"></i>
          </div>
          <h3 class="card-title">اتجاه القبلة</h3>
          <p>بوصلة ذكية لتحديد اتجاه القبلة بدقة</p>
        </div>

        <div class="card" onclick="showTab('duas')">
          <div class="card-icon">
            <i class="fas fa-book-open"></i>
          </div>
          <h3 class="card-title">الأذكار والأدعية</h3>
          <p>مجموعة شاملة من الأذكار اليومية والأدعية المأثورة</p>
        </div>

        <div class="card" onclick="showTab('times')">
          <div class="card-icon">
            <i class="fas fa-clock"></i>
          </div>
          <h3 class="card-title">مواقيت الصلاة</h3>
          <p>أوقات الصلاة الدقيقة مع التنبيهات الذكية</p>
        </div>
      </div>
    </div>

    <!-- قسم الوضوء -->
    <div id="wudu" class="tab-content">
      <div class="hero-card">
        <h2 style="text-align: center; margin-bottom: 30px; color: var(--text-gold);">
          <i class="fas fa-hand-sparkles"></i>
          دليل الوضوء التفاعلي
        </h2>
        
        <div class="progress-circle">
          <svg class="progress-ring" width="100" height="100">
            <circle class="progress-ring-circle"></circle>
            <circle class="progress-ring-fill" id="wudu-progress"></circle>
          </svg>
          <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-weight: 700; color: var(--text-gold);">
            <span id="wudu-step-number">1</span>/7
          </div>
        </div>

        <ul class="step-list" id="wudu-steps">
          <li class="step-item active" onclick="selectWuduStep(1)">
            <div class="step-number">1</div>
            <div>النية للوضوء في القلب</div>
          </li>
          <li class="step-item" onclick="selectWuduStep(2)">
            <div class="step-number">2</div>
            <div>غسل الكفين ثلاث مرات</div>
          </li>
          <li class="step-item" onclick="selectWuduStep(3)">
            <div class="step-number">3</div>
            <div>المضمضة والاستنشاق ثلاث مرات</div>
          </li>
          <li class="step-item" onclick="selectWuduStep(4)">
            <div class="step-number">4</div>
            <div>غسل الوجه ثلاث مرات من الأذن إلى الأذن</div>
          </li>
          <li class="step-item" onclick="selectWuduStep(5)">
            <div class="step-number">5</div>
            <div>غسل اليدين إلى المرفقين ثلاث مرات</div>
          </li>
          <li class="step-item" onclick="selectWuduStep(6)">
            <div class="step-number">6</div>
            <div>مسح الرأس والأذنين مرة واحدة</div>
          </li>
          <li class="step-item" onclick="selectWuduStep(7)">
            <div class="step-number">7</div>
            <div>غسل الرجلين إلى الكعبين ثلاث مرات</div>
          </li>
        </ul>

        <div class="audio-controls">
          <button class="audio-btn" onclick="playStepAudio()">
            <i class="fas fa-play"></i>
          </button>
          <button class="audio-btn" onclick="pauseAudio()">
            <i class="fas fa-pause"></i>
          </button>
          <button class="audio-btn" onclick="resetWudu()">
            <i class="fas fa-redo"></i>
          </button>
        </div>

        <!-- فيديو تعليمي للوضوء في الأسفل -->
        <div style="display: flex; justify-content: center; margin-top: 40px;">
          <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
            <div style="position: relative; padding-bottom: 56.25%; height: 0;">
              <iframe src="https://www.youtube.com/embed/ww7fulDUUNk?si=1puiF3C7TJ5Sz1Cs" title="فيديو تعليم الوضوء" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- قسم الصلاة -->
    <div id="prayer" class="tab-content">
      <div class="hero-card">
        <h2 style="text-align: center; margin-bottom: 30px; color: var(--text-gold);">
          <i class="fas fa-praying-hands"></i>
          دليل الصلاة التفاعلي
        </h2>

        <div class="grid">
          <div class="card">
            <h3 class="card-title">أركان الصلاة</h3>
            <ul class="step-list">
              <li class="step-item" onclick="playPrayerStep(1)">
                <div class="step-number">1</div>
                <div>القيام مع القدرة</div>
              </li>
              <li class="step-item" onclick="playPrayerStep(2)">
                <div class="step-number">2</div>
                <div>تكبيرة الإحرام</div>
              </li>
              <li class="step-item" onclick="playPrayerStep(3)">
                <div class="step-number">3</div>
                <div>قراءة الفاتحة</div>
              </li>
              <li class="step-item" onclick="playPrayerStep(4)">
                <div class="step-number">4</div>
                <div>الركوع والرفع منه</div>
              </li>
              <li class="step-item" onclick="playPrayerStep(5)">
                <div class="step-number">5</div>
                <div>السجود والجلوس بين السجدتين</div>
              </li>
              <li class="step-item" onclick="playPrayerStep(6)">
                <div class="step-number">6</div>
                <div>الجلوس للتشهد الأخير</div>
              </li>
              <li class="step-item" onclick="playPrayerStep(7)">
                <div class="step-number">7</div>
                <div>السلام</div>
              </li>
            </ul>
          </div>

          <div class="card">
            <h3 class="card-title">خطوات الصلاة</h3>
            <ul class="step-list">
              <li class="step-item" onclick="playDetailedPrayerStep(1)">
                <div class="step-number">1</div>
                <div>استقبال القبلة والنية</div>
              </li>
              <li class="step-item" onclick="playDetailedPrayerStep(2)">
                <div class="step-number">2</div>
                <div>تكبيرة الإحرام "الله أكبر"</div>
              </li>
              <li class="step-item" onclick="playDetailedPrayerStep(3)">
                <div class="step-number">3</div>
                <div>دعاء الاستفتاح</div>
              </li>
              <li class="step-item" onclick="playDetailedPrayerStep(4)">
                <div class="step-number">4</div>
                <div>قراءة الفاتحة وسورة</div>
              </li>
              <li class="step-item" onclick="playDetailedPrayerStep(5)">
                <div class="step-number">5</div>
                <div>الركوع مع التسبيح</div>
              </li>
              <li class="step-item" onclick="playDetailedPrayerStep(6)">
                <div class="step-number">6</div>
                <div>الرفع من الركوع</div>
              </li>
              <li class="step-item" onclick="playDetailedPrayerStep(7)">
                <div class="step-number">7</div>
                <div>السجود مرتين</div>
              </li>
              <li class="step-item" onclick="playDetailedPrayerStep(8)">
                <div class="step-number">8</div>
                <div>التشهد والسلام</div>
              </li>
            </ul>
          </div>
        </div>

        <!-- فيديو تعليمي للصلاة في الأسفل -->
        <div style="display: flex; justify-content: center; margin-top: 40px;">
          <div style="max-width: 600px; width: 100%; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
            <div style="position: relative; padding-bottom: 56.25%; height: 0;">
              <iframe src="https://www.youtube.com/embed/RFDdPpChgH8?si=DGDWmBOpjrbpQ1bp" title="فيديو تعليم الصلاة" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
            </div>
          </div>
        </div>
      </div>
    </div>


    <!-- قسم القبلة -->
    <div id="qibla" class="tab-content">
      <div class="hero-card" style="text-align: center;">
        <h2 style="margin-bottom: 30px; color: var(--text-gold);">
          <i class="fas fa-compass"></i>
          بوصلة القبلة الذكية
        </h2>
        
        <div class="qibla-compass">
            <div class="compass-inner">
              <!-- دائرة مركزية ذهبية -->
              <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:32px;height:32px;background:var(--primary-gold);border-radius:50%;box-shadow:0 0 12px #ffd70055;"></div>
              <!-- إبرة البوصلة (سهم القبلة) -->
              <div class="compass-needle" style="z-index:2;"></div>
              <!-- رأس السهم للقبلة -->
              <div style="position:absolute;top:38px;left:50%;transform:translateX(-50%);z-index:3;">
                <svg width="18" height="24" viewBox="0 0 18 24"><polygon points="9,0 18,24 9,18 0,24" fill="#ff6b35" stroke="#ffd700" stroke-width="1.5"/></svg>
              </div>
              <!-- رموز الاتجاهات -->
              <div style="position: absolute; top: 10px; left: 50%; transform: translateX(-50%); font-weight: 700; color: #ff6b35; font-size: 1.2em;">N</div>
              <div style="position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); font-weight: 700; color: var(--text-light); font-size: 1.1em;">S</div>
              <div style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); font-weight: 700; color: var(--text-light); font-size: 1.1em;">W</div>
              <div style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); font-weight: 700; color: var(--text-light); font-size: 1.1em;">E</div>
              <!-- الكعبة في المركز -->
              <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-weight: 700; color: var(--darker-bg); font-size: 1.5em; z-index:4;">
                <i class="fas fa-kaaba"></i>
              </div>
            </div>
        </div>

        <p style="font-size: 18px; margin: 20px 0; color: var(--text-light);">
          اتجاه القبلة: <span style="font-weight: 700; color: var(--text-gold);" id="qibla-direction">شمال شرق</span>
        </p>
        
        <div class="audio-controls">
          <button class="audio-btn" onclick="findQibla()">
            <i class="fas fa-location-arrow"></i>
          </button>
          <button class="audio-btn" onclick="calibrateCompass()">
            <i class="fas fa-sync-alt"></i>
          </button>
        </div>
      </div>
    </div>

  <!-- قسم الأذكار -->
<div id="duas" class="tab-content">
  <div class="hero-card">
    <h2 style="text-align: center; margin-bottom: 30px; color: var(--text-gold);">
      <i class="fas fa-book-open"></i>
      الأذكار والأدعية
    </h2>

    <!-- الشهادة -->
    <div class="dua-card">
      <div class="dua-text">
        <b>الشهادة:</b><br>
        أَشْهَدُ أَنْ لاَ إِلَهَ إِلاَّ اللَّهُ وَحْدَهُ لاَ شَرِيكَ لَهُ، وَأَشْهَدُ أَنَّ مُحَمَّدًا عَبْدُهُ وَرَسُولُهُ<br>
        <span style="color: var(--text-gold); font-size: 13px;">
          معناها: الإقرار بوحدانية الله ونبوة محمد ﷺ.<br>
          الفضل: أعظم كلمة في الإسلام، من قالها دخل الجنة بإذن الله.
        </span>
      </div>
      <div class="audio-controls">
        <button class="audio-btn" onclick="playDua('shahada')">
          <i class="fas fa-volume-up"></i>
        </button>
        <button class="audio-btn" onclick="repeatDua('shahada')">
          <i class="fas fa-repeat"></i>
        </button>
      </div>
    </div>

    <!-- التسبيح -->
    <div class="dua-card">
      <div class="dua-text">
        <b>التسبيح:</b><br>
        سُبْحَانَ اللَّهِ وَالْحَمْدُ لِلَّهِ وَلاَ إِلَهَ إِلاَّ اللَّهُ وَاللَّهُ أَكْبَرُ<br>
        <span style="color: var(--text-gold); font-size: 13px;">
          معناها: تنزيه الله عن النقص، وحمده، وتوحيده، وتعظيمه.<br>
          الفضل: أحب الكلام إلى الله، ويقال بعد كل صلاة 33 مرة.
        </span>
      </div>
      <div class="audio-controls">
        <button class="audio-btn" onclick="playDua('tasbih')">
          <i class="fas fa-volume-up"></i>
        </button>
        <span id="tasbihCounter" class="counter-badge">0</span>
        <button class="audio-btn" onclick="startCounter('tasbihCounter')">
          <i class="fas fa-plus"></i>
        </button>
      </div>
    </div>

    <!-- دعاء بعد الصلاة -->
    <div class="dua-card">
      <div class="dua-text">
        <b>دعاء بعد الصلاة:</b><br>
        اللَّهُمَّ أَنْتَ السَّلاَمُ وَمِنْكَ السَّلاَمُ، تَبَارَكْتَ يَا ذَا الْجَلاَلِ وَالإِكْرَامِ<br>
        <span style="color: var(--text-gold); font-size: 13px;">
          معناه: الاعتراف بأن السلام من الله وحده، والثناء عليه.<br>
          الفضل: من أذكار ختم الصلاة، يقال بعد التسليم مباشرة.
        </span>
      </div>
      <div class="audio-controls">
        <button class="audio-btn" onclick="playDua('after_prayer')">
          <i class="fas fa-volume-up"></i>
        </button>
      </div>
    </div>

    <!-- دعاء الاستفتاح -->
    <div class="dua-card">
      <div class="dua-text">
        <b>دعاء الاستفتاح:</b><br>
        سُبْحَانَكَ اللَّهُمَّ وَبِحَمْدِكَ، وَتَبَارَكَ اسْمُكَ، وَتَعَالَى جَدُّكَ، وَلاَ إِلَهَ غَيْرُكَ<br>
        <span style="color: var(--text-gold); font-size: 13px;">
          معناه: تنزيه الله وتمجيده والثناء عليه.<br>
          الفضل: يقال في بداية الصلاة بعد تكبيرة الإحرام.
        </span>
      </div>
      <div class="audio-controls">
        <button class="audio-btn" onclick="playDua('istiftah')">
          <i class="fas fa-volume-up"></i>
        </button>
        <button class="audio-btn" onclick="repeatDua('istiftah')">
          <i class="fas fa-repeat"></i>
        </button>
      </div>
    </div>

    <!-- دعاء الخروج من المنزل -->
    <div class="dua-card">
      <div class="dua-text">
        <b>دعاء الخروج من المنزل:</b><br>
        بِسْمِ اللَّهِ، تَوَكَّلْتُ عَلَى اللَّهِ، لاَ حَوْلَ وَلاَ قُوَّةَ إِلاَّ بِاللَّهِ<br>
        <span style="color: var(--text-gold); font-size: 13px;">
          معناه: التوكل على الله والاعتماد عليه.<br>
          الفضل: يحمي من الشر ويحفظ المسلم عند خروجه.
        </span>
      </div>
      <div class="audio-controls">
        <button class="audio-btn" onclick="playDua('leaving_home')">
          <i class="fas fa-volume-up"></i>
        </button>
      </div>
    </div>

    <!-- دعاء دخول المسجد -->
    <div class="dua-card">
      <div class="dua-text">
        <b>دعاء دخول المسجد:</b><br>
        اللَّهُمَّ افْتَحْ لِي أَبْوَابَ رَحْمَتِكَ<br>
        <span style="color: var(--text-gold); font-size: 13px;">
          معناه: طلب فتح أبواب رحمة الله عند دخول المسجد.<br>
          الفضل: يستحب قوله عند دخول المسجد لنيل الرحمة.
        </span>
      </div>
      <div class="audio-controls">
        <button class="audio-btn" onclick="playDua('enter_mosque')">
          <i class="fas fa-volume-up"></i>
        </button>
      </div>
    </div>

    <!-- دعاء الاستخارة -->
    <div class="dua-card">
      <div class="dua-text">
        <b>دعاء الاستخارة:</b><br>
        اللَّهُمَّ إِنِّي أَسْتَخِيرُكَ بِعِلْمِكَ وَأَسْتَقْدِرُكَ بِقُدْرَتِكَ، وَأَسْأَلُكَ مِنْ فَضْلِكَ الْعَظِيمِ...<br>
        <span style="color: var(--text-gold); font-size: 13px;">
          معناه: طلب الخيرة من الله في أمر ما.<br>
          الفضل: يُقال بعد صلاة الاستخارة لتيسير الأمور.
        </span>
      </div>
      <div class="audio-controls">
        <button class="audio-btn" onclick="playDua('istikharah')">
          <i class="fas fa-volume-up"></i>
        </button>
        <button class="audio-btn" onclick="repeatDua('istikharah')">
          <i class="fas fa-repeat"></i>
        </button>
      </div>
    </div>

    <!-- فيديو أذكار المساء -->
    <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 24px; margin-top: 40px;">
      <!-- فيديو أذكار المساء -->
      <div style="flex: 1 1 320px; max-width: 600px; min-width: 280px; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
        <div style="position: relative; padding-bottom: 56.25%; height: 0;">
          <iframe src="https://www.youtube.com/embed/Gc7xzVqjv0Q?si=Jkm6UE4SU-XvodcB" title="فيديو أذكار المساء" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
        </div>
        <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">أذكار المساء</div>
      </div>
      <!-- فيديو أذكار الصباح -->
      <div style="flex: 1 1 320px; max-width: 600px; min-width: 280px; box-shadow: 0 8px 32px #ffd70055, 0 2px 16px #0002; border-radius: 18px; overflow: hidden; border: 3px solid #ffd700; background: #222;">
        <div style="position: relative; padding-bottom: 56.25%; height: 0;">
          <iframe src="https://www.youtube.com/embed/EDD4A9HzHfs?si=xlKXa_CpIdWkSxTM" title="فيديو أذكار الصباح" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"></iframe>
        </div>
        <div style="text-align:center; color:var(--text-gold); font-weight:700; padding:8px 0 4px; font-size:1.1em;">أذكار الصباح</div>
      </div>
    </div>
  </div>
</div>

    <!-- قسم المواقيت -->
    <div id="times" class="tab-content">
      <div class="hero-card">
        <h2 style="text-align: center; margin-bottom: 30px; color: var(--text-gold);">
          <i class="fas fa-clock"></i>
          مواقيت الصلاة
        </h2>
        
        <div class="prayer-times">
          <div class="prayer-time">
            <div class="prayer-name">الفجر</div>
            <div class="prayer-time-value" id="fajr-time">05:30</div>
          </div>
          <div class="prayer-time">
            <div class="prayer-name">الشروق</div>
            <div class="prayer-time-value" id="sunrise-time">07:00</div>
          </div>
          <div class="prayer-time current">
            <div class="prayer-name">الظهر</div>
            <div class="prayer-time-value" id="dhuhr-time">12:45</div>
          </div>
          <div class="prayer-time">
            <div class="prayer-name">العصر</div>
            <div class="prayer-time-value" id="asr-time">16:15</div>
          </div>
          <div class="prayer-time">
            <div class="prayer-name">المغرب</div>
            <div class="prayer-time-value" id="maghrib-time">19:30</div>
          </div>
          <div class="prayer-time">
            <div class="prayer-name">العشاء</div>
            <div class="prayer-time-value" id="isha-time">21:00</div>
          </div>
        </div>

        <div style="text-align: center; margin-top: 30px;">
          <button class="audio-btn" onclick="playGeneralAdhan()" style="width: 80px; height: 80px; font-size: 24px;">
            <i class="fas fa-mosque"></i>
          </button>
          <p style="margin-top: 15px; color: var(--text-light); opacity: 0.8;">استماع للأذان</p>
        </div>
      </div>
    </div>

    <!-- قسم الإعدادات واللغة -->
    <div id="settings" class="tab-content">
      <div class="language-section">
        <h2 style="text-align: center; margin-bottom: 20px; color: var(--text-gold);">
          <i class="fas fa-cog"></i>
          إعدادات التطبيق
        </h2>
        <p style="text-align: center; font-size: 16px; line-height: 1.8; color: var(--text-light); margin-bottom: 30px; opacity: 0.9;">
          اختر اللغة المفضلة لديك وخصص تجربة الاستخدام
        </p>
        
        <div class="settings-section">
          <h3>
            <i class="fas fa-language"></i>
            اختيار اللغة / Language Selection
          </h3>
          <div class="language-toggle">
            <button class="lang-btn active" onclick="setLanguage('ar')" id="lang-ar">
              <i class="fas fa-flag"></i>
              العربية
            </button>
            <button class="lang-btn" onclick="setLanguage('en')" id="lang-en">
              <i class="fas fa-flag"></i>
              English
            </button>
          </div>
        </div>

        <div class="settings-section">
          <h3>
            <i class="fas fa-volume-up"></i>
            إعدادات الصوت (Text-to-Speech)
          </h3>
          <div class="control-group">
            <label>
              الصوت:
              <select id="tts-voice-select"></select>
            </label>
            <label>
              السرعة:
              <input type="range" id="tts-rate" min="0.5" max="2" step="0.1" value="1">
              <span class="range-value" id="tts-rate-value">1</span>
            </label>
            <label>
              النبرة:
              <input type="range" id="tts-pitch" min="0.5" max="2" step="0.1" value="1">
              <span class="range-value" id="tts-pitch-value">1</span>
            </label>
          </div>
          <div id="tts-support-msg" style="color: #ff6b35; margin: 10px 0; text-align: center;"></div>
          <div class="audio-controls">
            <button class="audio-btn" onclick="testTTS()">
              <i class="fas fa-play"></i>
            </button>
            <button class="audio-btn" onclick="toggleMute()">
              <i class="fas fa-volume-high" id="mute-icon"></i>
            </button>
          </div>
        </div>

        <div class="settings-section">
          <h3>
            <i class="fas fa-palette"></i>
            إعدادات المظهر
          </h3>
          <div class="audio-controls">
            <button class="audio-btn" onclick="toggleTheme()">
              <i class="fas fa-moon"></i>
            </button>
            <button class="audio-btn" onclick="resetSettings()">
              <i class="fas fa-redo"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <button class="floating-action" onclick="showNotification()">
    <i class="fas fa-bell"></i>
  </button>

  <div class="notification" id="notification">
    <h4 style="margin-bottom: 10px; color: var(--text-gold);">
      <i class="fas fa-mosque"></i>
      تذكير الصلاة
    </h4>
    <p>حان وقت صلاة الظهر</p>
  </div>

  <footer class="footer">
    <div class="footer-content">
      <div class="developer-info">
        <i class="fas fa-code"></i>
        تطوير وتصميم: عبد الصمد بوركيبات
      </div>
      <div class="copyright">
        <i class="fas fa-copyright"></i>
        جميع الحقوق محفوظة © 2025
      </div>
    </div>
  </footer>

  <script>
    // مثال عملي: معالجة أخطاء برمجية بشكل احترافي
    window.addEventListener('error', function(e) {
      // رسالة ودية للمستخدم فقط
      const friendlyMsg = currentLanguage === 'ar'
        ? 'حدث خلل بسيط، يرجى إعادة المحاولة أو تحديث الصفحة.'
        : 'A minor issue occurred, please try again or refresh the page.';
      showNotification(friendlyMsg);
      // سجل الخطأ للمطور فقط
      if (window.console && window.console.error) {
        console.error('JavaScript Error:', e.error || e);
      }
      // منع ظهور رسالة الخطأ الافتراضية
      return true;
    });

    // مثال عملي: استخدام try/catch في دوال تتعامل مع الأجهزة أو الشبكة
    function safeRun(fn) {
      try {
        fn();
      } catch (err) {
        const friendlyMsg = currentLanguage === 'ar'
          ? 'حدث خطأ أثناء تنفيذ العملية، يرجى المحاولة لاحقاً.'
          : 'An error occurred, please try again later.';
        showNotification(friendlyMsg);
        if (window.console && window.console.error) {
          console.error('SafeRun Error:', err);
        }
      }
    }
    // استخدم safeRun(() => { ... }) حول أي كود حساس
    // متغيرات عامة
    let currentWuduStep = 1;
    let currentAudio = null;
    let duaCounter = 0;
    let isMuted = false;
    let currentLanguage = 'ar';
    let mobileMenuOpen = false;

    // إعدادات TTS
    let ttsVoice = null;
    let ttsRate = 1;
    let ttsPitch = 1;
    let availableVoices = [];

    // بيانات النصوص للقراءة الصوتية
    const audioTexts = {
      ar: {
        welcome: "مرحباً بك في دليل الصلاة التفاعلي، دليلك الشامل لتعلم الصلاة والوضوء",
        wudu_steps: [
          "الخطوة الأولى: النية للوضوء في القلب",
          "الخطوة الثانية: غسل الكفين ثلاث مرات",
          "الخطوة الثالثة: المضمضة والاستنشاق ثلاث مرات",
          "الخطوة الرابعة: غسل الوجه ثلاث مرات من الأذن إلى الأذن",
          "الخطوة الخامسة: غسل اليدين إلى المرفقين ثلاث مرات",
          "الخطوة السادسة: مسح الرأس والأذنين مرة واحدة",
          "الخطوة السابعة: غسل الرجلين إلى الكعبين ثلاث مرات"
        ],
        prayer_steps: [
          "القيام مع القدرة للصلاة",
          "تكبيرة الإحرام بقول الله أكبر",
          "قراءة سورة الفاتحة",
          "الركوع والرفع منه مع التسبيح",
          "السجود والجلوس بين السجدتين",
          "الجلوس للتشهد الأخير",
          "السلام للخروج من الصلاة"
        ],
        detailed_prayer_steps: [
          "استقبال القبلة والنية للصلاة",
          "تكبيرة الإحرام بقول الله أكبر",
          "دعاء الاستفتاح",
          "قراءة الفاتحة وسورة من القرآن",
          "الركوع مع التسبيح",
          "الرفع من الركوع",
          "السجود مرتين مع التسبيح",
          "التشهد والسلام"
        ],
        duas: {
          shahada: "أشهد أن لا إله إلا الله وحده لا شريك له، وأشهد أن محمداً عبده ورسوله",
          tasbih: "سبحان الله والحمد لله ولا إله إلا الله والله أكبر",
          after_prayer: "اللهم أنت السلام ومنك السلام، تباركت يا ذا الجلال والإكرام"
        }
      },
      en: {
        welcome: "Welcome to the Interactive Prayer Guide, your comprehensive guide to learning prayer and ablution",
        wudu_steps: [
          "Step 1: Intention for ablution in the heart",
          "Step 2: Wash hands three times",
          "Step 3: Rinse mouth and nose three times",
          "Step 4: Wash face three times from ear to ear",
          "Step 5: Wash arms up to elbows three times",
          "Step 6: Wipe head and ears once",
          "Step 7: Wash feet up to ankles three times"
        ],
        prayer_steps: [
          "Standing with ability for prayer",
          "Opening takbir saying Allahu Akbar",
          "Reciting Surah Al-Fatiha",
          "Bowing and rising with glorification",
          "Prostration and sitting between prostrations",
          "Sitting for final tashahhud",
          "Salutation to exit prayer"
        ],
        detailed_prayer_steps: [
          "Facing Qibla and intention for prayer",
          "Opening takbir saying Allahu Akbar",
          "Opening supplication",
          "Reciting Al-Fatiha and a Surah from Quran",
          "Bowing with glorification",
          "Rising from bowing",
          "Prostrating twice with glorification",
          "Tashahhud and salutation"
        ],
        duas: {
          shahada: "I bear witness that there is no god but Allah alone with no partner, and I bear witness that Muhammad is His servant and messenger",
          tasbih: "Glory be to Allah, praise be to Allah, there is no god but Allah, and Allah is the Greatest",
          after_prayer: "O Allah, You are peace and from You comes peace, blessed are You, O Possessor of majesty and honor"
        }
      }
    };

    // تهيئة TTS
    function initializeTTS() {
      if (!('speechSynthesis' in window)) {
        document.getElementById('tts-support-msg').textContent = 
          currentLanguage === 'ar' ? 
          'متصفحك لا يدعم ميزة تحويل النص إلى كلام' :
          'Your browser does not support text-to-speech';
        return;
      }

      // تحديث قائمة الأصوات
      function loadVoices() {
        availableVoices = speechSynthesis.getVoices();
        populateVoiceList();
      }

      // تحميل الأصوات عند التوفر
      if (availableVoices.length === 0) {
        speechSynthesis.onvoiceschanged = loadVoices;
      } else {
        loadVoices();
      }
    }

    // ملء قائمة الأصوات
    function populateVoiceList() {
      const voiceSelect = document.getElementById('tts-voice-select');
      voiceSelect.innerHTML = '';

      // أصوات مخصصة عالية الجودة
      const customVoices = [
        { name: 'Microsoft Naayf - Arabic (Saudi)', lang: 'ar-SA', gender: ' (ذكر)', isCustom: true },
        { name: 'Microsoft Hoda - Arabic (Egypt)', lang: 'ar-EG', gender: ' (أنثى)', isCustom: true },
        { name: 'Google français', lang: 'fr-FR', gender: ' (Femme)', isCustom: true },
        { name: 'Google US English', lang: 'en-US', gender: ' (Female)', isCustom: true }
      ];

      // دمج أصوات النظام مع الأصوات المخصصة (مع تمييز المخصصة)
      let voicesToShow = [];
      if (availableVoices.length > 0) {
        // فلترة أصوات النظام حسب اللغة
        const filteredVoices = availableVoices.filter(voice => {
          if (currentLanguage === 'ar') {
            return voice.lang.includes('ar') || voice.lang.includes('Arabic');
          } else if (currentLanguage === 'fr') {
            return voice.lang.toLowerCase().includes('fr');
          } else {
            return voice.lang.includes('en') || voice.lang.includes('English');
          }
        });
        // إذا لم توجد أصوات للغة، أظهر جميع أصوات النظام
        voicesToShow = filteredVoices.length > 0 ? filteredVoices : availableVoices;
        // أضف الأصوات المخصصة دائماً في النهاية
        voicesToShow = voicesToShow.concat(customVoices);
      } else {
        // إذا لم تتوفر أصوات النظام، أظهر فقط الأصوات المخصصة
        voicesToShow = customVoices;
      }

      voicesToShow.forEach((voice, index) => {
        const option = document.createElement('option');
        option.value = voice.name;
        // تحديد الجنس
        let gender = '';
        if (voice.gender) {
          gender = voice.gender;
        } else if (voice.name && typeof voice.name === 'string') {
          const n = voice.name.toLowerCase();
          if (n.includes('female') || n.includes('femme') || n.includes('woman')) {
            gender = currentLanguage === 'fr' ? ' (Femme)' : currentLanguage === 'ar' ? ' (أنثى)' : ' (Female)';
          } else if (n.includes('male') || n.includes('homme') || n.includes('man')) {
            gender = currentLanguage === 'fr' ? ' (Homme)' : currentLanguage === 'ar' ? ' (ذكر)' : ' (Male)';
          }
        }
        // تمييز الأصوات المخصصة
        let customLabel = '';
        if (voice.isCustom) {
          customLabel = currentLanguage === 'ar' ? ' (صوت مخصص)' : ' (Custom Voice)';
        }
        option.textContent = `${voice.name} (${voice.lang})${gender}${voice.default ? ' - الافتراضي' : ''}${customLabel}`;
        voiceSelect.appendChild(option);

        // تحديد الصوت الافتراضي
        if ((voice.default && !voice.isCustom) || (index === 0 && !ttsVoice)) {
          option.selected = true;
          ttsVoice = voice;
        }
      });
    }

    // دالة تشغيل النص الصوتي المحسّنة
    function speakText(text, lang = null) {
      if (!('speechSynthesis' in window)) {
        showNotification(currentLanguage === 'ar' ? 'المتصفح لا يدعم تشغيل الصوت' : 'Browser does not support audio');
        return;
      }

      if (isMuted) {
        showNotification(currentLanguage === 'ar' ? 'الصوت مكتوم' : 'Audio is muted');
        return;
      }

      // إيقاف أي صوت سابق
      if (speechSynthesis.speaking) {
        speechSynthesis.cancel();
      }

      const utterance = new SpeechSynthesisUtterance(text);
      
      // تحديد اللغة
      utterance.lang = lang || (currentLanguage === 'ar' ? 'ar-SA' : 'en-US');
      
      // تطبيق الإعدادات
      utterance.rate = ttsRate;
      utterance.pitch = ttsPitch;
      utterance.volume = 1;
      
      // تحديد الصوت إذا كان متاحاً
      if (ttsVoice) {
        utterance.voice = ttsVoice;
      }

      // التأثيرات البصرية
      document.body.style.filter = 'brightness(1.1) saturate(1.1)';
      
      // معالجة الأحداث
      utterance.onstart = function() {
        currentAudio = utterance;
        // إضافة تأثير للزر النشط
        const activeBtn = document.querySelector('.audio-btn:hover, .audio-btn:focus, .audio-btn:active');
        if (activeBtn) {
          activeBtn.classList.add('active-playing');
        }
      };

      utterance.onend = function() {
        document.body.style.filter = 'brightness(1)';
        document.querySelectorAll('.active-playing').forEach(btn => {
          btn.classList.remove('active-playing');
        });
        currentAudio = null;
      };

      utterance.onerror = function(event) {
        console.error('TTS Error:', event.error);
        document.body.style.filter = 'brightness(1)';
        document.querySelectorAll('.active-playing').forEach(btn => {
          btn.classList.remove('active-playing');
        });
        showNotification(currentLanguage === 'ar' ? 'حدث خطأ في تشغيل الصوت' : 'Error playing audio');
        currentAudio = null;
      };

      // تشغيل الصوت
      speechSynthesis.speak(utterance);
    }

    // تبديل التبويبات
    function showTab(tabName) {
      // إخفاء جميع التبويبات
      const tabContents = document.querySelectorAll('.tab-content');
      tabContents.forEach(tab => tab.classList.remove('active'));
      
      // إظهار التبويب المحدد
      const targetTab = document.getElementById(tabName);
      if (targetTab) {
        targetTab.classList.add('active');
      }
      
      // تحديث أزرار التنقل
      const navTabs = document.querySelectorAll('.nav-tab');
      navTabs.forEach(tab => tab.classList.remove('active'));
      
      // تفعيل الزر الحالي
      const clickedButton = event?.target?.closest('.nav-tab');
      if (clickedButton) {
        clickedButton.classList.add('active');
      }
      
      // إغلاق القائمة المحمولة إذا كانت مفتوحة
      if (mobileMenuOpen) {
        toggleMobileMenu();
      }
      
      // تحديث المحتوى حسب التبويب
      if (tabName === 'times') {
        updatePrayerTimes();
      } else if (tabName === 'qibla') {
        updateQiblaDirection();
      }
    }

    // تبديل القائمة المحمولة
    function toggleMobileMenu() {
      const navTabs = document.getElementById('nav-tabs');
      mobileMenuOpen = !mobileMenuOpen;
      
      if (mobileMenuOpen) {
        navTabs.classList.add('mobile-show');
      } else {
        navTabs.classList.remove('mobile-show');
      }
    }

    // اختيار خطوة الوضوء
    function selectWuduStep(stepNumber) {
      currentWuduStep = stepNumber;
      
      // تحديث العناصر النشطة
      const steps = document.querySelectorAll('#wudu-steps .step-item');
      steps.forEach(step => step.classList.remove('active'));
      if (steps[stepNumber - 1]) {
        steps[stepNumber - 1].classList.add('active');
      }
      
      // تحديث رقم الخطوة
      const stepNumberElement = document.getElementById('wudu-step-number');
      if (stepNumberElement) {
        stepNumberElement.textContent = stepNumber;
      }
      
      // تحديث شريط التقدم
      updateWuduProgress(stepNumber);
    }

    // تحديث شريط التقدم للوضوء
    function updateWuduProgress(step) {
      const progressFill = document.getElementById('wudu-progress');
      if (progressFill) {
        const circumference = 2 * Math.PI * 40;
        const progress = (step / 7) * circumference;
        progressFill.style.strokeDashoffset = circumference - progress;
      }
    }

    // تشغيل الصوت للخطوة الحالية
    function playStepAudio() {
      const stepText = audioTexts[currentLanguage].wudu_steps[currentWuduStep - 1];
      if (stepText) {
        speakText(stepText);
      }
    }

    // إعادة تعيين الوضوء
    function resetWudu() {
      currentWuduStep = 1;
      selectWuduStep(1);
      showNotification(currentLanguage === 'ar' ? 'تم إعادة تعيين دليل الوضوء' : 'Wudu guide has been reset');
    }

    // إيقاف الصوت
    function pauseAudio() {
      if (speechSynthesis.speaking) {
        speechSynthesis.cancel();
        document.body.style.filter = 'brightness(1)';
        document.querySelectorAll('.active-playing').forEach(btn => {
          btn.classList.remove('active-playing');
        });
        currentAudio = null;
        showNotification(currentLanguage === 'ar' ? 'تم إيقاف الصوت' : 'Audio paused');
      }
    }

    // تشغيل خطوات الصلاة
    function playPrayerStep(stepNumber) {
      const stepText = audioTexts[currentLanguage].prayer_steps[stepNumber - 1];
      if (stepText) {
        speakText(stepText);
        
        // تحديث العرض البصري
        const steps = document.querySelectorAll('.step-item');
        steps.forEach(step => step.classList.remove('active'));
        
        // البحث عن الخطوة في القسم الصحيح
        const prayerSection = document.querySelector('#prayer .card:first-child .step-list');
        if (prayerSection) {
          const prayerSteps = prayerSection.querySelectorAll('.step-item');
          if (prayerSteps[stepNumber - 1]) {
            prayerSteps[stepNumber - 1].classList.add('active');
          }
        }
      }
    }

    // تشغيل خطوات الصلاة المفصلة
    function playDetailedPrayerStep(stepNumber) {
      const stepText = audioTexts[currentLanguage].detailed_prayer_steps[stepNumber - 1];
      if (stepText) {
        speakText(stepText);
        
        // تحديث العرض البصري
        const prayerSection = document.querySelector('#prayer .card:last-child .step-list');
        if (prayerSection) {
          const steps = prayerSection.querySelectorAll('.step-item');
          steps.forEach(step => step.classList.remove('active'));
          if (steps[stepNumber - 1]) {
            steps[stepNumber - 1].classList.add('active');
          }
        }
      }
    }

    // تشغيل الأذان الحقيقي من Adhan API (mp3)
    async function playGeneralAdhan() {
      if (!navigator.geolocation) {
        showNotification('المتصفح لا يدعم تحديد الموقع');
        return;
      }
      showNotification('جاري جلب الأذان...');
      navigator.geolocation.getCurrentPosition(async position => {
        // يمكنك تخصيص mp3 حسب الوقت أو الاكتفاء بصوت ثابت
        const adhanMp3 = 'https://cdn.islamic.network/adhan/audio/128/ar.mishary.rashid.mp3';
        const audio = new Audio(adhanMp3);
        audio.play();
        showNotification('تشغيل الأذان الحقيقي');
      }, () => {
        showNotification('تعذر تحديد الموقع');
      });
    }

    // البحث عن القبلة
    function findQibla() {
      const searchingMsg = currentLanguage === 'ar' ? 
        'جاري تحديد موقعك وحساب اتجاه القبلة...' : 
        'Finding your location and calculating Qibla direction...';
      
      showNotification(searchingMsg);
      speakText(searchingMsg);
      
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          position => {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            
            // حساب اتجاه القبلة (محاكاة)
            const qiblaDirection = calculateQibla(lat, lng);
            const qiblaElement = document.getElementById('qibla-direction');
            if (qiblaElement) {
              qiblaElement.textContent = qiblaDirection;
            }
            
            const successMsg = currentLanguage === 'ar' ? 
              `تم تحديد اتجاه القبلة: ${qiblaDirection}` : 
              `Qibla direction determined: ${qiblaDirection}`;
            
            showNotification(successMsg);
            speakText(successMsg);
          },
          error => {
            const errorMsg = currentLanguage === 'ar' ? 
              'لم يتمكن من تحديد موقعك. يرجى السماح بالوصول للموقع.' : 
              'Could not determine your location. Please allow location access.';
            
            showNotification(errorMsg);
            speakText(errorMsg);
          }
        );
      } else {
        const noSupportMsg = currentLanguage === 'ar' ? 
          'متصفحك لا يدعم تحديد الموقع الجغرافي' : 
          'Your browser does not support geolocation';
        
        showNotification(noSupportMsg);
        speakText(noSupportMsg);
      }
    }// تحديث اتجاه القبلة من Adhan API بناءً على GPS
function updateQiblaDirection() {
  if (!navigator.geolocation) {
    showNotification('المتصفح لا يدعم تحديد الموقع');
    return;
  }
  navigator.geolocation.getCurrentPosition(async position => {
    const lat = position.coords.latitude;
    const lng = position.coords.longitude;
    try {
      const res = await fetch(`https://api.aladhan.com/v1/qibla/${lat}/${lng}`);
      const data = await res.json();
      if (data.code === 200) {
        const direction = Math.round(data.data.direction);
        const qiblaElement = document.getElementById('qibla-direction');
        if (qiblaElement) {
          qiblaElement.textContent = `${direction}°`;
        }
      }
    } catch (e) {
      showNotification('تعذر جلب اتجاه القبلة');
    }
  }, () => {
    showNotification('تعذر تحديد الموقع');
  });
}

    // تشغيل الأدعية
    function playDua(duaType) {
      const duaText = audioTexts[currentLanguage].duas[duaType];
      if (duaText) {
        speakText(duaText);
        
        // تأثير بصري
        const duaCard = event?.target?.closest('.dua-card');
        if (duaCard) {
          duaCard.classList.add('active-playing');
          setTimeout(() => {
            duaCard.classList.remove('active-playing');
          }, 3000);
        }
      }
    }

    // تكرار الدعاء
    function repeatDua(duaType) {
      const repeatMsg = currentLanguage === 'ar' ? 
        'تم تفعيل وضع التكرار' : 
        'Repeat mode activated';
      
      showNotification(repeatMsg);
      speakText(repeatMsg);
    }

    // بدء العداد
    function startCounter() {
      duaCounter++;
      const counterElement = document.getElementById('counter');
      if (counterElement) {
        counterElement.textContent = duaCounter;
        
        // تأثير بصري
        counterElement.style.transform = 'scale(1.2)';
        setTimeout(() => {
          counterElement.style.transform = 'scale(1)';
        }, 200);
      }
      
      if (duaCounter % 33 === 0) {
        const milestoneMsg = currentLanguage === 'ar' ? 
          `مبارك! أكملت ${duaCounter} تسبيحة` : 
          `Congratulations! You completed ${duaCounter} recitations`;
        
        showNotification(milestoneMsg);
        speakText(milestoneMsg);
      }
    }

    // تشغيل الأذان العام
    function playGeneralAdhan() {
      const adhanMsg = currentLanguage === 'ar' ? 
        'تشغيل الأذان...' : 
        'Playing Adhan...';
      
      showNotification(adhanMsg);
      speakText(adhanMsg);
      
      // تأثير بصري
      const btn = event?.target;
      if (btn) {
        btn.classList.add('active-playing');
        setTimeout(() => {
          btn.classList.remove('active-playing');
        }, 5000);
      }
    }

    // تغيير اللغة
    function setLanguage(language) {
      currentLanguage = language;
      
      // تحديث أزرار اللغة
      document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      const langButton = document.getElementById(`lang-${language}`);
      if (langButton) {
        langButton.classList.add('active');
      }
      
      // تحديث قائمة الأصوات
      populateVoiceList();
      
      const langMsg = language === 'en' ? 
        'Language changed to English' : 
        'تم تغيير اللغة إلى العربية';
      
      showNotification(langMsg);
      speakText(langMsg);
    }

    // اختبار TTS
    function testTTS() {
      const testMsg = currentLanguage === 'ar' ? 
        'هذا اختبار للصوت - يعمل بشكل طبيعي' : 
        'This is a voice test - working normally';
      
      speakText(testMsg);
    }

    // كتم/إلغاء كتم الصوت
    function toggleMute() {
      isMuted = !isMuted;
      const icon = document.getElementById('mute-icon');
      
      if (isMuted) {
        if (icon) icon.className = 'fas fa-volume-mute';
        speechSynthesis.cancel(); // إيقاف أي صوت حالي
        showNotification(currentLanguage === 'ar' ? 'تم كتم الصوت' : 'Audio muted');
      } else {
        if (icon) icon.className = 'fas fa-volume-high';
        showNotification(currentLanguage === 'ar' ? 'تم إلغاء كتم الصوت' : 'Audio unmuted');
      }
    }

    // تبديل المظهر
    function toggleTheme() {
      const themeMsg = currentLanguage === 'ar' ? 
        'ميزة تغيير المظهر ستتوفر قريباً' : 
        'Theme switching feature coming soon';
      
      showNotification(themeMsg);
      speakText(themeMsg);
    }

    // إعادة تعيين الإعدادات
    function resetSettings() {
      currentLanguage = 'ar';
      isMuted = false;
      duaCounter = 0;
      ttsRate = 1;
      ttsPitch = 1;
      
      // إعادة تعيين واجهة اللغة
      document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      const arabicBtn = document.getElementById('lang-ar');
      if (arabicBtn) {
        arabicBtn.classList.add('active');
      }
      
      // إعادة تعيين العداد
      const counterElement = document.getElementById('counter');
      if (counterElement) {
        counterElement.textContent = '0';
      }
      
      // إعادة تعيين شرائح التحكم
      const rateSlider = document.getElementById('tts-rate');
      const pitchSlider = document.getElementById('tts-pitch');
      const rateValue = document.getElementById('tts-rate-value');
      const pitchValue = document.getElementById('tts-pitch-value');
      
      if (rateSlider) rateSlider.value = 1;
      if (pitchSlider) pitchSlider.value = 1;
      if (rateValue) rateValue.textContent = '1';
      if (pitchValue) pitchValue.textContent = '1';
      
      // إعادة تعيين أيقونة الكتم
      const muteIcon = document.getElementById('mute-icon');
      if (muteIcon) {
        muteIcon.className = 'fas fa-volume-high';
      }
      
      showNotification('تم إعادة تعيين جميع الإعدادات');
      speakText('تم إعادة تعيين جميع الإعدادات');
    }

    // عرض الإشعارات
    function showNotification(message) {
      const notification = document.getElementById('notification');
      const messageElement = notification?.querySelector('p');
      
      if (messageElement) {
        messageElement.textContent = message;
      }
      
      if (notification) {
        notification.classList.add('show');
        
        setTimeout(() => {
          notification.classList.remove('show');
        }, 3000);
      }
    }

    // تشغيل الصوت الترحيبي
    function playWelcomeAudio() {
      speakText(audioTexts[currentLanguage].welcome);
    }

    // تحديث مواقيت الصلاة باستخدام GPS وAdhan API
    function updatePrayerTimes() {
      if (!navigator.geolocation) {
        showNotification(currentLanguage === 'ar' ? 'متصفحك لا يدعم تحديد الموقع' : 'Your browser does not support geolocation');
        return;
      }
      // طلب تفعيل GPS من المستخدم برسالة واضحة
      showNotification(currentLanguage === 'ar' ? 'يرجى تفعيل GPS والموافقة على تحديد الموقع للحصول على مواقيت الصلاة بدقة' : 'Please enable GPS and allow location access for accurate prayer times');
      navigator.geolocation.getCurrentPosition(
        position => {
          const lat = position.coords.latitude;
          const lng = position.coords.longitude;
          const today = new Date();
          const day = today.getDate();
          const month = today.getMonth() + 1;
          const year = today.getFullYear();
          const url = `https://api.aladhan.com/v1/timings/${day}-${month}-${year}?latitude=${lat}&longitude=${lng}&method=5&school=0&lang=${currentLanguage}`;
          fetch(url)
            .then(res => res.json())
            .then(data => {
              if (data.code !== 200) throw new Error('API Error');
              const timings = data.data.timings;
              document.getElementById('fajr-time').textContent = timings.Fajr;
              document.getElementById('sunrise-time').textContent = timings.Sunrise;
              document.getElementById('dhuhr-time').textContent = timings.Dhuhr;
              document.getElementById('asr-time').textContent = timings.Asr;
              document.getElementById('maghrib-time').textContent = timings.Maghrib;
              document.getElementById('isha-time').textContent = timings.Isha;
              highlightCurrentPrayer(timings);
            })
            .catch(() => {
              showNotification(currentLanguage === 'ar' ? 'تعذر جلب مواقيت الصلاة' : 'Could not fetch prayer times');
            });
        },
        error => {
          if (error.code === error.PERMISSION_DENIED) {
            showNotification(currentLanguage === 'ar' ? 'يرجى السماح بالوصول إلى الموقع من إعدادات المتصفح أو النظام' : 'Please allow location access from your browser or system settings');
          } else if (error.code === error.POSITION_UNAVAILABLE) {
            showNotification(currentLanguage === 'ar' ? 'تعذر تحديد موقعك. تأكد من تفعيل GPS.' : 'Location unavailable. Please enable GPS.');
          } else if (error.code === error.TIMEOUT) {
            showNotification(currentLanguage === 'ar' ? 'انتهت مهلة تحديد الموقع. حاول مجدداً.' : 'Location request timed out. Please try again.');
          } else {
            showNotification(currentLanguage === 'ar' ? 'تعذر تحديد موقعك' : 'Could not determine your location');
          }
        }
      );
    }

    // تمييز الصلاة الحالية بناءً على الوقت
    function highlightCurrentPrayer(timings) {
      const now = new Date();
      const toMinutes = t => {
        const [h, m] = t.split(':');
        return parseInt(h) * 60 + parseInt(m);
      };
      const currentMins = now.getHours() * 60 + now.getMinutes();
      const prayerOrder = [
        { id: 'fajr-time', time: timings.Fajr },
        { id: 'sunrise-time', time: timings.Sunrise },
        { id: 'dhuhr-time', time: timings.Dhuhr },
        { id: 'asr-time', time: timings.Asr },
        { id: 'maghrib-time', time: timings.Maghrib },
        { id: 'isha-time', time: timings.Isha }
      ];
      let currentIdx = 0;
      for (let i = 0; i < prayerOrder.length; i++) {
        if (currentMins >= toMinutes(prayerOrder[i].time)) {
          currentIdx = i;
        }
      }
      document.querySelectorAll('.prayer-time').forEach((el, idx) => {
        el.classList.toggle('current', idx === currentIdx);
      });
    }

    // تحديث اتجاه القبلة وتحريك الإبرة بدقة حسب مستشعر الهاتف
    let qiblaAngle = null;
    let deviceOrientationListener = null;
    function updateQiblaDirection() {
      if (!navigator.geolocation) {
        showNotification(currentLanguage === 'ar' ? 'متصفحك لا يدعم تحديد الموقع' : 'Your browser does not support geolocation');
        return;
      }
      showNotification(currentLanguage === 'ar' ? 'يرجى السماح بالوصول إلى الموقع لتحديد اتجاه القبلة' : 'Please allow location access to determine Qibla direction');
      navigator.geolocation.getCurrentPosition(
        position => {
          const lat = position.coords.latitude;
          const lng = position.coords.longitude;
          fetch(`https://api.aladhan.com/v1/qibla/${lat}/${lng}`)
            .then(res => res.json())
            .then(data => {
              if (data.code === 200) {
                qiblaAngle = data.data.direction; // زاوية القبلة الحقيقية
                const direction = Math.round(qiblaAngle);
                const qiblaElement = document.getElementById('qibla-direction');
                if (qiblaElement) {
                  qiblaElement.textContent = `${direction}°`;
                }
                showNotification((currentLanguage === 'ar' ? 'اتجاه القبلة: ' : 'Qibla direction: ') + direction + '°');
                setupCompassNeedle();
              } else {
                showNotification(currentLanguage === 'ar' ? 'تعذر جلب اتجاه القبلة' : 'Could not fetch Qibla direction');
              }
            })
            .catch(() => {
              showNotification(currentLanguage === 'ar' ? 'تعذر جلب اتجاه القبلة' : 'Could not fetch Qibla direction');
            });
        },
        () => {
          showNotification(currentLanguage === 'ar' ? 'تعذر تحديد موقعك' : 'Could not determine your location');
        }
      );
    }

    // تحريك إبرة القبلة بدقة: الإبرة تشير دائماً إلى اتجاه القبلة الحقيقي
    function setupCompassNeedle() {
      // إزالة أي مستمع سابق
      if (deviceOrientationListener) {
        window.removeEventListener('deviceorientationabsolute', deviceOrientationListener);
        window.removeEventListener('deviceorientation', deviceOrientationListener);
        deviceOrientationListener = null;
      }
      const needle = document.querySelector('.compass-needle');
      if (!needle || qiblaAngle === null) return;

      let orientationSupported = false;
      // مستمع جديد
      deviceOrientationListener = function(event) {
        let heading = null;
        // iOS/Safari
        if (typeof event.webkitCompassHeading !== 'undefined') {
          heading = event.webkitCompassHeading;
        } else if (typeof event.alpha !== 'undefined') {
          // معظم أجهزة أندرويد
          // alpha: 0 = الشمال الحقيقي
          heading = 360 - event.alpha;
        }
        if (heading === null || isNaN(heading)) return;
        orientationSupported = true;
        // الزاوية المطلوبة: الفرق بين زاوية القبلة وheading (الشمال)
        let rotation = qiblaAngle - heading;
        // تصحيح الدوران ليبقى بين 0 و 360
        rotation = ((rotation % 360) + 360) % 360;
        needle.style.transform = `rotate(${rotation}deg)`;
      };
      // دعم الأحداث المختلفة حسب المتصفح
      if ('ondeviceorientationabsolute' in window) {
        window.addEventListener('deviceorientationabsolute', deviceOrientationListener, true);
      } else if ('ondeviceorientation' in window) {
        window.addEventListener('deviceorientation', deviceOrientationListener, true);
      }

      // إذا لم يتم دعم المستشعر، تدوير الإبرة مباشرة إلى زاوية القبلة
      setTimeout(function() {
        if (!orientationSupported) {
          needle.style.transform = `rotate(${qiblaAngle}deg)`;
        }
      }, 1500); // انتظر قليلاً للتأكد من عدم وجود مستشعر
    }

    // معالجة أحداث التحكم في TTS
    function setupTTSControls() {
      const voiceSelect = document.getElementById('tts-voice-select');
      const rateSlider = document.getElementById('tts-rate');
      const pitchSlider = document.getElementById('tts-pitch');
      const rateValue = document.getElementById('tts-rate-value');
      const pitchValue = document.getElementById('tts-pitch-value');

      if (voiceSelect) {
        voiceSelect.addEventListener('change', function() {
          const selectedVoice = availableVoices.find(voice => voice.name === this.value);
          if (selectedVoice) {
            ttsVoice = selectedVoice;
          }
        });
      }

      if (rateSlider && rateValue) {
        rateSlider.addEventListener('input', function() {
          ttsRate = parseFloat(this.value);
          rateValue.textContent = ttsRate.toFixed(1);
        });
      }

      if (pitchSlider && pitchValue) {
        pitchSlider.addEventListener('input', function() {
          ttsPitch = parseFloat(this.value);
          pitchValue.textContent = ttsPitch.toFixed(1);
        });
      }
    }

    // تهيئة التطبيق عند التحميل
    document.addEventListener('DOMContentLoaded', function() {
      // تهيئة TTS
      initializeTTS();
      
      // إعداد عناصر التحكم
      setupTTSControls();
      
      // تحديث مواقيت الصلاة
      updatePrayerTimes();
      
      // تحديث شريط تقدم الوضوء
      updateWuduProgress(1);
      
      // إعداد التحديث التلقائي للوقت
      setInterval(updatePrayerTimes, 60000); // كل دقيقة
      
      // رسالة ترحيب
      setTimeout(() => {
        const welcomeMsg = currentLanguage === 'ar' ? 
          'مرحباً بك! اختر القسم الذي تريد التعلم منه' : 
          'Welcome! Choose the section you want to learn from';
        showNotification(welcomeMsg);
      }, 1000);
    });

    // التعامل مع تغيير حجم الشاشة
    window.addEventListener('resize', function() {
      // إغلاق القائمة المحمولة عند تكبير الشاشة
      if (window.innerWidth > 768 && mobileMenuOpen) {
        toggleMobileMenu();
      }
    });

    // منع النقر المتعدد السريع
    let clickTimeout = false;
    document.addEventListener('click', function(e) {
      if (clickTimeout) return;
      clickTimeout = true;
      setTimeout(() => clickTimeout = false, 300);
    });

    // تأثيرات إضافية للتفاعل
    document.addEventListener('mousemove', function(e) {
      const floatingShapes = document.querySelectorAll('.floating-shape');
      floatingShapes.forEach((shape, index) => {
        const speed = 0.02 + (index * 0.01);
        const x = (e.clientX * speed) - (shape.offsetWidth / 2);
        const y = (e.clientY * speed) - (shape.offsetHeight / 2);
        
        shape.style.transform = `translate(${x}px, ${y}px)`;
      });
    });

    // معالجة أخطاء JavaScript: إخفاء التفاصيل عن المستخدم وعرض رسالة ودية فقط
    window.addEventListener('error', function(e) {
      // لا تظهر أي تفاصيل تقنية للمستخدم
      const friendlyMsg = currentLanguage === 'ar'
        ? 'حدث خلل بسيط، يرجى إعادة المحاولة أو تحديث الصفحة.'
        : 'A minor issue occurred, please try again or refresh the page.';
      showNotification(friendlyMsg);
      // سجل الخطأ للمطور فقط
      if (window.console && window.console.error) {
        console.error('JavaScript Error:', e.error || e);
      }
      // منع ظهور رسالة الخطأ الافتراضية
      return true;
    });

    // تصدير الدوال للاستخدام العام
    window.prayerGuideApp = {
      showTab,
      toggleMobileMenu,
      selectWuduStep,
      playStepAudio,
      resetWudu,
      pauseAudio,
      playPrayerStep,
      playDetailedPrayerStep,
      playAdhanSheikh,
      findQibla,
      calibrateCompass,
      playDua,
      repeatDua,
      startCounter,
      playGeneralAdhan,
      setLanguage,
      testTTS,
      toggleMute,
      toggleTheme,
      resetSettings,
      showNotification,
      playWelcomeAudio,
      speakText
    };

    // إضافة معالج للتحكم في الأصوات عند إغلاق الصفحة
    window.addEventListener('beforeunload', function() {
      if (speechSynthesis.speaking) {
        speechSynthesis.cancel();
      }
    });

    // إضافة معالج لإيقاف الصوت عند تغيير التبويب
    document.addEventListener('visibilitychange', function() {
      if (document.hidden && speechSynthesis.speaking) {
        speechSynthesis.pause();
      } else if (!document.hidden && speechSynthesis.paused) {
        speechSynthesis.resume();
      }
    });

    // معالج خاص للأجهزة المحمولة
    if ('ontouchstart' in window) {
      // إضافة دعم اللمس للعناصر التفاعلية
      document.querySelectorAll('.audio-btn, .nav-tab, .step-item, .card').forEach(element => {
        element.addEventListener('touchstart', function() {
          this.style.transform = 'scale(0.95)';
        });
        
        element.addEventListener('touchend', function() {
          this.style.transform = 'scale(1)';
        });
      });
    }

    // دالة مساعدة لتحديد ما إذا كان المتصفح يدعم TTS
    function isTTSSupported() {
      return 'speechSynthesis' in window && 'SpeechSynthesisUtterance' in window;
    }

    // دالة مساعدة للحصول على أفضل صوت للغة المحددة
    function getBestVoiceForLanguage(lang) {
      if (!isTTSSupported()) return null;
      
      const voices = speechSynthesis.getVoices();
      
      // البحث عن صوت بنفس اللغة
      let voice = voices.find(v => v.lang.startsWith(lang));
      
      // البحث عن صوت افتراضي إذا لم يوجد
      if (!voice) {
        voice = voices.find(v => v.default);
      }
      
      // استخدام أول صوت متاح كحل أخير
      if (!voice && voices.length > 0) {
        voice = voices[0];
      }
      
      return voice;
    }

    // تحسين دالة تهيئة TTS
    function enhancedInitializeTTS() {
      if (!isTTSSupported()) {
        const msg = currentLanguage === 'ar' ? 
          'متصفحك لا يدعم ميزة تحويل النص إلى كلام' :
          'Your browser does not support text-to-speech';
        document.getElementById('tts-support-msg').textContent = msg;
        return;
      }

      // تحديث الأصوات مع محاولات متعددة
      let attempts = 0;
      const maxAttempts = 3;
      
      function tryLoadVoices() {
        const voices = speechSynthesis.getVoices();
        
        if (voices.length > 0) {
          availableVoices = voices;
          populateVoiceList();
          
          // تحديد أفضل صوت للغة الحالية
          const bestVoice = getBestVoiceForLanguage(currentLanguage === 'ar' ? 'ar' : 'en');
          if (bestVoice) {
            ttsVoice = bestVoice;
            const voiceSelect = document.getElementById('tts-voice-select');
            if (voiceSelect) {
              voiceSelect.value = bestVoice.name;
            }
          }
        } else if (attempts < maxAttempts) {
          attempts++;
          setTimeout(tryLoadVoices, 500);
        }
      }

      // محاولة تحميل الأصوات
      if (speechSynthesis.onvoiceschanged !== undefined) {
        speechSynthesis.onvoiceschanged = tryLoadVoices;
      }
      
      // محاولة فورية أيضاً
      tryLoadVoices();
    }

    // استبدال دالة initializeTTS بالنسخة المحسّنة
    initializeTTS = enhancedInitializeTTS;
  </script>
</body>
</html>