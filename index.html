<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ساعة رقمية عالمية </title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/flag-icons@6.11.1/css/flag-icons.min.css" rel="stylesheet">
  <style>
    /* أنماط CSS (نفس الأنماط السابقة دون تغيير) */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Cairo', sans-serif;
      background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
      color: #fff;
      min-height: 100vh;
      overflow-x: hidden;
    }

    [lang="en"] {
      direction: ltr;
      font-family: Arial, sans-serif;
    }

    .header {
      text-align: center;
      padding: 20px;
      background: rgba(0,0,0,0.3);
      backdrop-filter: blur(10px);
      border-bottom: 2px solid rgba(255,215,0,0.3);
    }

    .project-title {
      font-size: 2.5rem;
      font-weight: bold;
      background: linear-gradient(45deg, #FFD700, #FFA500, #FF8C00);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 0 20px rgba(255,215,0,0.5);
      margin-bottom: 10px;
      animation: titleGlow 3s ease-in-out infinite alternate;
      display: flex;
      align-items: center;
      gap: 15px;
      justify-content: center;
    }

    .project-icon {
      font-size: 2.2rem;
      color: #FFD700;
      filter: drop-shadow(0 0 15px #FFD700);
      animation: globeRotate 8s linear infinite;
    }

    @keyframes titleGlow {
      0% { filter: brightness(1); }
      100% { filter: brightness(1.3); }
    }

    @keyframes globeRotate {
      from { transform: rotateY(0deg); }
      to { transform: rotateY(360deg); }
    }

    .subtitle {
      font-size: 1.1rem;
      color: #ccc;
      margin-bottom: 20px;
    }

    .controls {
      display: flex;
      justify-content: center;
      gap: 18px;
      flex-wrap: wrap;
      margin-bottom: 25px;
      padding: 15px;
      background: rgba(0,0,0,0.1);
      border-radius: 25px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,215,0,0.2);
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }

    .btn {
      padding: 14px 20px;
      background: linear-gradient(45deg, #FFD700, #FFA500);
      color: #000;
      font-weight: 600;
      border: none;
      border-radius: 30px;
      text-decoration: none;
      transition: all 0.4s ease;
      cursor: pointer;
      font-size: 0.9rem;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 4px 15px rgba(255,165,0,0.3);
      position: relative;
      overflow: hidden;
      min-width: 160px;
      justify-content: center;
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: left 0.6s ease;
    }

    .btn:hover::before {
      left: 100%;
    }

    .btn:hover {
      background: linear-gradient(45deg, #FFA500, #FF8C00);
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 12px 30px rgba(255,165,0,0.5);
    }

    .btn i {
      font-size: 1.1rem;
      margin-right: 4px;
      transition: transform 0.3s ease;
    }

    .btn:hover i {
      transform: scale(1.2) rotate(5deg);
    }

    /* Special animations for specific icons */
    .btn:hover .fa-sync-alt {
      transform: scale(1.2) rotate(360deg);
      transition: transform 0.6s ease;
    }

    .btn:hover .fa-expand {
      transform: scale(1.3);
    }

    .btn:hover .fa-download {
      transform: scale(1.2) translateY(-2px);
    }

    .btn:hover .fa-language {
      transform: scale(1.2) rotateY(180deg);
    }

    .btn:hover .fa-info-circle {
      transform: scale(1.2);
      color: #0066cc;
    }

    .btn-text {
      position: relative;
      z-index: 1;
    }

    .search-container {
      display: flex;
      justify-content: center;
      margin-bottom: 30px;
    }

    .search-input {
      padding: 12px 20px;
      border: 2px solid rgba(255,215,0,0.3);
      border-radius: 25px;
      background: rgba(0,0,0,0.3);
      color: #fff;
      font-size: 1rem;
      width: 300px;
      max-width: 90%;
      transition: all 0.3s ease;
    }

    .search-input:focus {
      outline: none;
      border-color: #FFD700;
      box-shadow: 0 0 20px rgba(255,215,0,0.3);
    }

    .search-input::placeholder {
      color: #aaa;
    }

    .stats-bar {
      display: flex;
      justify-content: center;
      gap: 30px;
      flex-wrap: wrap;
      margin-bottom: 30px;
      padding: 15px;
    }

    .stat-item {
      display: flex;
      align-items: center;
      gap: 15px;
      background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
      padding: 18px 25px;
      border-radius: 20px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.1);
      transition: all 0.4s ease;
      min-width: 180px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .stat-item:hover {
      transform: translateY(-3px);
      background: linear-gradient(135deg, rgba(255,255,255,0.15), rgba(255,255,255,0.08));
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      border-color: rgba(255,215,0,0.3);
    }

    .stat-icon {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(255,165,0,0.1));
      border: 2px solid rgba(255,215,0,0.3);
      transition: all 0.3s ease;
    }

    .stat-icon i {
      font-size: 1.3rem;
      color: #FFD700;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
      transition: all 0.3s ease;
    }

    .stat-content {
      text-align: left;
      flex: 1;
    }

    .stat-number {
      font-size: 1.8rem;
      font-weight: 700;
      color: #FFD700;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
      margin-bottom: 2px;
      font-family: 'Courier New', monospace;
    }

    .stat-label {
      font-size: 0.9rem;
      color: #e0e0e0;
      font-weight: 500;
    }

    /* Special animations for different stat icons */
    .day-icon {
      background: linear-gradient(135deg, rgba(255,215,0,0.3), rgba(255,165,0,0.2));
    }

    .day-icon i {
      animation: sunRotate 4s linear infinite;
    }

    .night-icon {
      background: linear-gradient(135deg, rgba(100,149,237,0.3), rgba(70,130,180,0.2));
    }

    .night-icon i {
      color: #6495ED;
      animation: moonPulse 3s ease-in-out infinite;
    }

    .stat-item:hover .stat-icon {
      transform: scale(1.1);
      box-shadow: 0 4px 15px rgba(255,215,0,0.3);
    }

    .stat-item:hover .stat-icon i {
      filter: drop-shadow(0 0 10px currentColor);
    }

    @keyframes sunRotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    @keyframes moonPulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.7; transform: scale(1.1); }
    }

    .clock-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 20px;
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
      transition: opacity 0.3s ease, transform 0.3s ease;
    }

    .clock-box {
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
      border: 2px solid rgba(255,255,255,0.15);
      border-radius: 25px;
      padding: 25px;
      text-align: center;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      cursor: pointer;
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(15px);
      animation: fadeInUp 0.6s ease forwards;
      opacity: 0;
      transform: translateY(20px);
      box-shadow: 
        0 8px 32px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.2);
    }

    .clock-box::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
      border-radius: 25px;
      z-index: -1;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .clock-box:hover::before {
      opacity: 1;
    }

    @keyframes fadeInUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .clock-box::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      transition: left 0.6s ease;
    }

    .clock-box:hover::before {
      left: 100%;
    }

    .clock-box:hover {
      transform: translateY(-8px) scale(1.03);
      box-shadow: 
        0 20px 60px rgba(255,255,255,0.15),
        0 0 30px rgba(255,215,0,0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.3);
      border-color: rgba(255,215,0,0.6);
    }

    .country-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 15px;
      margin-bottom: 20px;
      padding: 15px;
      background: rgba(255,255,255,0.05);
      border-radius: 15px;
      border: 1px solid rgba(255,255,255,0.1);
      flex-wrap: wrap;
    }

    .time-status-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
      background: rgba(0,0,0,0.4);
      padding: 8px 12px;
      border-radius: 20px;
      border: 1px solid rgba(255,215,0,0.3);
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      transition: all 0.3s ease;
      min-width: fit-content;
    }

    .time-status-indicator:hover {
      background: rgba(0,0,0,0.6);
      border-color: rgba(255,215,0,0.5);
      transform: scale(1.05);
    }

    .country-flag {
      font-size: 2.5rem;
      line-height: 1;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
      transition: transform 0.3s ease;
    }

    .clock-box:hover .country-flag {
      transform: scale(1.1);
    }

    .flag-icon {
      width: 48px;
      height: 36px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      border: 2px solid rgba(255,255,255,0.2);
      transition: transform 0.3s ease;
    }

    .clock-box:hover .flag-icon {
      transform: scale(1.05);
    }

    .country-name {
      font-size: 1.3rem;
      font-weight: 700;
      color: #fff;
      text-shadow: 0 2px 4px rgba(0,0,0,0.5);
      margin: 0;
      flex: 1;
      text-align: center;
      min-width: 0;
    }

    .location-info {
      font-size: 0.9rem;
      color: #bbb;
      margin-bottom: 15px;
      padding: 8px 12px;
      background: rgba(255,255,255,0.05);
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: all 0.3s ease;
    }

    .location-info:hover {
      background: rgba(255,255,255,0.1);
      color: #fff;
    }

    .location-info i {
      color: #FFD700;
      font-size: 0.8rem;
    }

    .clock-display {
      font-size: 2.4rem;
      font-weight: 900;
      margin: 20px 0;
      text-shadow: 0 0 25px currentColor, 0 0 45px currentColor, 0 2px 8px rgba(0,0,0,0.8);
      animation: clockPulse 2s infinite;
      background: linear-gradient(135deg, rgba(0,0,0,0.4), rgba(0,0,0,0.2));
      padding: 18px;
      border-radius: 18px;
      border: 3px solid rgba(255,255,255,0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(10px);
      box-shadow: 
        0 8px 32px rgba(0,0,0,0.4),
        inset 0 1px 0 rgba(255,255,255,0.2),
        inset 0 -1px 0 rgba(0,0,0,0.2);
    }

    .clock-display::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      transition: left 1s ease;
    }

    .clock-box:hover .clock-display::before {
      left: 100%;
    }

    @keyframes clockPulse {
      0%, 100% { 
        transform: scale(1);
        box-shadow: 
          0 8px 32px rgba(0,0,0,0.4),
          inset 0 1px 0 rgba(255,255,255,0.2),
          inset 0 -1px 0 rgba(0,0,0,0.2);
      }
      50% { 
        transform: scale(1.03);
        box-shadow: 
          0 12px 40px rgba(0,0,0,0.5),
          inset 0 1px 0 rgba(255,255,255,0.3),
          inset 0 -1px 0 rgba(0,0,0,0.2);
      }
    }

    .time-info {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin: 15px 0;
    }

    .time-item {
      background: rgba(0,0,0,0.3);
      padding: 10px;
      border-radius: 10px;
      font-size: 0.85rem;
      color: #e0e0e0;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
      backdrop-filter: blur(5px);
      border: 1px solid rgba(255,255,255,0.1);
    }

    .time-item:hover {
      background: rgba(0,0,0,0.4);
      border-color: rgba(255,215,0,0.3);
      color: #fff;
      transform: translateY(-1px);
    }

    .prayer-info {
      background: linear-gradient(135deg, rgba(255,215,0,0.15), rgba(255,165,0,0.1));
      padding: 15px;
      border-radius: 15px;
      margin-top: 15px;
      font-size: 0.9rem;
      border: 1px solid rgba(255,215,0,0.3);
      box-shadow: 0 4px 12px rgba(255,215,0,0.1);
    }

    .prayer-header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 12px;
      font-weight: 700;
      color: #FFD700;
      font-size: 1rem;
    }

    .prayer-times-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
      gap: 8px;
    }

    .prayer-item {
      background: rgba(0,0,0,0.3);
      padding: 8px 6px;
      border-radius: 10px;
      text-align: center;
      transition: all 0.3s ease;
      border: 1px solid rgba(255,255,255,0.1);
      position: relative;
      overflow: hidden;
    }

    .prayer-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      transition: left 0.6s ease;
    }

    .prayer-item:hover::before {
      left: 100%;
    }

    .prayer-item:hover {
      background: rgba(255,215,0,0.2);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(255,215,0,0.2);
    }

    .prayer-name {
      font-size: 0.75rem;
      font-weight: 600;
      margin-bottom: 2px;
      color: #FFD700;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
    }

    .prayer-time {
      font-size: 0.8rem;
      font-weight: 700;
      color: #fff;
    }

    .weather-info {
      background: linear-gradient(135deg, rgba(0,191,255,0.15), rgba(30,144,255,0.1));
      padding: 12px;
      border-radius: 12px;
      margin-top: 10px;
      font-size: 0.9rem;
      border: 1px solid rgba(0,191,255,0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.3s ease;
    }

    .weather-info:hover {
      background: linear-gradient(135deg, rgba(0,191,255,0.25), rgba(30,144,255,0.2));
      transform: translateY(-1px);
    }

    .weather-icon {
      font-size: 1.2rem;
      color: #00BFFF;
    }

    .time-info {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin: 15px 0;
    }

    .time-item {
      background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
      padding: 10px;
      border-radius: 12px;
      font-size: 0.85rem;
      border: 1px solid rgba(255,255,255,0.1);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .time-item:hover {
      background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0.1));
      transform: translateY(-1px);
    }

    .time-icon {
      font-size: 1.1rem;
      opacity: 0.9;
      margin-right: 8px;
      filter: drop-shadow(0 1px 2px rgba(0,0,0,0.5));
      transition: all 0.3s ease;
    }

    .clock-display .time-icon {
      font-size: 1.4rem;
      opacity: 1;
      animation: clockIconPulse 2s infinite;
    }

    @keyframes clockIconPulse {
      0%, 100% { 
        transform: scale(1);
        opacity: 0.9;
      }
      50% { 
        transform: scale(1.1);
        opacity: 1;
      }
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(5px);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background: linear-gradient(135deg, #1a1a2e, #16213e);
      padding: 40px;
      border-radius: 20px;
      max-width: 800px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
      border: 1px solid rgba(255,215,0,0.3);
      text-align: right;
    }

    [lang="en"] .modal-content {
      text-align: left;
    }

    .modal-header {
      text-align: center;
      margin-bottom: 30px;
    }

    .modal-title {
      font-size: 1.8rem;
      color: #FFD700;
      margin-bottom: 10px;
    }

    .country-details {
      display: grid;
      gap: 15px;
    }

    .detail-item {
      background: rgba(255,255,255,0.05);
      padding: 15px;
      border-radius: 10px;
      border-left: 4px solid #FFD700;
    }

    [lang="en"] .detail-item {
      border-left: none;
      border-right: 4px solid #FFD700;
    }

    .detail-label {
      font-weight: bold;
      color: #FFD700;
      margin-bottom: 5px;
    }

    .detail-value {
      color: #ccc;
    }

    .close-btn {
      position: absolute;
      top: 15px;
      right: 15px;
      background: rgba(255,0,0,0.2);
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      cursor: pointer;
      font-size: 1.2rem;
      transition: all 0.3s ease;
    }

    .close-btn:hover {
      background: rgba(255,0,0,0.4);
      transform: rotate(90deg);
    }

    /* Prayer Modal Styles */
    .prayer-modal-content {
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
    }

    .prayer-modal-info {
      display: grid;
      gap: 15px;
      margin-bottom: 30px;
    }

    .prayer-detail-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      background: rgba(255,255,255,0.05);
      border-radius: 10px;
      border-right: 3px solid #FFD700;
    }

    [lang="en"] .prayer-detail-item {
      border-right: none;
      border-left: 3px solid #FFD700;
    }

    .prayer-detail-label {
      font-weight: bold;
      color: #FFD700;
    }

    .prayer-detail-value {
      color: #fff;
      font-weight: 600;
    }

    .next-prayer-info {
      background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(255,165,0,0.1));
      padding: 20px;
      border-radius: 15px;
      margin-bottom: 25px;
      text-align: center;
      border: 2px solid rgba(255,215,0,0.3);
    }

    .next-prayer-header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-bottom: 15px;
      font-weight: bold;
      color: #FFD700;
      font-size: 1.1rem;
    }

    .next-prayer-name {
      font-size: 1.8rem;
      font-weight: bold;
      color: #FFD700;
      margin-bottom: 10px;
    }

    .next-prayer-time {
      font-size: 2.2rem;
      font-weight: 900;
      color: #fff;
      margin-bottom: 15px;
      text-shadow: 0 0 10px rgba(255,215,0,0.5);
    }

    .time-remaining {
      margin-bottom: 20px;
    }

    .remaining-label {
      font-size: 0.9rem;
      color: #ccc;
      margin-bottom: 5px;
    }

    .remaining-time {
      font-size: 1.5rem;
      font-weight: bold;
      color: #FFD700;
      font-family: 'Courier New', monospace;
    }

    .prayer-progress-bar {
      width: 100%;
      height: 8px;
      background: rgba(0,0,0,0.3);
      border-radius: 4px;
      overflow: hidden;
      margin-top: 15px;
    }

    .prayer-progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #FFD700, #FFA500);
      border-radius: 4px;
      transition: width 1s ease;
      box-shadow: 0 0 10px rgba(255,215,0,0.5);
    }

    .prayer-times-detailed {
      margin-bottom: 25px;
    }

    .prayer-times-header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-bottom: 15px;
      font-weight: bold;
      color: #FFD700;
      font-size: 1.1rem;
    }

    .prayer-times-list {
      display: grid;
      gap: 10px;
    }

    .prayer-time-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.1);
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .prayer-time-item:hover {
      background: rgba(255,215,0,0.1);
      border-color: #FFD700;
      transform: translateY(-2px);
    }

    .prayer-time-item.active {
      background: rgba(255,215,0,0.2);
      border-color: #FFD700;
      box-shadow: 0 0 15px rgba(255,215,0,0.3);
    }

    .prayer-name-detailed {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: bold;
      color: #fff;
    }

    .prayer-time-detailed {
      font-size: 1.1rem;
      font-weight: bold;
      color: #FFD700;
      font-family: 'Courier New', monospace;
    }

    .prayer-location-changer {
      background: rgba(0,0,0,0.2);
      padding: 20px;
      border-radius: 15px;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .location-changer-header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-bottom: 15px;
      font-weight: bold;
      color: #FFD700;
      font-size: 1.1rem;
    }

    .location-inputs {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 15px;
    }

    .location-inputs select {
      padding: 10px;
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 8px;
      background: rgba(255,255,255,0.05);
      color: #fff;
      font-size: 1rem;
    }

    .location-inputs select:focus {
      outline: none;
      border-color: #FFD700;
      box-shadow: 0 0 10px rgba(255,215,0,0.3);
    }

    .update-location-btn {
      width: 100%;
      padding: 12px;
      background: linear-gradient(135deg, #FFD700, #FFA500);
      color: #000;
      border: none;
      border-radius: 10px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .update-location-btn:hover {
      background: linear-gradient(135deg, #FFA500, #FFD700);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(255,215,0,0.4);
    }

    @media (max-width: 768px) {
      .location-inputs {
        grid-template-columns: 1fr;
      }
      
      .prayer-modal-content {
        margin: 10px;
        max-height: 95vh;
      }
    }

    .copyright {
      text-align: center;
      padding: 30px 20px;
      color: #666;
      border-top: 1px solid rgba(255,255,255,0.1);
      margin-top: 40px;
    }

    .floating-clock {
      position: fixed;
      top: 20px;
      left: 20px;
      background: rgba(0,0,0,0.05);
      backdrop-filter: blur(25px);
      padding: 12px 18px;
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,0.15);
      z-index: 100;
      box-shadow: 
        0 8px 32px rgba(0,0,0,0.1),
        inset 0 1px 0 rgba(255,255,255,0.1);
      transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      min-width: 160px;
      opacity: 0.85;
    }

    .floating-clock:hover {
      background: rgba(0,0,0,0.15);
      transform: translateY(-3px) scale(1.02);
      box-shadow: 
        0 16px 48px rgba(0,0,0,0.2),
        inset 0 1px 0 rgba(255,255,255,0.2);
      border-color: rgba(255,215,0,0.3);
      opacity: 1;
    }

    .local-clock-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    .local-clock-header i {
      font-size: 0.9rem;
      color: #FFD700;
      animation: clockTick 2s infinite;
      filter: drop-shadow(0 1px 2px rgba(0,0,0,0.5));
    }

    .local-label {
      font-size: 0.75rem;
      color: #FFD700;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      text-shadow: 0 1px 2px rgba(0,0,0,0.5);
    }

    .local-time-display {
      font-size: 1.3rem;
      font-weight: 700;
      color: #ffffff;
      font-family: 'Courier New', monospace;
      text-align: center;
      text-shadow: 0 2px 4px rgba(0,0,0,0.7);
      margin-bottom: 4px;
      letter-spacing: 1px;
    }

    .local-date-display {
      font-size: 0.7rem;
      color: #e0e0e0;
      text-align: center;
      opacity: 0.9;
      text-shadow: 0 1px 2px rgba(0,0,0,0.5);
    }

    @keyframes clockTick {
      0%, 50% { 
        opacity: 1;
        transform: scale(1);
      }
      51%, 100% { 
        opacity: 0.6;
        transform: scale(0.95);
      }
    }

    @media (max-width: 768px) {
      .project-title {
        font-size: 2rem;
      }
      
      .clock-container {
        grid-template-columns: 1fr;
        padding: 10px;
      }
      
      .stats-bar {
        flex-direction: column;
        gap: 15px;
      }
      
      .floating-clock {
        position: fixed;
        top: 10px;
        left: 10px;
        right: 10px;
        margin: 0;
        background: rgba(0,0,0,0.2);
        backdrop-filter: blur(15px);
        padding: 10px 15px;
        border-radius: 15px;
        min-width: auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .local-clock-header {
        margin-bottom: 0;
      }

      .local-time-display {
        font-size: 1rem;
        margin-bottom: 0;
      }

      .local-date-display {
        font-size: 0.6rem;
      }

      .prayer-info {
        grid-template-columns: 1fr;
      }
    }

    .continent-filter {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 15px;
      max-width: 1200px;
      margin: 0 auto 30px auto;
      padding: 20px;
    }

    .continent-btn {
      padding: 15px 20px;
      background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
      color: #fff;
      border: 2px solid rgba(255,255,255,0.2);
      border-radius: 15px;
      cursor: pointer;
      transition: all 0.4s ease;
      font-size: 1rem;
      font-weight: 600;
      text-align: center;
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(10px);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }

    .continent-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      transition: left 0.6s ease;
    }

    .continent-btn:hover::before {
      left: 100%;
    }

    .continent-btn:hover {
      transform: translateY(-5px) scale(1.05);
      background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(255,165,0,0.15));
      border-color: #FFD700;
      color: #FFD700;
      box-shadow: 0 8px 25px rgba(255,215,0,0.3);
    }

    .continent-btn.active {
      background: linear-gradient(135deg, rgba(255,215,0,0.3), rgba(255,165,0,0.2));
      border-color: #FFD700;
      color: #FFD700;
      transform: scale(1.05);
      box-shadow: 0 0 30px rgba(255,215,0,0.4);
    }

    .continent-icon {
      font-size: 1.8rem;
      line-height: 1;
      margin-bottom: 8px;
      transition: all 0.4s ease;
      background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(255,165,0,0.1));
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      border: 2px solid rgba(255,215,0,0.3);
    }

    .continent-icon i {
      color: #FFD700;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
      transition: all 0.3s ease;
    }

    .continent-btn:hover .continent-icon {
      transform: scale(1.1) rotate(5deg);
      background: linear-gradient(135deg, rgba(255,215,0,0.4), rgba(255,165,0,0.2));
      box-shadow: 0 8px 25px rgba(255,215,0,0.3);
      border-color: rgba(255,215,0,0.5);
    }

    .continent-btn:hover .continent-icon i {
      color: #fff;
      filter: drop-shadow(0 0 10px #FFD700);
      transform: scale(1.2);
    }

    .continent-btn.active .continent-icon {
      background: linear-gradient(135deg, rgba(255,215,0,0.6), rgba(255,165,0,0.3));
      box-shadow: 0 6px 20px rgba(255,215,0,0.4);
      border-color: rgba(255,215,0,0.7);
    }

    .continent-btn.active .continent-icon i {
      color: #fff;
      filter: drop-shadow(0 0 8px #FFD700);
    }

    .continent-name {
      font-size: 0.9rem;
      font-weight: 600;
    }

    .continent-count {
      font-size: 0.75rem;
      opacity: 0.8;
      background: rgba(0,0,0,0.3);
      padding: 2px 8px;
      border-radius: 10px;
      margin-top: 4px;
    }

    .day-night-indicator {
      position: absolute;
      top: 15px;
      right: 15px;
      font-size: 1.8rem;
      animation: float 3s ease-in-out infinite;
      padding: 8px;
      background: rgba(0,0,0,0.3);
      border-radius: 50%;
      backdrop-filter: blur(5px);
      border: 2px solid rgba(255,255,255,0.2);
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    @keyframes float {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-8px) rotate(5deg); }
    }

    .timezone-offset {
      color: #888;
      font-size: 0.8rem;
      margin-top: 5px;
    }

    .loading {
      display: none;
      text-align: center;
      padding: 40px 20px;
      color: #FFD700;
      font-size: 1.2rem;
      background: rgba(255,255,255,0.05);
      border-radius: 15px;
      margin: 20px auto;
      max-width: 400px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,215,0,0.3);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.8; }
      50% { opacity: 1; }
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(255,215,0,0.9);
      color: #000;
      padding: 15px 20px;
      border-radius: 10px;
      z-index: 1001;
      transform: translateX(400px);
      transition: transform 0.3s ease;
    }

    .notification.show {
      transform: translateX(0);
    }

    .about-content h2 {
      color: #FFA500;
      margin-top: 30px;
    }

    .about-content p, .about-content ul {
      font-size: 1.1rem;
      line-height: 1.9;
      color: #ccc;
    }

    .about-content ul {
      padding-right: 20px;
      list-style-position: outside;
    }

    [lang="en"] .about-content ul {
      padding-right: 0;
      padding-left: 20px;
    }

    .about-content a {
      color: #00BFFF;
      text-decoration: none;
    }

    .about-content a:hover {
      text-decoration: underline;
    }

    .lang-switch {
      margin-top: 20px;
      text-align: center;
    }

    .lang-switch button {
      background-color: #FFD700;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      color: #000;
    }

    .lang-switch button:hover {
      background-color: #FFA500;
    }

    .no-results {
      text-align: center;
      padding: 20px;
      color: #FFD700;
      font-size: 1.2rem;
    }

    /* Prayer countdown styles */
    .prayer-countdown-container {
      margin-top: 8px;
      padding: 8px;
      background: rgba(0, 255, 136, 0.1);
      border-radius: 8px;
      border: 1px solid rgba(0, 255, 136, 0.3);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .next-prayer-name {
      font-size: 13px;
      color: #ffd700;
      margin-bottom: 6px;
      font-weight: 700;
      text-align: center;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
    }

    .countdown-timer {
      font-size: 16px;
      color: #00ff88;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      margin-bottom: 6px;
      text-align: center;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
      letter-spacing: 1px;
    }

    .countdown-progress {
      width: 100%;
      height: 6px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 3px;
      overflow: hidden;
      box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    .countdown-progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #00ff88, #ffd700, #ff6b6b);
      transition: width 0.5s ease;
      border-radius: 3px;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    }
  </style>
</head>
<body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/luxon/3.4.4/luxon.min.js"></script>

  <div class="floating-clock" id="local-clock">
    <div class="local-clock-header">
      <i class="fas fa-clock"></i>
      <span class="local-label" id="local-label">التوقيت المحلي</span>
    </div>
    <div class="local-time-display" id="local-time">--:--:--</div>
    <div class="local-date-display" id="local-date">--/--/----</div>
  </div>

  <div class="notification" id="notification"></div>

  <header class="header">
    <h1 class="project-title">
      <i class="fas fa-globe-americas project-icon"></i>
      ساعة رقمية عالمية
    </h1>
    <p class="subtitle">استكشف أوقات العالم مع المعلومات الجغرافية والثقافية</p>
    
    <div class="controls">
      <button class="btn" onclick="openAboutModal()">
        <i class="fas fa-info-circle"></i>
        <span class="btn-text"> نبذة عن المشروع</span>
      </button>
      <button class="btn" onclick="toggleFullscreen()">
        <i class="fas fa-expand"></i>
        <span class="btn-text"> ملء الشاشة</span>
      </button>
      <button class="btn" onclick="exportData()">
        <i class="fas fa-download"></i>
        <span class="btn-text"> تصدير البيانات</span>
      </button>
      <button class="btn" onclick="refreshClocks()">
        <i class="fas fa-sync-alt"></i>
        <span class="btn-text"> تحديث</span>
      </button>
      <button class="btn" onclick="toggleLanguage()">
        <i class="fas fa-language"></i>
        <span class="btn-text"> تغيير اللغة</span>
      </button>
    </div>

    <div class="search-container">
      <input type="text" class="search-input" id="search-input" placeholder=" البحث عن دولة..." oninput="filterCountries()">
    </div>

    <div class="continent-filter" id="continent-filter">
      <button class="continent-btn active" onclick="filterByContinent('all')">
        <div class="continent-icon">
          <i class="fas fa-globe-americas"></i>
        </div>
        <div class="continent-name">الكل</div>
        <div class="continent-count" id="all-count">0</div>
      </button>
      <button class="continent-btn" onclick="filterByContinent('asia')">
        <div class="continent-icon">
          <i class="fas fa-torii-gate"></i>
        </div>
        <div class="continent-name">آسيا</div>
        <div class="continent-count" id="asia-count">0</div>
      </button>
      <button class="continent-btn" onclick="filterByContinent('africa')">
        <div class="continent-icon">
          <i class="fas fa-globe-africa"></i>
        </div>
        <div class="continent-name">أفريقيا</div>
        <div class="continent-count" id="africa-count">0</div>
      </button>
      <button class="continent-btn" onclick="filterByContinent('europe')">
        <div class="continent-icon">
          <i class="fas fa-globe-europe"></i>
        </div>
        <div class="continent-name">أوروبا</div>
        <div class="continent-count" id="europe-count">0</div>
      </button>
      <button class="continent-btn" onclick="filterByContinent('america')">
        <div class="continent-icon">
          <i class="fas fa-landmark"></i>
        </div>
        <div class="continent-name">الأمريكتان</div>
        <div class="continent-count" id="america-count">0</div>
      </button>
      <button class="continent-btn" onclick="filterByContinent('oceania')">
        <div class="continent-icon">
          <i class="fas fa-water"></i>
        </div>
        <div class="continent-name">أوقيانوسيا</div>
        <div class="continent-count" id="oceania-count">0</div>
      </button>
    </div>

    <div class="stats-bar">
      <div class="stat-item">
        <div class="stat-icon">
          <i class="fas fa-globe"></i>
        </div>
        <div class="stat-content">
          <div class="stat-number" id="total-countries">0</div>
          <div class="stat-label">إجمالي الدول</div>
        </div>
      </div>
      <div class="stat-item">
        <div class="stat-icon day-icon">
          <i class="fas fa-sun"></i>
        </div>
        <div class="stat-content">
          <div class="stat-number" id="day-countries">0</div>
          <div class="stat-label">دول في النهار</div>
        </div>
      </div>
      <div class="stat-item">
        <div class="stat-icon night-icon">
          <i class="fas fa-moon"></i>
        </div>
        <div class="stat-content">
          <div class="stat-number" id="night-countries">0</div>
          <div class="stat-label">دول في الليل</div>
        </div>
      </div>
      <div class="stat-item">
        <div class="stat-icon">
          <i class="fas fa-clock"></i>
        </div>
        <div class="stat-content">
          <div class="stat-number" id="timezones-count">0</div>
          <div class="stat-label">المناطق الزمنية</div>
        </div>
      </div>
    </div>
  </header>

  <main>
    <div class="loading" id="loading">⏳ جاري تحديث البيانات...</div>
    <div class="clock-container" id="clocks"></div>
  </main>

  <div class="modal" id="country-modal">
    <div class="modal-content">
      <button class="close-btn" onclick="closeModal()">×</button>
      <div class="modal-header">
        <h2 class="modal-title" id="modal-country-name"></h2>
        <div id="modal-country-flag" style="font-size: 3rem;"></div>
      </div>
      <div class="country-details" id="country-details"></div>
    </div>
  </div>

  <div class="modal" id="about-modal">
    <div class="modal-content">
      <button class="close-btn" onclick="closeModal()">×</button>
      <div class="modal-header">
        <h2 class="modal-title"> نبذة عن المشروع</h2>
      </div>
      <div class="about-content" id="about-content-ar">
        <p>
          هذا المشروع هو مبادرة تقنية إبداعية من تطوير <strong>عبد الصمد بوركيبات</strong>، باحث في <strong>فقه الأمن السيبراني الأسري</strong>، وطالب في:
        </p>
        <ul>
          <li>🎓 بكالوريوس علوم الحاسوب – <strong>جامعة الشعب الأمريكية</strong></li>
          <li>🕋 بكالوريوس علوم القرآن الكريم – <strong>جامعة المدينة العالمية بماليزيا</strong></li>
        </ul>
        <h2> فكرة المشروع:</h2>
        <p>
          تم تطوير هذا المشروع لعرض التوقيت العالمي الحقيقي لأكثر من 40 دولة، مع دعم كامل للتقويمين <strong>الميلادي والهجري</strong>، وتحديد حالة <strong>الليل والنهار</strong>، وأوقات الصلاة لكل دولة بدقة، في واجهة مرئية متقدمة وسهلة الاستخدام.
        </p>
        <h2>أهداف المشروع:</h2>
        <ul>
          <li>التوعية بالزمن العالمي وترسيخ احترام الوقت.</li>
          <li>تعزيز الهوية السيبرانية الثقافية والأخلاقية.</li>
          <li>دمج القيم الإسلامية في تصميمات رقمية عصرية.</li>
          <li>نشر وعي الأسرة بأهمية الزمن في السياق السيبراني.</li>
        </ul>
        <h2>⚙️ مميزات تقنية:</h2>
        <ul>
          <li>يعرض الوقت الحقيقي لكل دولة بتنسيق سهل القراءة.</li>
          <li>يدمج التقويم الميلادي والهجري في كل بطاقة زمنية.</li>
          <li>يعرض أوقات الصلاة باستخدام Aladhan API.</li>
          <li>تمييز تلقائي بين الليل والنهار حسب التوقيت المحلي للدولة.</li>
          <li>تصميم متجاوب، مرن، ومناسب لجميع الأجهزة.</li>
          <li>معلومات الطقس في الوقت الحقيقي باستخدام OpenWeatherMap API.</li>
        </ul>
        <p>
          يمكن الوصول إلى الكود المصدري للمشروع على منصة GitHub:
          <a href="https://github.com/ABDESSAMAD-BOURKIBATE/DigitalWorldClock" target="_blank">
            DigitalWorldClock على GitHub
          </a>
        </p>
        <div class="lang-switch">
          <button onclick="toggleAboutLang('en')">🌐 English Version</button>
        </div>
      </div>
      <div class="about-content" id="about-content-en" style="display: none;">
        <p>
          This project is a creative and technical initiative developed by <strong>Abdessamad Bourkibate</strong>, a researcher in <strong>Family Cybersecurity Jurisprudence</strong>, and a student of:
        </p>
        <ul>
          <li>🎓 Bachelor in Computer Science – <strong>University of the People (USA)</strong></li>
          <li>🕋 Bachelor in Quranic Sciences – <strong>Al-Madinah International University (Malaysia)</strong></li>
        </ul>
        <h2> Project Concept:</h2>
        <p>
          A visual web application that displays the real-time clocks of over 40 countries, with integrated <strong>Gregorian and Hijri calendars</strong>, a dynamic indicator of <strong>day or night</strong>, and prayer times for each country.
        </p>
        <h2> Project Goals:</h2>
        <ul>
          <li>Promote awareness of global time and its ethical significance.</li>
          <li>Bridge Islamic values with digital design practices.</li>
          <li>Promote family-based time mindfulness in cyberspace.</li>
          <li>Reinforce ethical cyber identity in a modern interface.</li>
        </ul>
        <h2>⚙️ Technical Features:</h2>
        <ul>
          <li>Real-time display for each selected country.</li>
          <li>Dual calendar support (Gregorian and Hijri).</li>
          <li>Prayer times integration using Aladhan API.</li>
          <li>Visual differentiation between day and night per timezone.</li>
          <li>Responsive and user-friendly interface.</li>
          <li>Real-time weather information using OpenWeatherMap API.</li>
        </ul>
        <p>
          Source code available on GitHub:
          <a href="https://github.com/ABDESSAMAD-BOURKIBATE/DigitalWorldClock" target="_blank">
            DigitalWorldClock on GitHub
          </a>
        </p>
        <div class="lang-switch">
          <button onclick="toggleAboutLang('ar')">🌐 النسخة العربية</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal" id="prayer-modal">
    <div class="modal-content prayer-modal-content">
      <button class="close-btn" onclick="closePrayerModal()">×</button>
      <div class="modal-header">
        <h2 class="modal-title" id="prayer-modal-title">تفاصيل أوقات الصلاة</h2>
        <div id="prayer-modal-flag" style="font-size: 3rem;"></div>
      </div>
      
      <div class="prayer-modal-info">
        <div class="prayer-detail-item">
          <div class="prayer-detail-label" id="prayer-city-label">المدينة:</div>
          <div class="prayer-detail-value" id="prayer-city"></div>
        </div>
        <div class="prayer-detail-item">
          <div class="prayer-detail-label" id="prayer-country-label">الدولة:</div>
          <div class="prayer-detail-value" id="prayer-country"></div>
        </div>
        <div class="prayer-detail-item">
          <div class="prayer-detail-label" id="prayer-full-date-label">التاريخ الكامل:</div>
          <div class="prayer-detail-value" id="prayer-full-date"></div>
        </div>
        <div class="prayer-detail-item">
          <div class="prayer-detail-label" id="prayer-hijri-date-label">التاريخ الهجري:</div>
          <div class="prayer-detail-value" id="prayer-hijri-date"></div>
        </div>
      </div>

      <div class="next-prayer-info">
        <div class="next-prayer-header">
          <i class="fas fa-clock"></i>
          <span id="next-prayer-header-text">الصلاة القادمة</span>
        </div>
        <div class="next-prayer-name" id="next-prayer-name">الفجر</div>
        <div class="next-prayer-time" id="next-prayer-time">05:30 AM</div>
        <div class="time-remaining">
          <div class="remaining-label" id="remaining-label">الوقت المتبقي:</div>
          <div class="remaining-time" id="remaining-time">2:30:45</div>
        </div>
        <div class="prayer-progress-bar">
          <div class="prayer-progress-fill" id="prayer-progress"></div>
        </div>
      </div>

      <div class="prayer-times-detailed">
        <div class="prayer-times-header">
          <i class="fas fa-mosque"></i>
          <span id="prayer-times-header-text">جميع أوقات الصلاة</span>
        </div>
        <div class="prayer-times-list" id="prayer-times-list">
          <!-- سيتم ملؤها بـ JavaScript -->
        </div>
      </div>

      <div class="prayer-location-changer">
        <div class="location-changer-header">
          <i class="fas fa-map-marker-alt"></i>
          <span id="location-changer-header-text">تغيير الموقع</span>
        </div>
        <div class="location-inputs">
          <select id="country-selector" onchange="updateCityOptions()">
            <option value="" id="select-country-option">اختر الدولة</option>
          </select>
          <select id="city-selector" onchange="updatePrayerLocation()">
            <option value="" id="select-city-option">اختر المدينة</option>
          </select>
        </div>
        <button class="update-location-btn" onclick="refreshPrayerTimes()">
          <i class="fas fa-sync-alt"></i>
          <span id="update-times-text">تحديث الأوقات</span>
        </button>
      </div>
    </div>
  </div>

  <footer class="copyright">
    <p>حقوق النشر © عبد الصمد بوركيبات - 2025</p>
  </footer>

  <script>
    const { DateTime } = luxon;

    // Language settings
    let currentLanguage = 'ar';
    const translations = {
      ar: {
        title: 'ساعة رقمية عالمية  ',
        subtitle: 'استكشف أوقات العالم مع المعلومات الجغرافية والثقافية',
        localClock: ' التوقيت المحلي',
        aboutBtn: '<i class="fas fa-info-circle"></i> نبذة عن المشروع',
        fullscreenBtn: '<i class="fas fa-expand"></i> ملء الشاشة',
        exportBtn: '<i class="fas fa-download"></i> تصدير البيانات',
        refreshBtn: '<i class="fas fa-sync-alt"></i> تحديث',
        langBtn: '<i class="fas fa-language"></i> تغيير اللغة',
        searchPlaceholder: ' البحث عن دولة...',
        noResults: 'لم يتم العثور على دول تطابق البحث',
        allContinents: 'الكل',
        all: 'الكل',
        asia: 'آسيا',
        africa: 'أفريقيا',
        europe: 'أوروبا',
        america: 'الأمريكتان',
        americas: 'الأمريكتان',
        oceania: 'أوقيانوسيا',
        countries: 'دولة',
        showingCountries: 'عرض دول',
        totalCountries: 'إجمالي الدول',
        dayCountries: 'دول في النهار',
        nightCountries: 'دول في الليل',
        timezones: 'المناطق الزمنية',
        loading: '⏳ جاري تحديث البيانات...',
        aboutTitle: ' نبذة عن المشروع',
        copyright: 'حقوق النشر © عبد الصمد بوركيبات - 2025',
        capital: 'العاصمة',
        time: 'التوقيت',
        continent: 'القارة',
        country: 'الدولة',
        weather: 'الطقس',
        description: 'الوصف',
        leader: 'القائد',
        population: 'السكان',
        timezone: 'المنطقة الزمنية',
        coordinates: 'الإحداثيات',
        area: 'المساحة',
        currency: 'العملة',
        language: 'اللغة',
        weatherTemp: 'درجة الحرارة',
        weatherCondition: 'الحالة',
        weatherHumidity: 'الرطوبة',
        weatherWind: 'الرياح',
        prayerTimes: 'أوقات الصلاة',
        fajr: 'الفجر',
        dhuhr: 'الظهر',
        asr: 'العصر',
        maghrib: 'المغرب',
        isha: 'العشاء',
        nextPrayer: 'الصلاة القادمة',
        timeRemaining: 'الوقت المتبقي',
        prayerDetails: 'تفاصيل أوقات الصلاة',
        clickForDetails: 'انقر لعرض التفاصيل والعد التنازلي',
        selectCountry: 'اختر الدولة',
        selectCity: 'اختر المدينة',
        updateTimes: 'تحديث الأوقات',
        changeLocation: 'تغيير الموقع',
        fullDate: 'التاريخ الكامل',
        hijriDate: 'التاريخ الهجري',
        prayerTimesUpdated: 'تم تحديث أوقات الصلاة بنجاح',
        prayerUpdateFailed: 'فشل في تحديث أوقات الصلاة',
        notifications: {
          fullscreenOn: 'تم تفعيل وضع ملء الشاشة',
          fullscreenOff: 'تم الخروج من وضع ملء الشاشة',
          fullscreenError: 'فشل تفعيل وضع ملء الشاشة',
          dataExported: 'تم تصدير البيانات بنجاح',
          clocksRefreshed: 'تم تحديث الساعات',
          langChanged: 'تم تغيير اللغة',
          weatherError: 'فشل تحميل بيانات الطقس: تحقق من مفتاح API أو الاتصال بالإنترنت',
          invalidApiKey: 'مفتاح API غير صالح، يرجى التسجيل في OpenWeatherMap',
          noResults: 'لم يتم العثور على نتائج',
          networkError: 'لا يوجد اتصال بالإنترنت'
        }
      },
      en: {
        title: ' Enhanced World Clock',
        subtitle: 'Explore world times with geographic and cultural information',
        localClock: ' Local Time',
        aboutBtn: '<i class="fas fa-info-circle"></i> About the Project',
        fullscreenBtn: '<i class="fas fa-expand"></i> Fullscreen',
        exportBtn: '<i class="fas fa-download"></i> Export Data',
        refreshBtn: '<i class="fas fa-sync-alt"></i> Refresh',
        langBtn: '<i class="fas fa-language"></i> Change Language',
        searchPlaceholder: ' Search for a country...',
        noResults: 'No countries found matching the search',
        allContinents: 'All',
        all: 'All',
        asia: 'Asia',
        africa: 'Africa',
        europe: 'Europe',
        america: 'Americas',
        americas: 'Americas',
        oceania: 'Oceania',
        countries: 'countries',
        showingCountries: 'Showing countries in',
        totalCountries: 'Total Countries',
        dayCountries: 'Countries in Daytime',
        nightCountries: 'Countries at Night',
        timezones: 'Time Zones',
        loading: '⏳ Updating data...',
        aboutTitle: ' About the Project',
        copyright: 'Copyright © Abdessamad Bourkibate - 2025',
        capital: 'Capital',
        time: 'Time',
        continent: 'Continent',
        country: 'Country',
        weather: 'Weather',
        description: 'Description',
        leader: 'Leader',
        population: 'Population',
        timezone: 'Time Zone',
        coordinates: 'Coordinates',
        area: 'Area',
        currency: 'Currency',
        language: 'Language',
        weatherTemp: 'Temperature',
        weatherCondition: 'Condition',
        weatherHumidity: 'Humidity',
        weatherWind: 'Wind',
        prayerTimes: 'Prayer Times',
        fajr: 'Fajr',
        dhuhr: 'Dhuhr',
        asr: 'Asr',
        maghrib: 'Maghrib',
        isha: 'Isha',
        nextPrayer: 'Next Prayer',
        timeRemaining: 'Time Remaining',
        prayerDetails: 'Prayer Times Details',
        clickForDetails: 'Click for details and countdown',
        selectCountry: 'Select Country',
        selectCity: 'Select City',
        updateTimes: 'Update Times',
        changeLocation: 'Change Location',
        fullDate: 'Full Date',
        hijriDate: 'Hijri Date',
        prayerTimesUpdated: 'Prayer times updated successfully',
        prayerUpdateFailed: 'Failed to update prayer times',
        notifications: {
          fullscreenOn: 'Fullscreen mode activated',
          fullscreenOff: 'Exited fullscreen mode',
          fullscreenError: 'Failed to activate fullscreen mode',
          dataExported: 'Data exported successfully',
          clocksRefreshed: 'Clocks updated',
          langChanged: 'Language changed',
          weatherError: 'Failed to load weather data: Check API key or internet connection',
          invalidApiKey: 'Invalid API key, please sign up at OpenWeatherMap',
          noResults: 'No results found',
          networkError: 'No internet connection'
        }
      }
    };

    // Countries array with weather coordinates
    const countries = [
      // Asian Countries
      {
        name: 'المملكة العربية السعودية',
        nameEn: 'Saudi Arabia',
        capital: 'الرياض',
        capitalEn: 'Riyadh',
        zone: 'Asia/Riyadh',
        coordinates: '24.7136,46.6753',
        color: '#00FF7F',
        continent: 'asia',
        leader: 'الملك سلمان بن عبد العزيز آل سعود',
        leaderEn: 'King Salman bin Abdulaziz Al Saud',
        population: '35 مليون نسمة',
        populationEn: '35 million',
        area: '2.15 مليون كم²',
        areaEn: '2.15 million km²',
        currency: 'الريال السعودي',
        currencyEn: 'Saudi Riyal',
        language: 'العربية',
        languageEn: 'Arabic',
        description: 'المملكة العربية السعودية، مهد الإسلام وموطن الحرمين الشريفين',
        descriptionEn: 'Saudi Arabia, birthplace of Islam and home to the Two Holy Mosques',
        flagCode: 'sa'
      },
      {
        name: 'دولة الإمارات العربية المتحدة',
        nameEn: 'United Arab Emirates',
        capital: 'أبو ظبي',
        capitalEn: 'Abu Dhabi',
        zone: 'Asia/Dubai',
        coordinates: '25.2048,55.2708',
        color: '#FF6B35',
        continent: 'asia',
        leader: 'الشيخ محمد بن زايد آل نهيان',
        leaderEn: 'Sheikh Mohamed bin Zayed Al Nahyan',
        population: '10 مليون نسمة',
        populationEn: '10 million',
        area: '83,600 كم²',
        areaEn: '83,600 km²',
        currency: 'الدرهم الإماراتي',
        currencyEn: 'UAE Dirham',
        language: 'العربية',
        languageEn: 'Arabic',
        description: 'دولة الإمارات العربية المتحدة، عاصمة التجارة والابتكار في الشرق الأوسط',
        descriptionEn: 'United Arab Emirates, capital of trade and innovation in the Middle East',
        flagCode: 'ae'
      },
      {
        name: 'دولة قطر',
        nameEn: 'Qatar',
        capital: 'الدوحة',
        capitalEn: 'Doha',
        zone: 'Asia/Qatar',
        coordinates: '25.3548,51.1839',
        color: '#8B0000',
        continent: 'asia',
        leader: 'الشيخ تميم بن حمد آل ثاني',
        leaderEn: 'Sheikh Tamim bin Hamad Al Thani',
        population: '2.9 مليون نسمة',
        populationEn: '2.9 million',
        area: '11,586 كم²',
        areaEn: '11,586 km²',
        currency: 'الريال القطري',
        currencyEn: 'Qatari Riyal',
        language: 'العربية',
        languageEn: 'Arabic',
        description: 'دولة قطر، لؤلؤة الخليج العربي ومضيفة كأس العالم 2022',
        descriptionEn: 'Qatar, pearl of the Arabian Gulf and host of FIFA World Cup 2022',
        flagCode: 'qa'
      },
      {
        name: 'دولة الكويت',
        nameEn: 'Kuwait',
        capital: 'مدينة الكويت',
        capitalEn: 'Kuwait City',
        zone: 'Asia/Kuwait',
        coordinates: '29.3117,47.4818',
        color: '#008000',
        continent: 'asia',
        leader: 'الشيخ مشعل الأحمد الجابر الصباح',
        leaderEn: 'Sheikh Mishal Al-Ahmad Al-Jaber Al-Sabah',
        population: '4.3 مليون نسمة',
        populationEn: '4.3 million',
        area: '17,818 كم²',
        areaEn: '17,818 km²',
        currency: 'الدينار الكويتي',
        currencyEn: 'Kuwaiti Dinar',
        language: 'العربية',
        languageEn: 'Arabic',
        description: 'دولة الكويت، إحدى أغنى دول العالم بالنفط',
        descriptionEn: 'Kuwait, one of the world\'s richest oil nations',
        flagCode: 'kw'
      },
      {
        name: 'مملكة البحرين',
        nameEn: 'Bahrain',
        capital: 'المنامة',
        capitalEn: 'Manama',
        zone: 'Asia/Bahrain',
        coordinates: '26.0667,50.5577',
        color: '#DC143C',
        continent: 'asia',
        leader: 'الملك حمد بن عيسى آل خليفة',
        leaderEn: 'King Hamad bin Isa Al Khalifa',
        population: '1.7 مليون نسمة',
        populationEn: '1.7 million',
        area: '765 كم²',
        areaEn: '765 km²',
        currency: 'الدينار البحريني',
        currencyEn: 'Bahraini Dinar',
        language: 'العربية',
        languageEn: 'Arabic',
        description: 'مملكة البحرين، لؤلؤة الخليج العربي',
        descriptionEn: 'Bahrain, pearl of the Arabian Gulf',
        flagCode: 'bh'
      },
      {
        name: 'سلطنة عُمان',
        nameEn: 'Oman',
        capital: 'مسقط',
        capitalEn: 'Muscat',
        zone: 'Asia/Muscat',
        coordinates: '23.5859,58.4059',
        color: '#FF69B4',
        continent: 'asia',
        leader: 'السلطان هيثم بن طارق آل سعيد',
        leaderEn: 'Sultan Haitham bin Tariq Al Said',
        population: '5.1 مليون نسمة',
        populationEn: '5.1 million',
        area: '309,500 كم²',
        areaEn: '309,500 km²',
        currency: 'الريال العُماني',
        currencyEn: 'Omani Rial',
        language: 'العربية',
        languageEn: 'Arabic',
        description: 'سلطنة عُمان، أرض الحضارة والتاريخ العريق',
        descriptionEn: 'Oman, land of civilization and ancient history',
        flagCode: 'om'
      },
      {
        name: 'المملكة الأردنية الهاشمية',
        nameEn: 'Jordan',
        capital: 'عمّان',
        capitalEn: 'Amman',
        zone: 'Asia/Amman',
        coordinates: '31.9539,35.9106',
        color: '#000000',
        continent: 'asia',
        leader: 'الملك عبد الله الثاني بن الحسين',
        leaderEn: 'King Abdullah II bin Al-Hussein',
        population: '10.2 مليون نسمة',
        populationEn: '10.2 million',
        area: '89,342 كم²',
        areaEn: '89,342 km²',
        currency: 'الدينار الأردني',
        currencyEn: 'Jordanian Dinar',
        language: 'العربية',
        languageEn: 'Arabic',
        description: 'المملكة الأردنية الهاشمية، حارسة المقدسات الإسلامية والمسيحية',
        descriptionEn: 'Jordan, guardian of Islamic and Christian holy sites',
        flagCode: 'jo'
      },
      {
        name: 'الجمهورية اللبنانية',
        nameEn: 'Lebanon',
        capital: 'بيروت',
        capitalEn: 'Beirut',
        zone: 'Asia/Beirut',
        coordinates: '33.8938,35.5018',
        color: '#228B22',
        continent: 'asia',
        leader: 'ميشال عون',
        leaderEn: 'Michel Aoun',
        population: '6.8 مليون نسمة',
        populationEn: '6.8 million',
        area: '10,452 كم²',
        areaEn: '10,452 km²',
        currency: 'الليرة اللبنانية',
        currencyEn: 'Lebanese Pound',
        language: 'العربية',
        languageEn: 'Arabic',
        description: 'الجمهورية اللبنانية، سويسرا الشرق الأوسط',
        descriptionEn: 'Lebanon, Switzerland of the Middle East',
        flagCode: 'lb'
      },
      {
        name: 'الجمهورية العربية السورية',
        nameEn: 'Syria',
        capital: 'دمشق',
        capitalEn: 'Damascus',
        zone: 'Asia/Damascus',
        coordinates: '33.5138,36.2765',
        color: '#FF0000',
        continent: 'asia',
        leader: 'بشار الأسد',
        leaderEn: 'Bashar al-Assad',
        population: '18 مليون نسمة',
        populationEn: '18 million',
        area: '185,180 كم²',
        areaEn: '185,180 km²',
        currency: 'الليرة السورية',
        currencyEn: 'Syrian Pound',
        language: 'العربية',
        languageEn: 'Arabic',
        description: 'الجمهورية العربية السورية، مهد الحضارات',
        descriptionEn: 'Syria, cradle of civilizations',
        flagCode: 'sy'
      },
      {
        name: 'جمهورية العراق',
        nameEn: 'Iraq',
        capital: 'بغداد',
        capitalEn: 'Baghdad',
        zone: 'Asia/Baghdad',
        coordinates: '33.3152,44.3661',
        color: '#8B0000',
        continent: 'asia',
        leader: 'عبد اللطيف رشيد',
        leaderEn: 'Abdul Latif Rashid',
        population: '40 مليون نسمة',
        populationEn: '40 million',
        area: '438,317 كم²',
        areaEn: '438,317 km²',
        currency: 'الدينار العراقي',
        currencyEn: 'Iraqi Dinar',
        language: 'العربية',
        languageEn: 'Arabic',
        description: 'جمهورية العراق، أرض الرافدين ومهد الحضارة',
        descriptionEn: 'Iraq, land of Mesopotamia and cradle of civilization',
        flagCode: 'iq'
      },
      {
        name: 'الجمهورية الإسلامية الإيرانية',
        nameEn: 'Iran',
        capital: 'طهران',
        capitalEn: 'Tehran',
        zone: 'Asia/Tehran',
        coordinates: '35.6892,51.3890',
        color: '#239B56',
        continent: 'asia',
        leader: 'علي خامنئي',
        leaderEn: 'Ali Khamenei',
        population: '84 مليون نسمة',
        populationEn: '84 million',
        area: '1,648,195 كم²',
        areaEn: '1,648,195 km²',
        currency: 'الريال الإيراني',
        currencyEn: 'Iranian Rial',
        language: 'الفارسية',
        languageEn: 'Persian',
        description: 'الجمهورية الإسلامية الإيرانية، أرض الحضارة الفارسية العريقة',
        descriptionEn: 'Iran, land of ancient Persian civilization',
        flagCode: 'ir'
      },
      {
        name: 'جمهورية أفغانستان الإسلامية',
        nameEn: 'Afghanistan',
        capital: 'كابول',
        capitalEn: 'Kabul',
        zone: 'Asia/Kabul',
        coordinates: '34.5553,69.2075',
        color: '#DC143C',
        continent: 'asia',
        leader: 'هبة الله أخوند زاده',
        leaderEn: 'Hibatullah Akhundzada',
        population: '39 مليون نسمة',
        populationEn: '39 million',
        area: '652,230 كم²',
        areaEn: '652,230 km²',
        currency: 'الأفغاني',
        currencyEn: 'Afghan Afghani',
        language: 'الداري والبشتو',
        languageEn: 'Dari and Pashto',
        description: 'جمهورية أفغانستان الإسلامية، مفترق طرق آسيا',
        descriptionEn: 'Afghanistan, crossroads of Asia',
        flagCode: 'af'
      },
      {
        name: 'جمهورية باكستان الإسلامية',
        nameEn: 'Pakistan',
        capital: 'إسلام أباد',
        capitalEn: 'Islamabad',
        zone: 'Asia/Karachi',
        coordinates: '30.3753,69.3451',
        color: '#228B22',
        continent: 'asia',
        leader: 'عارف علوي',
        leaderEn: 'Arif Alvi',
        population: '225 مليون نسمة',
        populationEn: '225 million',
        area: '881,913 كم²',
        areaEn: '881,913 km²',
        currency: 'الروبية الباكستانية',
        currencyEn: 'Pakistani Rupee',
        language: 'الأردية والإنجليزية',
        languageEn: 'Urdu and English',
        description: 'جمهورية باكستان الإسلامية، أرض الطهر والإيمان',
        descriptionEn: 'Pakistan, land of the pure and faithful',
        flagCode: 'pk'
      },
      {
        name: 'جمهورية الهند',
        nameEn: 'India',
        capital: 'نيودلهي',
        capitalEn: 'New Delhi',
        zone: 'Asia/Kolkata',
        coordinates: '20.5937,78.9629',
        color: '#FF6600',
        continent: 'asia',
        leader: 'نارندرا مودي',
        leaderEn: 'Narendra Modi',
        population: '1.4 مليار نسمة',
        populationEn: '1.4 billion',
        area: '3,287,263 كم²',
        areaEn: '3,287,263 km²',
        currency: 'الروبية الهندية',
        currencyEn: 'Indian Rupee',
        language: 'الهندية والإنجليزية',
        languageEn: 'Hindi and English',
        description: 'جمهورية الهند، أكبر ديمقراطية في العالم',
        descriptionEn: 'India, world\'s largest democracy',
        flagCode: 'in'
      },
      {
        name: 'جمهورية بنغلاديش الشعبية',
        nameEn: 'Bangladesh',
        capital: 'دكا',
        capitalEn: 'Dhaka',
        zone: 'Asia/Dhaka',
        coordinates: '23.6850,90.3563',
        color: '#006A4E',
        continent: 'asia',
        leader: 'محمد شهاب الدين',
        leaderEn: 'Mohammed Shahabuddin',
        population: '165 مليون نسمة',
        populationEn: '165 million',
        area: '147,570 كم²',
        areaEn: '147,570 km²',
        currency: 'التاكا البنغلاديشية',
        currencyEn: 'Bangladeshi Taka',
        language: 'البنغالية',
        languageEn: 'Bengali',
        description: 'جمهورية بنغلاديش الشعبية، أرض الأنهار والدلتا',
        descriptionEn: 'Bangladesh, land of rivers and deltas',
        flagCode: 'bd'
      },
      {
        name: 'جمهورية سريلانكا الديمقراطية الاشتراكية',
        nameEn: 'Sri Lanka',
        capital: 'كولومبو',
        capitalEn: 'Colombo',
        zone: 'Asia/Colombo',
        coordinates: '7.8731,80.7718',
        color: '#FFD700',
        continent: 'asia',
        leader: 'رانيل ويكرمسينغه',
        leaderEn: 'Ranil Wickremesinghe',
        population: '22 مليون نسمة',
        populationEn: '22 million',
        area: '65,610 كم²',
        areaEn: '65,610 km²',
        currency: 'الروبية السريلانكية',
        currencyEn: 'Sri Lankan Rupee',
        language: 'السنهالية والتاميلية',
        languageEn: 'Sinhala and Tamil',
        description: 'سريلانكا، لؤلؤة المحيط الهندي',
        descriptionEn: 'Sri Lanka, pearl of the Indian Ocean',
        flagCode: 'lk'
      },
      {
        name: 'جمهورية جزر المالديف',
        nameEn: 'Maldives',
        capital: 'ماليه',
        capitalEn: 'Male',
        zone: 'Indian/Maldives',
        coordinates: '3.2028,73.2207',
        color: '#0099CC',
        continent: 'asia',
        leader: 'محمد مويزو',
        leaderEn: 'Mohamed Muizzu',
        population: '540 ألف نسمة',
        populationEn: '540 thousand',
        area: '298 كم²',
        areaEn: '298 km²',
        currency: 'الروفيا المالديفية',
        currencyEn: 'Maldivian Rufiyaa',
        language: 'الديفيهي',
        languageEn: 'Dhivehi',
        description: 'جزر المالديف، جنة استوائية في المحيط الهندي',
        descriptionEn: 'Maldives, tropical paradise in the Indian Ocean',
        flagCode: 'mv'
      },
      {
        name: 'جمهورية الصين الشعبية',
        nameEn: 'China',
        capital: 'بكين',
        capitalEn: 'Beijing',
        zone: 'Asia/Shanghai',
        coordinates: '35.8617,104.1954',
        color: '#FF0000',
        continent: 'asia',
        leader: 'شي جين بينغ',
        leaderEn: 'Xi Jinping',
        population: '1.4 مليار نسمة',
        populationEn: '1.4 billion',
        area: '9,596,960 كم²',
        areaEn: '9,596,960 km²',
        currency: 'اليوان الصيني',
        currencyEn: 'Chinese Yuan',
        language: 'الصينية المنديرية',
        languageEn: 'Mandarin Chinese',
        description: 'جمهورية الصين الشعبية، أكبر دولة في العالم من حيث عدد السكان',
        descriptionEn: 'China, world\'s most populous country',
        flagCode: 'cn'
      },
      {
        name: 'اليابان',
        nameEn: 'Japan',
        capital: 'طوكيو',
        capitalEn: 'Tokyo',
        zone: 'Asia/Tokyo',
        coordinates: '36.2048,138.2529',
        color: '#FF0000',
        continent: 'asia',
        leader: 'فوميو كيشيدا',
        leaderEn: 'Fumio Kishida',
        population: '125 مليون نسمة',
        populationEn: '125 million',
        area: '377,975 كم²',
        areaEn: '377,975 km²',
        currency: 'الين الياباني',
        currencyEn: 'Japanese Yen',
        language: 'اليابانية',
        languageEn: 'Japanese',
        description: 'اليابان، أرض الشمس المشرقة والتكنولوجيا المتقدمة',
        descriptionEn: 'Japan, land of the rising sun and advanced technology',
        flagCode: 'jp'
      },
      {
        name: 'جمهورية كوريا',
        nameEn: 'South Korea',
        capital: 'سول',
        capitalEn: 'Seoul',
        zone: 'Asia/Seoul',
        coordinates: '35.9078,127.7669',
        color: '#0047AB',
        continent: 'asia',
        leader: 'يون سوك يول',
        leaderEn: 'Yoon Suk-yeol',
        population: '52 مليون نسمة',
        populationEn: '52 million',
        area: '100,210 كم²',
        areaEn: '100,210 km²',
        currency: 'الوون الكوري الجنوبي',
        currencyEn: 'South Korean Won',
        language: 'الكورية',
        languageEn: 'Korean',
        description: 'كوريا الجنوبية، قوة تكنولوجية وثقافية عالمية',
        descriptionEn: 'South Korea, global technological and cultural power',
        flagCode: 'kr'
      },
      {
        name: 'جمهورية كوريا الشعبية الديمقراطية',
        nameEn: 'North Korea',
        capital: 'بيونغ يانغ',
        capitalEn: 'Pyongyang',
        zone: 'Asia/Pyongyang',
        coordinates: '40.3399,127.5101',
        color: '#FF0000',
        continent: 'asia',
        leader: 'كيم جونغ أون',
        leaderEn: 'Kim Jong-un',
        population: '26 مليون نسمة',
        populationEn: '26 million',
        area: '120,540 كم²',
        areaEn: '120,540 km²',
        currency: 'الوون الكوري الشمالي',
        currencyEn: 'North Korean Won',
        language: 'الكورية',
        languageEn: 'Korean',
        description: 'كوريا الشمالية، الجمهورية الشعبية الديمقراطية',
        descriptionEn: 'North Korea, Democratic People\'s Republic',
        flagCode: 'kp'
      },
      {
        name: 'منغوليا',
        nameEn: 'Mongolia',
        capital: 'أولان باتور',
        capitalEn: 'Ulaanbaatar',
        zone: 'Asia/Ulaanbaatar',
        coordinates: '46.8625,103.8467',
        color: '#0033A0',
        continent: 'asia',
        leader: 'أوخناغين خورلسوخ',
        leaderEn: 'Ukhnaagiin Khürelsükh',
        population: '3.3 مليون نسمة',
        populationEn: '3.3 million',
        area: '1,564,110 كم²',
        areaEn: '1,564,110 km²',
        currency: 'التوغريك المنغولي',
        currencyEn: 'Mongolian Tugrik',
        language: 'المنغولية',
        languageEn: 'Mongolian',
        description: 'منغوليا، أرض السهوب الواسعة والرعاة الرحل',
        descriptionEn: 'Mongolia, land of vast steppes and nomadic herders',
        flagCode: 'mn'
      },
      {
        name: 'مملكة تايلاند',
        nameEn: 'Thailand',
        capital: 'بانكوك',
        capitalEn: 'Bangkok',
        zone: 'Asia/Bangkok',
        coordinates: '15.8700,100.9925',
        color: '#FF0000',
        continent: 'asia',
        leader: 'سريثا ثافيسين',
        leaderEn: 'Srettha Thavisin',
        population: '70 مليون نسمة',
        populationEn: '70 million',
        area: '513,120 كم²',
        areaEn: '513,120 km²',
        currency: 'الباهت التايلاندي',
        currencyEn: 'Thai Baht',
        language: 'التايلاندية',
        languageEn: 'Thai',
        description: 'تايلاند، أرض الابتسامات والمعابد الذهبية',
        descriptionEn: 'Thailand, land of smiles and golden temples',
        flagCode: 'th'
      },
      {
        name: 'جمهورية فيتنام الاشتراكية',
        nameEn: 'Vietnam',
        capital: 'هانوي',
        capitalEn: 'Hanoi',
        zone: 'Asia/Ho_Chi_Minh',
        coordinates: '14.0583,108.2772',
        color: '#FF0000',
        continent: 'asia',
        leader: 'فو مينه تشينه',
        leaderEn: 'Pham Minh Chinh',
        population: '98 مليون نسمة',
        populationEn: '98 million',
        area: '331,212 كم²',
        areaEn: '331,212 km²',
        currency: 'الدونغ الفيتنامي',
        currencyEn: 'Vietnamese Dong',
        language: 'الفيتنامية',
        languageEn: 'Vietnamese',
        description: 'فيتنام، أرض التنين الصاعد والتاريخ العريق',
        descriptionEn: 'Vietnam, land of the rising dragon and ancient history',
        flagCode: 'vn'
      },
      {
        name: 'جمهورية الفلبين',
        nameEn: 'Philippines',
        capital: 'مانيلا',
        capitalEn: 'Manila',
        zone: 'Asia/Manila',
        coordinates: '12.8797,121.7740',
        color: '#0038A8',
        continent: 'asia',
        leader: 'فرديناند ماركوس جونيور',
        leaderEn: 'Ferdinand Marcos Jr.',
        population: '110 مليون نسمة',
        populationEn: '110 million',
        area: '300,000 كم²',
        areaEn: '300,000 km²',
        currency: 'البيزو الفلبيني',
        currencyEn: 'Philippine Peso',
        language: 'الفلبينية والإنجليزية',
        languageEn: 'Filipino and English',
        description: 'الفلبين، لؤلؤة المحيط الهادئ وأرض الجزر الألف',
        descriptionEn: 'Philippines, pearl of the Pacific and land of a thousand islands',
        flagCode: 'ph'
      },
      {
        name: 'جمهورية إندونيسيا',
        nameEn: 'Indonesia',
        capital: 'جاكرتا',
        capitalEn: 'Jakarta',
        zone: 'Asia/Jakarta',
        coordinates: '-0.7893,113.9213',
        color: '#FF0000',
        continent: 'asia',
        leader: 'جوكو ويدودو',
        leaderEn: 'Joko Widodo',
        population: '274 مليون نسمة',
        populationEn: '274 million',
        area: '1,904,569 كم²',
        areaEn: '1,904,569 km²',
        currency: 'الروبية الإندونيسية',
        currencyEn: 'Indonesian Rupiah',
        language: 'الإندونيسية',
        languageEn: 'Indonesian',
        description: 'إندونيسيا، أكبر دولة أرخبيلية في العالم',
        descriptionEn: 'Indonesia, world\'s largest archipelagic country',
        flagCode: 'id'
      },
      {
        name: 'ماليزيا',
        nameEn: 'Malaysia',
        capital: 'كوالالمبور',
        capitalEn: 'Kuala Lumpur',
        zone: 'Asia/Kuala_Lumpur',
        coordinates: '4.2105,101.9758',
        color: '#FF0000',
        continent: 'asia',
        leader: 'أنور إبراهيم',
        leaderEn: 'Anwar Ibrahim',
        population: '33 مليون نسمة',
        populationEn: '33 million',
        area: '329,847 كم²',
        areaEn: '329,847 km²',
        currency: 'الرينغيت الماليزي',
        currencyEn: 'Malaysian Ringgit',
        language: 'الماليزية',
        languageEn: 'Malay',
        description: 'ماليزيا، أرض التنوع الثقافي والطبيعة الخلابة',
        descriptionEn: 'Malaysia, land of cultural diversity and stunning nature',
        flagCode: 'my'
      },
      {
        name: 'جمهورية سنغافورة',
        nameEn: 'Singapore',
        capital: 'سنغافورة',
        capitalEn: 'Singapore',
        zone: 'Asia/Singapore',
        coordinates: '1.3521,103.8198',
        color: '#FF0000',
        continent: 'asia',
        leader: 'لي هسين لونغ',
        leaderEn: 'Lee Hsien Loong',
        population: '5.9 مليون نسمة',
        populationEn: '5.9 million',
        area: '728 كم²',
        areaEn: '728 km²',
        currency: 'الدولار السنغافوري',
        currencyEn: 'Singapore Dollar',
        language: 'الإنجليزية والماليزية والصينية والتاميلية',
        languageEn: 'English, Malay, Chinese, and Tamil',
        description: 'سنغافورة، أسد آسيا والمركز المالي العالمي',
        descriptionEn: 'Singapore, lion of Asia and global financial center',
        flagCode: 'sg'
      },
      {
        name: 'سلطنة بروناي دار السلام',
        nameEn: 'Brunei',
        capital: 'بندر سري بكاوان',
        capitalEn: 'Bandar Seri Begawan',
        zone: 'Asia/Brunei',
        coordinates: '4.5353,114.7277',
        color: '#FFD700',
        continent: 'asia',
        leader: 'السلطان حسن البلقية',
        leaderEn: 'Sultan Hassanal Bolkiah',
        population: '440 ألف نسمة',
        populationEn: '440 thousand',
        area: '5,765 كم²',
        areaEn: '5,765 km²',
        currency: 'الدولار البروناي',
        currencyEn: 'Brunei Dollar',
        language: 'الماليزية',
        languageEn: 'Malay',
        description: 'بروناي، سلطنة الثراء والسلام',
        descriptionEn: 'Brunei, sultanate of wealth and peace',
        flagCode: 'bn'
      },
      {
        name: 'جمهورية لاو الديمقراطية الشعبية',
        nameEn: 'Laos',
        capital: 'فيينتيان',
        capitalEn: 'Vientiane',
        zone: 'Asia/Vientiane',
        coordinates: '19.8563,102.4955',
        color: '#CE1126',
        continent: 'asia',
        leader: 'ثونغلون سيسوليث',
        leaderEn: 'Thongloun Sisoulith',
        population: '7.3 مليون نسمة',
        populationEn: '7.3 million',
        area: '236,800 كم²',
        areaEn: '236,800 km²',
        currency: 'الكيب اللاوسي',
        currencyEn: 'Lao Kip',
        language: 'اللاوسية',
        languageEn: 'Lao',
        description: 'لاوس، أرض مليون فيل والطبيعة البكر',
        descriptionEn: 'Laos, land of a million elephants and pristine nature',
        flagCode: 'la'
      },
      {
        name: 'مملكة كمبوديا',
        nameEn: 'Cambodia',
        capital: 'بنوم بنه',
        capitalEn: 'Phnom Penh',
        zone: 'Asia/Phnom_Penh',
        coordinates: '12.5657,104.9910',
        color: '#032EA1',
        continent: 'asia',
        leader: 'هون مانيت',
        leaderEn: 'Hun Manet',
        population: '17 مليون نسمة',
        populationEn: '17 million',
        area: '181,035 كم²',
        areaEn: '181,035 km²',
        currency: 'الريال الكمبودي',
        currencyEn: 'Cambodian Riel',
        language: 'الخمير',
        languageEn: 'Khmer',
        description: 'كمبوديا، أرض معابد أنغكور والحضارة الخمير',
        descriptionEn: 'Cambodia, land of Angkor temples and Khmer civilization',
        flagCode: 'kh'
      },
      {
        name: 'جمهورية ميانمار الاتحادية',
        nameEn: 'Myanmar',
        capital: 'نايبيداو',
        capitalEn: 'Naypyidaw',
        zone: 'Asia/Yangon',
        coordinates: '21.9162,95.9560',
        color: '#FFCD00',
        continent: 'asia',
        leader: 'مين أونغ هلاينغ',
        leaderEn: 'Min Aung Hlaing',
        population: '54 مليون نسمة',
        populationEn: '54 million',
        area: '676,578 كم²',
        areaEn: '676,578 km²',
        currency: 'الكيات الميانماري',
        currencyEn: 'Myanmar Kyat',
        language: 'البورمية',
        languageEn: 'Burmese',
        description: 'ميانمار، أرض الباغودات الذهبية والتقاليد العريقة',
        descriptionEn: 'Myanmar, land of golden pagodas and ancient traditions',
        flagCode: 'mm'
      },
      {
        name: 'جمهورية أوزبكستان',
        nameEn: 'Uzbekistan',
        capital: 'طشقند',
        capitalEn: 'Tashkent',
        zone: 'Asia/Tashkent',
        coordinates: '41.3775,64.5853',
        color: '#0099B5',
        continent: 'asia',
        leader: 'شوكت ميرزياييف',
        leaderEn: 'Shavkat Mirziyoyev',
        population: '35 مليون نسمة',
        populationEn: '35 million',
        area: '448,978 كم²',
        areaEn: '448,978 km²',
        currency: 'السوم الأوزبكي',
        currencyEn: 'Uzbek Som',
        language: 'الأوزبكية',
        languageEn: 'Uzbek',
        description: 'أوزبكستان، جوهرة طريق الحرير وأرض الحضارات القديمة',
        descriptionEn: 'Uzbekistan, jewel of the Silk Road and land of ancient civilizations',
        flagCode: 'uz'
      },
      {
        name: 'جمهورية كازاخستان',
        nameEn: 'Kazakhstan',
        capital: 'نور سلطان',
        capitalEn: 'Nur-Sultan',
        zone: 'Asia/Almaty',
        coordinates: '48.0196,66.9237',
        color: '#00AFCA',
        continent: 'asia',
        leader: 'قاسم جومارت توكاييف',
        leaderEn: 'Kassym-Jomart Tokayev',
        population: '19 مليون نسمة',
        populationEn: '19 million',
        area: '2,724,900 كم²',
        areaEn: '2,724,900 km²',
        currency: 'التينغه الكازاخستاني',
        currencyEn: 'Kazakhstani Tenge',
        language: 'الكازاخية والروسية',
        languageEn: 'Kazakh and Russian',
        description: 'كازاخستان، أكبر دولة غير ساحلية في العالم',
        descriptionEn: 'Kazakhstan, world\'s largest landlocked country',
        flagCode: 'kz'
      },
      {
        name: 'قيرغيزستان',
        nameEn: 'Kyrgyzstan',
        capital: 'بيشكك',
        capitalEn: 'Bishkek',
        zone: 'Asia/Bishkek',
        coordinates: '41.2044,74.7661',
        color: '#FF0000',
        continent: 'asia',
        leader: 'صدر جاباروف',
        leaderEn: 'Sadyr Japarov',
        population: '6.6 مليون نسمة',
        populationEn: '6.6 million',
        area: '199,951 كم²',
        areaEn: '199,951 km²',
        currency: 'السوم القيرغيزي',
        currencyEn: 'Kyrgyzstani Som',
        language: 'القيرغيزية والروسية',
        languageEn: 'Kyrgyz and Russian',
        description: 'قيرغيزستان، أرض الجبال الشاهقة والبحيرات الزرقاء',
        descriptionEn: 'Kyrgyzstan, land of high mountains and blue lakes',
        flagCode: 'kg'
      },
      {
        name: 'جمهورية طاجيكستان',
        nameEn: 'Tajikistan',
        capital: 'دوشانبه',
        capitalEn: 'Dushanbe',
        zone: 'Asia/Dushanbe',
        coordinates: '38.8610,71.2761',
        color: '#006600',
        continent: 'asia',
        leader: 'إمام علي رحمان',
        leaderEn: 'Emomali Rahmon',
        population: '9.7 مليون نسمة',
        populationEn: '9.7 million',
        area: '143,100 كم²',
        areaEn: '143,100 km²',
        currency: 'السوموني الطاجيكي',
        currencyEn: 'Tajikistani Somoni',
        language: 'الطاجيكية',
        languageEn: 'Tajik',
        description: 'طاجيكستان، سقف العالم وأرض الجبال الشامخة',
        descriptionEn: 'Tajikistan, roof of the world and land of towering mountains',
        flagCode: 'tj'
      },
      {
        name: 'تركمانستان',
        nameEn: 'Turkmenistan',
        capital: 'عشق آباد',
        capitalEn: 'Ashgabat',
        zone: 'Asia/Ashgabat',
        coordinates: '38.9697,59.5563',
        color: '#00B04F',
        continent: 'asia',
        leader: 'سردار بردي محمدوف',
        leaderEn: 'Serdar Berdimuhamedow',
        population: '6 مليون نسمة',
        populationEn: '6 million',
        area: '488,100 كم²',
        areaEn: '488,100 km²',
        currency: 'المانات التركماني',
        currencyEn: 'Turkmenistan Manat',
        language: 'التركمانية',
        languageEn: 'Turkmen',
        description: 'تركمانستان، أرض الغاز الطبيعي والصحاري الذهبية',
        descriptionEn: 'Turkmenistan, land of natural gas and golden deserts',
        flagCode: 'tm'
      },
      {
        name: 'جمهورية أذربيجان',
        nameEn: 'Azerbaijan',
        capital: 'باكو',
        capitalEn: 'Baku',
        zone: 'Asia/Baku',
        coordinates: '40.1431,47.5769',
        color: '#0081C9',
        continent: 'asia',
        leader: 'إلهام علييف',
        leaderEn: 'Ilham Aliyev',
        population: '10.1 مليون نسمة',
        populationEn: '10.1 million',
        area: '86,600 كم²',
        areaEn: '86,600 km²',
        currency: 'المانات الأذربيجاني',
        currencyEn: 'Azerbaijani Manat',
        language: 'الأذربيجانية',
        languageEn: 'Azerbaijani',
        description: 'أذربيجان، أرض النار والنفط',
        descriptionEn: 'Azerbaijan, land of fire and oil',
        flagCode: 'az'
      },
      {
        name: 'جمهورية أرمينيا',
        nameEn: 'Armenia',
        capital: 'يريفان',
        capitalEn: 'Yerevan',
        zone: 'Asia/Yerevan',
        coordinates: '40.0691,45.0382',
        color: '#FF0000',
        continent: 'asia',
        leader: 'نيكول باشينيان',
        leaderEn: 'Nikol Pashinyan',
        population: '3 مليون نسمة',
        populationEn: '3 million',
        area: '29,743 كم²',
        areaEn: '29,743 km²',
        currency: 'الدرام الأرميني',
        currencyEn: 'Armenian Dram',
        language: 'الأرمينية',
        languageEn: 'Armenian',
        description: 'أرمينيا، أول دولة تعتنق المسيحية رسمياً',
        descriptionEn: 'Armenia, first nation to officially adopt Christianity',
        flagCode: 'am'
      },
      {
        name: 'جمهورية جورجيا',
        nameEn: 'Georgia',
        capital: 'تبليسي',
        capitalEn: 'Tbilisi',
        zone: 'Asia/Tbilisi',
        coordinates: '42.3154,43.3569',
        color: '#FFFFFF',
        continent: 'asia',
        leader: 'سالومي زورابيشفيلي',
        leaderEn: 'Salome Zourabichvili',
        population: '3.7 مليون نسمة',
        populationEn: '3.7 million',
        area: '69,700 كم²',
        areaEn: '69,700 km²',
        currency: 'اللاري الجورجي',
        currencyEn: 'Georgian Lari',
        language: 'الجورجية',
        languageEn: 'Georgian',
        description: 'جورجيا، ملتقى أوروبا وآسيا',
        descriptionEn: 'Georgia, crossroads of Europe and Asia',
        flagCode: 'ge'
      },
      {
        name: 'قبرص',
        nameEn: 'Cyprus',
        capital: 'نيقوسيا',
        capitalEn: 'Nicosia',
        zone: 'Asia/Nicosia',
        coordinates: '35.1264,33.4299',
        color: '#D4AF37',
        continent: 'asia',
        leader: 'نيكوس أناستاسياديس',
        leaderEn: 'Nicos Anastasiades',
        population: '1.2 مليون نسمة',
        populationEn: '1.2 million',
        area: '9,251 كم²',
        areaEn: '9,251 km²',
        currency: 'اليورو',
        currencyEn: 'Euro',
        language: 'اليونانية والتركية',
        languageEn: 'Greek and Turkish',
        description: 'قبرص، جزيرة الحب والجمال في البحر المتوسط',
        descriptionEn: 'Cyprus, island of love and beauty in the Mediterranean',
        flagCode: 'cy'
      },
      {
        name: 'الجمهورية التركية',
        nameEn: 'Turkey',
        capital: 'أنقرة',
        capitalEn: 'Ankara',
        zone: 'Europe/Istanbul',
        coordinates: '38.9637,35.2433',
        color: '#E30A17',
        continent: 'asia',
        leader: 'رجب طيب أردوغان',
        leaderEn: 'Recep Tayyip Erdogan',
        population: '85 مليون نسمة',
        populationEn: '85 million',
        area: '783,562 كم²',
        areaEn: '783,562 km²',
        currency: 'الليرة التركية',
        currencyEn: 'Turkish Lira',
        language: 'التركية',
        languageEn: 'Turkish',
        description: 'تركيا، جسر بين أوروبا وآسيا',
        descriptionEn: 'Turkey, bridge between Europe and Asia',
        flagCode: 'tr'
      },
      {
        name: 'دولة فلسطين',
        nameEn: 'Palestine',
        capital: 'القدس الشرقية',
        capitalEn: 'East Jerusalem',
        zone: 'Asia/Gaza',
        coordinates: '31.9522,35.2332',
        color: '#000000',
        continent: 'asia',
        leader: 'محمود عباس',
        leaderEn: 'Mahmoud Abbas',
        population: '5.2 مليون نسمة',
        populationEn: '5.2 million',
        area: '6,220 كم²',
        areaEn: '6,220 km²',
        currency: 'الشيكل الإسرائيلي والدينار الأردني',
        currencyEn: 'Israeli Shekel and Jordanian Dinar',
        language: 'العربية',
        languageEn: 'Arabic',
        description: 'فلسطين، أرض الأنبياء والمقدسات',
        descriptionEn: 'Palestine, land of prophets and holy sites',
        flagCode: 'ps'
      }
    ];

// Function to get flag code from country name
function getFlagCode(countryName) {
  const flagCodes = {
    'Saudi Arabia': 'sa',
    'United Arab Emirates': 'ae', 
    'Japan': 'jp',
    'China': 'cn',
    'India': 'in',
    'Bangladesh': 'bd',
    'South Korea': 'kr',
    'Thailand': 'th',
    'Vietnam': 'vn',
    'Philippines': 'ph',
    'Qatar': 'qa',
    'Singapore': 'sg',
    'Malaysia': 'my',
    'Iran': 'ir',
    'Jordan': 'jo',
    'Kuwait': 'kw',
    'Morocco': 'ma',
    'Egypt': 'eg',
    'Nigeria': 'ng',
    'South Africa': 'za',
    'Ethiopia': 'et',
    'Kenya': 'ke',
    'Ghana': 'gh',
    'Algeria': 'dz',
    'Uganda': 'ug',
    'Senegal': 'sn',
    'Ivory Coast': 'ci',
    'Cameroon': 'cm',
    'Sudan': 'sd',
    'Tunisia': 'tn',
    'Tanzania': 'tz',
    'Mali': 'ml',
    'Burkina Faso': 'bf',
    'United States': 'us',
    'Brazil': 'br',
    'Canada': 'ca',
    'Mexico': 'mx',
    'Argentina': 'ar',
    'Turkey': 'tr',
    'Russia': 'ru',
    'Germany': 'de',
    'France': 'fr',
    'United Kingdom': 'gb',
    'Italy': 'it',
    'Spain': 'es',
    'Netherlands': 'nl',
    'Austria': 'at',
    'Czech Republic': 'cz',
    'Ireland': 'ie',
    'Finland': 'fi',
    'Bosnia and Herzegovina': 'ba',
    'Bulgaria': 'bg',
    'Croatia': 'hr',
    'Estonia': 'ee',
    'Barbados': 'bb',
    'Bolivia': 'bo',
    'Costa Rica': 'cr',
    'Cuba': 'cu',
    'Australia': 'au',
    'New Zealand': 'nz',
    'Fiji': 'fj',
    'Papua New Guinea': 'pg',
    'Samoa': 'ws',
    'Tonga': 'to',
    'Vanuatu': 'vu',
    'Cook Islands': 'ck'
  };
  return flagCodes[countryName] || null;
}

    // API settings
    const WEATHER_API_KEY = '42d984047a7d1cdbc1f04ff0e2bb10f4';
    const WEATHER_API_URL = 'https://api.openweathermap.org/data/2.5/weather';
    const PRAYER_API_URL = 'https://api.aladhan.com/v1/timings';
    const PRAYER_CITY_API_URL = 'https://api.aladhan.com/v1/timingsByCity';    // Cache for weather and prayer data
    let weatherCache = {};
    let prayerCache = {};

    // Check internet connectivity
    function checkNetwork() {
      return navigator.onLine;
    }

    // Fetch weather data with extended caching
    async function fetchWeather(coordinates) {
      if (!checkNetwork()) {
        showNotification(translations[currentLanguage].notifications.networkError);
        return null;
      }
      const [lat, lon] = coordinates.split(',');
      const cacheKey = `${lat},${lon}`;
      if (weatherCache[cacheKey] && Date.now() - weatherCache[cacheKey].timestamp < 1800000) { // 30 minutes
        return weatherCache[cacheKey].data;
      }

      try {
        const response = await fetch(`${WEATHER_API_URL}?lat=${lat}&lon=${lon}&appid=${WEATHER_API_KEY}&units=metric&lang=${currentLanguage}`);
        if (!response.ok) {
          if (response.status === 401) {
            showNotification(translations[currentLanguage].notifications.invalidApiKey);
          } else {
            showNotification(translations[currentLanguage].notifications.weatherError);
          }
          throw new Error(`Weather API error: ${response.status} ${response.statusText}`);
        }
        const data = await response.json();
        weatherCache[cacheKey] = { data, timestamp: Date.now() };
        return data;
      } catch (error) {
        console.error('Error fetching weather:', error);
        return null;
      }
    }

    // Fetch prayer times with enhanced accuracy
    async function fetchPrayerTimes(coordinates, date, city = null, country = null) {
      if (!checkNetwork()) {
        return generateOfflinePrayerTimes(coordinates);
      }
      
      const [lat, lon] = coordinates.split(',');
      const cacheKey = `${lat},${lon}|${date}|${city || ''}|${country || ''}`;
      
      if (prayerCache[cacheKey] && Date.now() - prayerCache[cacheKey].timestamp < 21600000) { // 6 hours
        return prayerCache[cacheKey].data;
      }

      try {
        let url = '';
        if (city && country) {
          // Try city-based API first for better accuracy
          url = `${PRAYER_CITY_API_URL}/${date}?city=${encodeURIComponent(city)}&country=${encodeURIComponent(country)}&method=2`;
        } else {
          // Fallback to coordinates-based API
          url = `${PRAYER_API_URL}/${date}?latitude=${lat}&longitude=${lon}&method=2`;
        }
        
        const response = await fetch(url, {
          method: 'GET',
          headers: {
            'Accept': 'application/json'
          }
        });
        
        if (!response.ok) {
          throw new Error(`Prayer API error: ${response.status}`);
        }
        
        const data = await response.json();
        
        if (data.code === 200 && data.data && data.data.timings) {
          const fullData = {
            timings: data.data.timings,
            date: data.data.date,
            meta: data.data.meta
          };
          prayerCache[cacheKey] = { data: fullData, timestamp: Date.now() };
          return fullData;
        } else {
          throw new Error('Invalid prayer data received');
        }
      } catch (error) {
        console.warn('Prayer API failed, generating calculated times:', error.message);
        return generateCalculatedPrayerTimes(coordinates, date);
      }
    }

    // Generate offline prayer times based on coordinates
    function generateOfflinePrayerTimes(coordinates) {
      const [lat, lon] = coordinates.split(',');
      const now = new Date();
      
      // Simple calculation based on sunrise/sunset (approximation)
      const sunrise = new Date(now);
      sunrise.setHours(6, 0, 0, 0);
      
      const sunset = new Date(now);
      sunset.setHours(18, 0, 0, 0);
      
      return {
        timings: {
          Fajr: '05:30',
          Sunrise: '06:00',
          Dhuhr: '12:30',
          Asr: '15:45',
          Sunset: '18:00',
          Maghrib: '18:05',
          Isha: '19:30',
          Imsak: '05:20',
          Midnight: '00:00'
        },
        date: {
          readable: now.toLocaleDateString(),
          timestamp: Math.floor(now.getTime() / 1000)
        },
        meta: {
          latitude: parseFloat(lat),
          longitude: parseFloat(lon),
          timezone: 'Local',
          method: { name: 'Offline Calculation' }
        }
      };
    }

    // Generate more accurate calculated prayer times
    function generateCalculatedPrayerTimes(coordinates, date) {
      const [lat, lon] = coordinates.split(',');
      const now = new Date(date.split('-').reverse().join('-'));
      
      // More sophisticated calculation (still simplified)
      const latitude = parseFloat(lat);
      const dayOfYear = Math.floor((now - new Date(now.getFullYear(), 0, 0)) / 86400000);
      
      // Calculate sunrise and sunset based on latitude and day of year
      const sunriseHour = 6 + Math.sin((dayOfYear - 81) * 2 * Math.PI / 365) * (latitude / 90) * 2;
      const sunsetHour = 18 - Math.sin((dayOfYear - 81) * 2 * Math.PI / 365) * (latitude / 90) * 2;
      
      const fajrTime = new Date(now);
      fajrTime.setHours(Math.floor(sunriseHour - 1.5), Math.floor((sunriseHour - 1.5) % 1 * 60), 0, 0);
      
      const dhuhrTime = new Date(now);
      dhuhrTime.setHours(12, 30, 0, 0);
      
      const asrTime = new Date(now);
      asrTime.setHours(Math.floor(sunsetHour - 2.5), Math.floor((sunsetHour - 2.5) % 1 * 60), 0, 0);
      
      const maghribTime = new Date(now);
      maghribTime.setHours(Math.floor(sunsetHour), Math.floor(sunsetHour % 1 * 60), 0, 0);
      
      const ishaTime = new Date(now);
      ishaTime.setHours(Math.floor(sunsetHour + 1.5), Math.floor((sunsetHour + 1.5) % 1 * 60), 0, 0);
      
      return {
        timings: {
          Fajr: fajrTime.toTimeString().substr(0, 5),
          Sunrise: new Date(now.setHours(Math.floor(sunriseHour), Math.floor(sunriseHour % 1 * 60), 0, 0)).toTimeString().substr(0, 5),
          Dhuhr: dhuhrTime.toTimeString().substr(0, 5),
          Asr: asrTime.toTimeString().substr(0, 5),
          Sunset: maghribTime.toTimeString().substr(0, 5),
          Maghrib: maghribTime.toTimeString().substr(0, 5),
          Isha: ishaTime.toTimeString().substr(0, 5),
          Imsak: new Date(fajrTime.getTime() - 10 * 60000).toTimeString().substr(0, 5),
          Midnight: '00:00'
        },
        date: {
          readable: now.toLocaleDateString(),
          timestamp: Math.floor(now.getTime() / 1000)
        },
        meta: {
          latitude: latitude,
          longitude: parseFloat(lon),
          timezone: 'Local',
          method: { name: 'Calculated Times' }
        }
      };
    }

    // Format weather data
    function formatWeather(data) {
      if (!data) {
        return {
          temp: translations[currentLanguage].weather === 'الطقس' ? 'غير متوفر' : 'Not available',
          condition: translations[currentLanguage].weather === 'الطقس' ? 'غير متوفر' : 'Not available',
          humidity: translations[currentLanguage].weather === 'الطقس' ? 'غير متوفر' : 'Not available',
          wind: translations[currentLanguage].weather === 'الطقس' ? 'غير متوفر' : 'Not available'
        };
      }
      return {
        temp: `${Math.round(data.main.temp)}°C`,
        condition: data.weather[0].description,
        humidity: `${data.main.humidity}%`,
        wind: `${data.wind.speed} ${currentLanguage === 'ar' ? 'م/ث' : 'm/s'}`
      };
    }

    // Format prayer times
    function formatPrayerTimes(data) {
      if (!data) {
        const notAvailable = translations[currentLanguage].prayerTimes === 'أوقات الصلاة' ? 'غير متوفر' : 'Not available';
        return {
          fajr: notAvailable,
          dhuhr: notAvailable,
          asr: notAvailable,
          maghrib: notAvailable,
          isha: notAvailable
        };
      }
      
      // Function to format time from 24h to 12h format
      function formatTime(time) {
        if (!time || time === 'N/A') return time;
        try {
          const [hours, minutes] = time.split(':');
          const hour24 = parseInt(hours);
          const hour12 = hour24 === 0 ? 12 : hour24 > 12 ? hour24 - 12 : hour24;
          const ampm = hour24 >= 12 ? 'PM' : 'AM';
          return `${hour12}:${minutes} ${ampm}`;
        } catch (e) {
          return time;
        }
      }
      
      return {
        fajr: formatTime(data.timings ? data.timings.Fajr : data.Fajr) || 'N/A',
        dhuhr: formatTime(data.timings ? data.timings.Dhuhr : data.Dhuhr) || 'N/A',
        asr: formatTime(data.timings ? data.timings.Asr : data.Asr) || 'N/A',
        maghrib: formatTime(data.timings ? data.timings.Maghrib : data.Maghrib) || 'N/A',
        isha: formatTime(data.timings ? data.timings.Isha : data.Isha) || 'N/A',
        fullData: data // Store full data for detailed view
      };
    }

    // Calculate next prayer and remaining time
    function getNextPrayer(prayerData, currentTime) {
      if (!prayerData || !prayerData.timings) return null;
      
      const prayers = [
        { name: 'الفجر', nameEn: 'Fajr', time: prayerData.timings.Fajr, icon: 'fas fa-sunrise' },
        { name: 'الظهر', nameEn: 'Dhuhr', time: prayerData.timings.Dhuhr, icon: 'fas fa-sun' },
        { name: 'العصر', nameEn: 'Asr', time: prayerData.timings.Asr, icon: 'fas fa-cloud-sun' },
        { name: 'المغرب', nameEn: 'Maghrib', time: prayerData.timings.Maghrib, icon: 'fas fa-sunset' },
        { name: 'العشاء', nameEn: 'Isha', time: prayerData.timings.Isha, icon: 'fas fa-moon' }
      ];
      
      const now = new Date(currentTime);
      const today = now.toDateString();
      
      for (let prayer of prayers) {
        const [hours, minutes] = prayer.time.split(':');
        const prayerTime = new Date(today);
        prayerTime.setHours(parseInt(hours), parseInt(minutes), 0, 0);
        
        if (prayerTime > now) {
          const timeDiff = prayerTime - now;
          const hoursLeft = Math.floor(timeDiff / (1000 * 60 * 60));
          const minutesLeft = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
          const secondsLeft = Math.floor((timeDiff % (1000 * 60)) / 1000);
          
          return {
            ...prayer,
            timeRemaining: { hours: hoursLeft, minutes: minutesLeft, seconds: secondsLeft },
            totalMinutesLeft: Math.floor(timeDiff / (1000 * 60)),
            progress: calculatePrayerProgress(prayers, prayer, now)
          };
        }
      }
      
      // If no prayer left today, return tomorrow's Fajr
      const tomorrowFajr = new Date(today);
      tomorrowFajr.setDate(tomorrowFajr.getDate() + 1);
      const [hours, minutes] = prayers[0].time.split(':');
      tomorrowFajr.setHours(parseInt(hours), parseInt(minutes), 0, 0);
      
      const timeDiff = tomorrowFajr - now;
      const hoursLeft = Math.floor(timeDiff / (1000 * 60 * 60));
      const minutesLeft = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
      const secondsLeft = Math.floor((timeDiff % (1000 * 60)) / 1000);
      
      return {
        ...prayers[0],
        timeRemaining: { hours: hoursLeft, minutes: minutesLeft, seconds: secondsLeft },
        totalMinutesLeft: Math.floor(timeDiff / (1000 * 60)),
        progress: 0
      };
    }

    // Calculate prayer progress throughout the day
    function calculatePrayerProgress(prayers, currentPrayer, now) {
      const currentIndex = prayers.findIndex(p => p.name === currentPrayer.name);
      if (currentIndex === 0) return 0;
      
      const previousPrayer = prayers[currentIndex - 1];
      const [prevHours, prevMinutes] = previousPrayer.time.split(':');
      const [currHours, currMinutes] = currentPrayer.time.split(':');
      
      const today = now.toDateString();
      const prevTime = new Date(today);
      prevTime.setHours(parseInt(prevHours), parseInt(prevMinutes), 0, 0);
      
      const currTime = new Date(today);
      currTime.setHours(parseInt(currHours), parseInt(currMinutes), 0, 0);
      
      const totalPeriod = currTime - prevTime;
      const elapsed = now - prevTime;
      
      return Math.max(0, Math.min(100, (elapsed / totalPeriod) * 100));
    }

    // Open prayer details modal
    function openPrayerModal(country, prayerData, weatherData) {
      const modal = document.getElementById('prayer-modal');
      const currentTime = DateTime.now().setZone(country.zone);
      
      // Update modal text elements for current language
      updatePrayerModalLanguage();
      
      // Set basic info
      document.getElementById('prayer-modal-title').textContent = 
        `${translations[currentLanguage].prayerDetails} - ${currentLanguage === 'ar' ? country.name : country.nameEn}`;
      document.getElementById('prayer-modal-flag').textContent = country.name.split(' ')[0];
      document.getElementById('prayer-city').textContent = currentLanguage === 'ar' ? country.capital : country.capitalEn;
      document.getElementById('prayer-country').textContent = currentLanguage === 'ar' ? country.name : country.nameEn;
      document.getElementById('prayer-full-date').textContent = currentTime.toFormat('yyyy/MM/dd - EEEE');
      
      const hijriDate = new Intl.DateTimeFormat(currentLanguage === 'ar' ? 'ar-SA' : 'en-US', {
        calendar: 'islamic',
        day: 'numeric',
        month: 'long',
        year: 'numeric',
        timeZone: country.zone
      }).format(new Date());
      document.getElementById('prayer-hijri-date').textContent = hijriDate;
      
      // Set next prayer info
      const nextPrayer = getNextPrayer(prayerData, currentTime.toJSDate());
      if (nextPrayer) {
        document.getElementById('next-prayer-name').textContent = 
          currentLanguage === 'ar' ? nextPrayer.name : nextPrayer.nameEn;
        document.getElementById('next-prayer-time').textContent = formatTime24to12(nextPrayer.time);
        document.getElementById('remaining-time').textContent = 
          `${nextPrayer.timeRemaining.hours.toString().padStart(2, '0')}:${nextPrayer.timeRemaining.minutes.toString().padStart(2, '0')}:${nextPrayer.timeRemaining.seconds.toString().padStart(2, '0')}`;
        document.getElementById('prayer-progress').style.width = `${nextPrayer.progress}%`;
      }
      
      // Populate detailed prayer times
      populatePrayerTimesList(prayerData, nextPrayer);
      
      // Populate location selectors
      populateLocationSelectors(country);
      
      modal.style.display = 'flex';
      
      // Start countdown timer
      startPrayerCountdown(prayerData, country.zone);
    }

    // Update prayer modal language elements
    function updatePrayerModalLanguage() {
      document.getElementById('prayer-city-label').textContent = translations[currentLanguage].capital + ':';
      document.getElementById('prayer-country-label').textContent = translations[currentLanguage].country + ':';
      document.getElementById('prayer-full-date-label').textContent = translations[currentLanguage].fullDate + ':';
      document.getElementById('prayer-hijri-date-label').textContent = translations[currentLanguage].hijriDate + ':';
      document.getElementById('next-prayer-header-text').textContent = translations[currentLanguage].nextPrayer;
      document.getElementById('remaining-label').textContent = translations[currentLanguage].timeRemaining + ':';
      document.getElementById('prayer-times-header-text').textContent = translations[currentLanguage].prayerTimes;
      document.getElementById('location-changer-header-text').textContent = translations[currentLanguage].changeLocation;
      document.getElementById('select-country-option').textContent = translations[currentLanguage].selectCountry;
      document.getElementById('select-city-option').textContent = translations[currentLanguage].selectCity;
      document.getElementById('update-times-text').textContent = translations[currentLanguage].updateTimes;
    }

    // Close prayer modal
    function closePrayerModal() {
      document.getElementById('prayer-modal').style.display = 'none';
      if (window.prayerCountdownInterval) {
        clearInterval(window.prayerCountdownInterval);
      }
    }

    // Format 24h time to 12h
    function formatTime24to12(time) {
      if (!time) return 'N/A';
      const [hours, minutes] = time.split(':');
      const hour24 = parseInt(hours);
      const hour12 = hour24 === 0 ? 12 : hour24 > 12 ? hour24 - 12 : hour24;
      const ampm = hour24 >= 12 ? 'PM' : 'AM';
      return `${hour12}:${minutes} ${ampm}`;
    }

    // Populate prayer times list in modal
    function populatePrayerTimesList(prayerData, nextPrayer) {
      const container = document.getElementById('prayer-times-list');
      if (!prayerData || !prayerData.timings) {
        container.innerHTML = '<div style="text-align: center; color: #ccc;">لا توجد بيانات متاحة</div>';
        return;
      }
      
      const prayers = [
        { name: 'الفجر', nameEn: 'Fajr', time: prayerData.timings.Fajr, icon: 'fas fa-sunrise' },
        { name: 'الظهر', nameEn: 'Dhuhr', time: prayerData.timings.Dhuhr, icon: 'fas fa-sun' },
        { name: 'العصر', nameEn: 'Asr', time: prayerData.timings.Asr, icon: 'fas fa-cloud-sun' },
        { name: 'المغرب', nameEn: 'Maghrib', time: prayerData.timings.Maghrib, icon: 'fas fa-sunset' },
        { name: 'العشاء', nameEn: 'Isha', time: prayerData.timings.Isha, icon: 'fas fa-moon' }
      ];
      
      container.innerHTML = prayers.map(prayer => `
        <div class="prayer-time-item ${nextPrayer && nextPrayer.name === prayer.name ? 'active' : ''}" 
             onclick="highlightPrayer(this)">
          <div class="prayer-name-detailed">
            <i class="${prayer.icon}"></i>
            ${currentLanguage === 'ar' ? prayer.name : prayer.nameEn}
          </div>
          <div class="prayer-time-detailed">${formatTime24to12(prayer.time)}</div>
        </div>
      `).join('');
    }

    // Highlight selected prayer
    function highlightPrayer(element) {
      document.querySelectorAll('.prayer-time-item').forEach(item => {
        item.classList.remove('active');
      });
      element.classList.add('active');
    }

    // Start prayer countdown timer
    function startPrayerCountdown(prayerData, timezone) {
      if (window.prayerCountdownInterval) {
        clearInterval(window.prayerCountdownInterval);
      }
      
      window.prayerCountdownInterval = setInterval(() => {
        const currentTime = DateTime.now().setZone(timezone);
        const nextPrayer = getNextPrayer(prayerData, currentTime.toJSDate());
        
        if (nextPrayer) {
          document.getElementById('remaining-time').textContent = 
            `${nextPrayer.timeRemaining.hours.toString().padStart(2, '0')}:${nextPrayer.timeRemaining.minutes.toString().padStart(2, '0')}:${nextPrayer.timeRemaining.seconds.toString().padStart(2, '0')}`;
          document.getElementById('prayer-progress').style.width = `${nextPrayer.progress}%`;
        }
      }, 1000);
    }

    // Populate location selectors
    function populateLocationSelectors(currentCountry) {
      const countrySelector = document.getElementById('country-selector');
      const citySelector = document.getElementById('city-selector');
      
      // Reset selectors
      countrySelector.innerHTML = '<option value="">اختر الدولة</option>';
      citySelector.innerHTML = '<option value="">اختر المدينة</option>';
      
      // Populate countries
      const uniqueCountries = [...new Set(countries.map(c => ({ 
        name: currentLanguage === 'ar' ? c.name : c.nameEn,
        nameEn: c.nameEn,
        capital: currentLanguage === 'ar' ? c.capital : c.capitalEn
      })))];
      
      uniqueCountries.forEach(country => {
        const option = document.createElement('option');
        option.value = country.nameEn;
        option.textContent = country.name;
        if (country.nameEn === currentCountry.nameEn) {
          option.selected = true;
        }
        countrySelector.appendChild(option);
      });
      
      // Populate cities for current country
      updateCityOptions();
    }

    // Update city options based on selected country
    function updateCityOptions() {
      const countrySelector = document.getElementById('country-selector');
      const citySelector = document.getElementById('city-selector');
      const selectedCountry = countrySelector.value;
      
      citySelector.innerHTML = '<option value="">اختر المدينة</option>';
      
      if (selectedCountry) {
        const country = countries.find(c => c.nameEn === selectedCountry);
        if (country) {
          const option = document.createElement('option');
          option.value = currentLanguage === 'ar' ? country.capital : country.capitalEn;
          option.textContent = currentLanguage === 'ar' ? country.capital : country.capitalEn;
          option.selected = true;
          citySelector.appendChild(option);
        }
      }
    }

    // Update prayer location
    function updatePrayerLocation() {
      // This function can be extended to handle city changes
      console.log('Location updated');
    }

    // Refresh prayer times with new location
    async function refreshPrayerTimes() {
      const countrySelector = document.getElementById('country-selector');
      const citySelector = document.getElementById('city-selector');
      
      const selectedCountryName = countrySelector.value;
      const selectedCity = citySelector.value;
      
      if (!selectedCountryName) {
        showNotification(currentLanguage === 'ar' ? 'يرجى اختيار الدولة أولاً' : 'Please select a country first');
        return;
      }
      
      const country = countries.find(c => c.nameEn === selectedCountryName);
      if (!country) return;
      
      try {
        const currentTime = DateTime.now().setZone(country.zone);
        const prayerDate = currentTime.toFormat('dd-MM-yyyy');
        const prayerData = await fetchPrayerTimes(country.coordinates, prayerDate, selectedCity, selectedCountryName);
        
        if (prayerData) {
          // Update modal with new data
          const nextPrayer = getNextPrayer(prayerData, currentTime.toJSDate());
          if (nextPrayer) {
            document.getElementById('next-prayer-name').textContent = 
              currentLanguage === 'ar' ? nextPrayer.name : nextPrayer.nameEn;
            document.getElementById('next-prayer-time').textContent = formatTime24to12(nextPrayer.time);
            document.getElementById('remaining-time').textContent = 
              `${nextPrayer.timeRemaining.hours.toString().padStart(2, '0')}:${nextPrayer.timeRemaining.minutes.toString().padStart(2, '0')}:${nextPrayer.timeRemaining.seconds.toString().padStart(2, '0')}`;
          }
          
          populatePrayerTimesList(prayerData, nextPrayer);
          startPrayerCountdown(prayerData, country.zone);
          
          showNotification(translations[currentLanguage].prayerTimesUpdated);
        }
      } catch (error) {
        showNotification(translations[currentLanguage].prayerUpdateFailed);
        console.error('Prayer refresh error:', error);
      }
    }

    // Show notification
    function showNotification(message) {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.classList.add('show');
      setTimeout(() => notification.classList.remove('show'), 3000);
    }

    // Update local clock
    function updateLocalClock() {
      const now = DateTime.local();
      const timeElement = document.getElementById('local-time');
      const dateElement = document.getElementById('local-date');
      const labelElement = document.getElementById('local-label');
      
      if (timeElement) {
        timeElement.textContent = now.toFormat('HH:mm:ss');
      }
      
      if (dateElement) {
        const dateFormat = currentLanguage === 'ar' ? 'yyyy/MM/dd' : 'dd/MM/yyyy';
        dateElement.textContent = now.toFormat(dateFormat);
      }
      
      if (labelElement) {
        labelElement.textContent = translations[currentLanguage].localClock;
      }
    }

    // Update statistics and continent counts
    function updateStats(filteredCountries) {
      const totalCountries = filteredCountries.length;
      let dayCountries = 0;
      let nightCountries = 0;
      const timezones = new Set();

      filteredCountries.forEach(country => {
        const now = DateTime.now().setZone(country.zone);
        const hour = now.hour;
        if (hour >= 6 && hour < 18) dayCountries++;
        else nightCountries++;
        timezones.add(country.zone);
      });

      document.getElementById('total-countries').textContent = totalCountries;
      document.getElementById('day-countries').textContent = dayCountries;
      document.getElementById('night-countries').textContent = nightCountries;
      document.getElementById('timezones-count').textContent = timezones.size;

      // Update continent counts
      updateContinentCounts();

      document.querySelector('#total-countries').parentElement.querySelector('.stat-label').textContent = translations[currentLanguage].totalCountries;
      document.querySelector('#day-countries').parentElement.querySelector('.stat-label').textContent = translations[currentLanguage].dayCountries;
      document.querySelector('#night-countries').parentElement.querySelector('.stat-label').textContent = translations[currentLanguage].nightCountries;
      document.querySelector('#timezones-count').parentElement.querySelector('.stat-label').textContent = translations[currentLanguage].timezones;
    }

    // Update continent counts
    function updateContinentCounts() {
      const continentCounts = {
        all: countries.length,
        asia: countries.filter(c => c.continent === 'asia').length,
        africa: countries.filter(c => c.continent === 'africa').length,
        europe: countries.filter(c => c.continent === 'europe').length,
        america: countries.filter(c => c.continent === 'america' || c.continent === 'americas').length,
        oceania: countries.filter(c => c.continent === 'oceania').length
      };

      Object.keys(continentCounts).forEach(continent => {
        const countElement = document.getElementById(`${continent}-count`);
        if (countElement) {
          countElement.textContent = `${continentCounts[continent]} ${translations[currentLanguage].countries || 'دولة'}`;
        }
      });
    }

    // Filter countries by search and continent
    let currentContinent = 'all';
    let currentSearch = '';

    function filterCountries() {
      currentSearch = document.getElementById('search-input').value.trim().toLowerCase();
      renderClocks();
    }

    function filterByContinent(continent) {
      currentContinent = continent;
      currentSearch = '';
      document.getElementById('search-input').value = '';
      
      // Update active button with smooth animation
      const buttons = document.querySelectorAll('.continent-btn');
      buttons.forEach(btn => {
        btn.classList.remove('active');
        btn.style.transform = 'scale(1)';
      });
      
      const activeButton = document.querySelector(`.continent-btn[onclick="filterByContinent('${continent}')"]`);
      activeButton.classList.add('active');
      activeButton.style.transform = 'scale(1.05)';
      
      // Add loading animation
      const container = document.getElementById('clocks');
      container.style.opacity = '0.5';
      container.style.transform = 'scale(0.95)';
      
      setTimeout(() => {
        renderClocks();
        container.style.opacity = '1';
        container.style.transform = 'scale(1)';
      }, 200);
      
      // Show notification for continent selection
      const continentNames = {
        all: translations[currentLanguage].all,
        asia: translations[currentLanguage].asia,
        africa: translations[currentLanguage].africa,
        europe: translations[currentLanguage].europe,
        america: translations[currentLanguage].america,
        oceania: translations[currentLanguage].oceania
      };
      
      showNotification(`${translations[currentLanguage].showingCountries || 'عرض دول'} ${continentNames[continent]}`);
    }

    // Check if element is in viewport
    function isInViewport(element) {
      const rect = element.getBoundingClientRect();
      return (
        rect.top >= 0 &&
        rect.left >= 0 &&
        rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
        rect.right <= (window.innerWidth || document.documentElement.clientWidth)
      );
    }

    // Render clocks (initial render with weather and prayer times)
    // Get dynamic time status with appropriate icon and description
    function getTimeStatus(hour, minute, currentLanguage) {
      const timeInMinutes = hour * 60 + minute;
      
      // Time periods in minutes from midnight
      const periods = {
        dawn: { start: 300, end: 360, icon: '🌅', ar: 'الفجر', en: 'Dawn' }, // 5:00-6:00
        sunrise: { start: 360, end: 480, icon: '🌄', ar: 'الشروق', en: 'Sunrise' }, // 6:00-8:00
        morning: { start: 480, end: 720, icon: '☀️', ar: 'الصباح', en: 'Morning' }, // 8:00-12:00
        noon: { start: 720, end: 780, icon: '🌞', ar: 'الزوال', en: 'Noon' }, // 12:00-13:00
        afternoon: { start: 780, end: 1020, icon: '🌤️', ar: 'العصر', en: 'Afternoon' }, // 13:00-17:00
        sunset: { start: 1020, end: 1140, icon: '🌇', ar: 'الغروب', en: 'Sunset' }, // 17:00-19:00
        dusk: { start: 1140, end: 1200, icon: '🌆', ar: 'المغرب', en: 'Dusk' }, // 19:00-20:00
        night: { start: 1200, end: 1440, icon: '🌙', ar: 'الليل', en: 'Night' }, // 20:00-24:00
        lateNight: { start: 0, end: 300, icon: '🌃', ar: 'آخر الليل', en: 'Late Night' } // 0:00-5:00
      };
      
      for (const [key, period] of Object.entries(periods)) {
        if (timeInMinutes >= period.start && timeInMinutes < period.end) {
          return {
            icon: period.icon,
            text: currentLanguage === 'ar' ? period.ar : period.en,
            period: key
          };
        }
      }
      
      // Default fallback
      return {
        icon: hour >= 6 && hour < 18 ? '☀️' : '🌙',
        text: currentLanguage === 'ar' ? (hour >= 6 && hour < 18 ? 'النهار' : 'الليل') : (hour >= 6 && hour < 18 ? 'Day' : 'Night'),
        period: hour >= 6 && hour < 18 ? 'day' : 'night'
      };
    }

    async function renderClocks() {
      const container = document.getElementById('clocks');
      container.innerHTML = '';
      const loading = document.getElementById('loading');
      loading.style.display = 'block';
      loading.textContent = translations[currentLanguage].loading;

      let filteredCountries = countries;

      if (currentContinent !== 'all') {
        filteredCountries = countries.filter(country => {
          let continentMatch = false;
          if (currentContinent === 'america') {
            continentMatch = (country.continent === 'america' || country.continent === 'americas');
          } else {
            continentMatch = country.continent.toLowerCase() === currentContinent.toLowerCase();
          }
          return continentMatch;
        });
      }

      if (currentSearch) {
        filteredCountries = filteredCountries.filter(country => {
          const searchFields = [
            currentLanguage === 'ar' ? country.name : country.nameEn,
            currentLanguage === 'ar' ? country.capital : country.capitalEn,
            currentLanguage === 'ar' ? country.currency : country.currencyEn,
            currentLanguage === 'ar' ? country.language : country.languageEn,
            currentLanguage === 'ar' ? country.description : country.descriptionEn
          ].map(field => field.toLowerCase());
          return searchFields.some(field => field.includes(currentSearch));
        });
      }

      updateStats(filteredCountries);

      if (filteredCountries.length === 0) {
        container.innerHTML = `<div class="no-results">${translations[currentLanguage].noResults}</div>`;
        loading.style.display = 'none';
        showNotification(translations[currentLanguage].notifications.noResults);
        return;
      }

      let index = 0;
      const addedCountries = new Set(); // Track added countries to prevent duplicates
      
      for (const country of filteredCountries) {
        // Skip if country already added
        if (addedCountries.has(country.nameEn)) {
          continue;
        }
        addedCountries.add(country.nameEn);
        
        const now = DateTime.now().setZone(country.zone);
        const offsetHours = now.offset / 60;
        const offsetLabel = `GMT${offsetHours >= 0 ? '+' : ''}${offsetHours}`;
        const hour = now.hour;
        const minute = now.minute;
        const timeStatus = getTimeStatus(hour, minute, currentLanguage);
        const hijriDate = new Intl.DateTimeFormat(currentLanguage === 'ar' ? 'ar-SA' : 'en-US', {
          calendar: 'islamic',
          day: 'numeric',
          month: 'long',
          year: 'numeric',
          timeZone: country.zone
        }).format(new Date());
        const weatherData = await fetchWeather(country.coordinates);
        const weather = formatWeather(weatherData);
        const prayerDate = now.toFormat('dd-MM-yyyy');
        const prayerData = await fetchPrayerTimes(
          country.coordinates, 
          prayerDate, 
          currentLanguage === 'ar' ? country.capital : country.capitalEn,
          currentLanguage === 'ar' ? country.name : country.nameEn
        );
        const prayers = formatPrayerTimes(prayerData);

        const clockBox = document.createElement('div');
        clockBox.classList.add('clock-box');
        clockBox.dataset.country = country.nameEn; // Store country identifier
        clockBox.style.boxShadow = `0 0 15px ${country.color}`;
        clockBox.style.animationDelay = `${index * 0.1}s`; // Staggered animation
        clockBox.innerHTML = `
          <div class="country-header">
            <div style="display: flex; align-items: center; gap: 15px;">
              ${country.flagCode || getFlagCode(country.nameEn) ? 
                `<span class="flag-icon fi fi-${country.flagCode || getFlagCode(country.nameEn)}"></span>` : 
                `<span class="country-flag">${country.name.split(' ')[0]}</span>`
              }
            </div>
            <h3 class="country-name">${currentLanguage === 'ar' ? country.name : country.nameEn}</h3>
            <div class="time-status-indicator">
              <span style="font-size: 1.2rem;">${timeStatus.icon}</span>
              <span style="font-size: 0.8rem; color: #FFD700; font-weight: 600;">${timeStatus.text}</span>
            </div>
          </div>
          <div class="location-info">
            <i class="fas fa-map-marker-alt"></i>
            ${translations[currentLanguage].capital}: ${currentLanguage === 'ar' ? country.capital : country.capitalEn}
          </div>
          <div class="clock-display" style="color: #fff; text-shadow: 0 0 25px ${country.color}, 0 0 45px ${country.color}, 0 2px 8px rgba(0,0,0,0.8); border-color: ${country.color};">
            <i class="fas fa-clock time-icon" style="color: ${country.color}; filter: drop-shadow(0 0 10px ${country.color});"></i>
            ${now.toFormat('hh:mm:ss a')}
          </div>
          <div class="time-info">
            <div class="time-item">
              <i class="fas fa-calendar-day time-icon"></i>
              ${currentLanguage === 'ar' ? 'الميلادي' : 'Gregorian'}: ${now.toFormat('dd/MM/yyyy')}
            </div>
            <div class="time-item">
              <i class="fas fa-moon time-icon"></i>
              ${currentLanguage === 'ar' ? 'الهجري' : 'Hijri'}: ${hijriDate}
            </div>
            <div class="time-item">
              <i class="fas fa-globe time-icon"></i>
              ${translations[currentLanguage].time}: ${offsetLabel}
            </div>
            <div class="time-item">
              <i class="fas fa-earth-americas time-icon"></i>
              ${translations[currentLanguage].continent}: ${translations[currentLanguage][country.continent] || country.continent}
            </div>
          </div>
          <div class="prayer-info" onclick="openPrayerModal(country, prayers.fullData, weather); event.stopPropagation();" style="cursor: pointer;">
            <div class="prayer-header">
              <i class="fas fa-mosque"></i>
              ${translations[currentLanguage].prayerTimes}
              <i class="fas fa-external-link-alt" style="font-size: 0.8rem; opacity: 0.7; margin-right: 5px;"></i>
            </div>
            <div class="prayer-times-grid">
              <div class="prayer-item" onclick="openPrayerModal(country, prayers.fullData, weather); event.stopPropagation();">
                <div class="prayer-name">
                  <i class="fas fa-sunrise"></i>
                  ${translations[currentLanguage].fajr}
                </div>
                <div class="prayer-time">${prayers.fajr}</div>
              </div>
              <div class="prayer-item" onclick="openPrayerModal(country, prayers.fullData, weather); event.stopPropagation();">
                <div class="prayer-name">
                  <i class="fas fa-sun"></i>
                  ${translations[currentLanguage].dhuhr}
                </div>
                <div class="prayer-time">${prayers.dhuhr}</div>
              </div>
              <div class="prayer-item" onclick="openPrayerModal(country, prayers.fullData, weather); event.stopPropagation();">
                <div class="prayer-name">
                  <i class="fas fa-cloud-sun"></i>
                  ${translations[currentLanguage].asr}
                </div>
                <div class="prayer-time">${prayers.asr}</div>
              </div>
              <div class="prayer-item" onclick="openPrayerModal(country, prayers.fullData, weather); event.stopPropagation();">
                <div class="prayer-name">
                  <i class="fas fa-sunset"></i>
                  ${translations[currentLanguage].maghrib}
                </div>
                <div class="prayer-time">${prayers.maghrib}</div>
              </div>
              <div class="prayer-item" onclick="openPrayerModal(country, prayers.fullData, weather); event.stopPropagation();">
                <div class="prayer-name">
                  <i class="fas fa-moon"></i>
                  ${translations[currentLanguage].isha}
                </div>
                <div class="prayer-time">${prayers.isha}</div>
              </div>
            </div>
            <div class="prayer-countdown-container" id="countdown-${country.nameEn.replace(/\s+/g, '')}">
              <div class="next-prayer-name">...</div>
              <div class="countdown-timer">--:--:--</div>
              <div class="countdown-progress">
                <div class="countdown-progress-bar" style="width: 0%;"></div>
              </div>
            </div>
          </div>
          <div class="weather-info">
            <i class="fas fa-cloud-sun weather-icon"></i>
            ${translations[currentLanguage].weather}: ${weather.temp} | ${weather.condition}
          </div>
        `;

        clockBox.addEventListener('click', () => openCountryModal(country, weather, prayers));
        container.appendChild(clockBox);
        
        // Update countdown for this specific box immediately
        setTimeout(() => {
          const countdownElement = clockBox.querySelector(`#countdown-${country.nameEn.replace(/\s+/g, '')}`);
          if (countdownElement) {
            const now = DateTime.now().setZone(country.zone);
            const nextPrayer = getNextPrayer(prayerData, now.toJSDate());
            
            if (nextPrayer) {
              const prayerNameElement = countdownElement.querySelector('.next-prayer-name');
              if (prayerNameElement) {
                prayerNameElement.textContent = currentLanguage === 'ar' ? nextPrayer.name : nextPrayer.nameEn;
              }
              
              const timerElement = countdownElement.querySelector('.countdown-timer');
              if (timerElement) {
                timerElement.textContent = 
                  `${nextPrayer.timeRemaining.hours.toString().padStart(2, '0')}:${nextPrayer.timeRemaining.minutes.toString().padStart(2, '0')}:${nextPrayer.timeRemaining.seconds.toString().padStart(2, '0')}`;
              }
              
              const progressElement = countdownElement.querySelector('.countdown-progress-bar');
              if (progressElement) {
                progressElement.style.width = `${nextPrayer.progress}%`;
              }
            }
          }
        }, 100);
        
        index++;
      }

      loading.style.display = 'none';
    }

    // Update clocks dynamically (only visible clocks)
    function updateClocks() {
      const clockBoxes = document.querySelectorAll('.clock-box');
      clockBoxes.forEach(box => {
        if (!isInViewport(box)) return; // Skip non-visible clocks
        const countryName = box.dataset.country;
        const country = countries.find(c => c.nameEn === countryName);
        if (!country) return;

        const now = DateTime.now().setZone(country.zone);
        const hour = now.hour;
        const minute = now.minute;
        const timeStatus = getTimeStatus(hour, minute, currentLanguage);
        const hijriDate = new Intl.DateTimeFormat(currentLanguage === 'ar' ? 'ar-SA' : 'en-US', {
          calendar: 'islamic',
          day: 'numeric',
          month: 'long',
          year: 'numeric',
          timeZone: country.zone
        }).format(new Date());
        const offsetHours = now.offset / 60;
        const offsetLabel = `GMT${offsetHours >= 0 ? '+' : ''}${offsetHours}`;

        box.querySelector('.clock-display').textContent = now.toFormat('hh:mm:ss a');
        
        // Update time status indicator
        const timeStatusElement = box.querySelector('.time-status-indicator');
        if (timeStatusElement) {
          timeStatusElement.innerHTML = `
            <span style="font-size: 1.2rem;">${timeStatus.icon}</span>
            <span style="font-size: 0.8rem; color: #FFD700; font-weight: 600;">${timeStatus.text}</span>
          `;
        }
        
        const timeInfo = box.querySelector('.time-info');
        timeInfo.innerHTML = `
          <div class="time-item">
            <i class="fas fa-calendar-day time-icon"></i>
            ${currentLanguage === 'ar' ? 'الميلادي' : 'Gregorian'}: ${now.toFormat('dd/MM/yyyy')}
          </div>
          <div class="time-item">
            <i class="fas fa-moon time-icon"></i>
            ${currentLanguage === 'ar' ? 'الهجري' : 'Hijri'}: ${hijriDate}
          </div>
          <div class="time-item">
            <i class="fas fa-globe time-icon"></i>
            ${translations[currentLanguage].time}: ${offsetLabel}
          </div>
          <div class="time-item">
            <i class="fas fa-earth-americas time-icon"></i>
            ${translations[currentLanguage].continent}: ${translations[currentLanguage][country.continent] || country.continent}
          </div>
        `;
      });
    }

    // Get next prayer from prayer times object
    function getNextPrayerFromTimes(prayerTimes, currentTime) {
      const now = new Date(currentTime);
      const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
      
      const prayers = [
        { 
          key: 'Fajr', 
          time: prayerTimes.Fajr, 
          name: 'الفجر', 
          nameEn: 'Fajr' 
        },
        { 
          key: 'Dhuhr', 
          time: prayerTimes.Dhuhr, 
          name: 'الظهر', 
          nameEn: 'Dhuhr' 
        },
        { 
          key: 'Asr', 
          time: prayerTimes.Asr, 
          name: 'العصر', 
          nameEn: 'Asr' 
        },
        { 
          key: 'Maghrib', 
          time: prayerTimes.Maghrib, 
          name: 'المغرب', 
          nameEn: 'Maghrib' 
        },
        { 
          key: 'Isha', 
          time: prayerTimes.Isha, 
          name: 'العشاء', 
          nameEn: 'Isha' 
        }
      ];

      // Convert prayer times to Date objects
      const prayerDates = prayers.map(prayer => {
        if (!prayer.time || prayer.time === 'N/A') return null;
        
        const [time, period] = prayer.time.split(' ');
        const [hours, minutes] = time.split(':').map(Number);
        
        let hour24 = hours;
        if (period && period.toLowerCase() === 'pm' && hours !== 12) {
          hour24 += 12;
        } else if (period && period.toLowerCase() === 'am' && hours === 12) {
          hour24 = 0;
        }
        
        const prayerDate = new Date(today);
        prayerDate.setHours(hour24, minutes, 0, 0);
        
        return {
          ...prayer,
          dateTime: prayerDate
        };
      }).filter(Boolean);

      // Find next prayer
      const nextPrayers = prayerDates.filter(prayer => prayer.dateTime > now);
      let nextPrayer;
      
      if (nextPrayers.length > 0) {
        nextPrayer = nextPrayers[0];
      } else {
        // If no prayers left today, next is Fajr tomorrow
        const tomorrowFajr = prayerDates.find(p => p.key === 'Fajr');
        if (tomorrowFajr) {
          const tomorrow = new Date(today);
          tomorrow.setDate(tomorrow.getDate() + 1);
          tomorrow.setHours(tomorrowFajr.dateTime.getHours(), tomorrowFajr.dateTime.getMinutes(), 0, 0);
          
          nextPrayer = {
            ...tomorrowFajr,
            dateTime: tomorrow
          };
        }
      }

      if (!nextPrayer) return null;

      // Calculate time remaining
      const timeDiff = nextPrayer.dateTime - now;
      const hours = Math.floor(timeDiff / (1000 * 60 * 60));
      const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);

      // Calculate progress (simplified)
      const totalMsInDay = 24 * 60 * 60 * 1000;
      const msUntilPrayer = timeDiff;
      const progress = Math.max(0, Math.min(100, ((totalMsInDay - msUntilPrayer) / totalMsInDay) * 100));

      return {
        ...nextPrayer,
        timeRemaining: { hours, minutes, seconds },
        progress: Math.round(progress)
      };
    }

    // Update prayer countdown in cards
    function updatePrayerCountdowns() {
      const clockBoxes = document.querySelectorAll('.clock-box');
      clockBoxes.forEach(box => {
        if (!isInViewport(box)) return; // Skip non-visible clocks
        const countryName = box.dataset.country;
        const country = countries.find(c => c.nameEn === countryName);
        if (!country) return;

        const countdownElement = box.querySelector(`#countdown-${country.nameEn.replace(/\s+/g, '')}`);
        if (!countdownElement) return;

        const now = DateTime.now().setZone(country.zone);
        const prayerDate = now.toFormat('dd-MM-yyyy');
        
        // Get cached prayer data
        const cacheKey = `${country.coordinates}|${prayerDate}|${currentLanguage === 'ar' ? country.capital : country.capitalEn}|${currentLanguage === 'ar' ? country.name : country.nameEn}`;
        const cachedPrayer = prayerCache[cacheKey];
        
        if (cachedPrayer && cachedPrayer.data) {
          const nextPrayer = getNextPrayer(cachedPrayer.data, now.toJSDate());
          
          if (nextPrayer) {
            // Update next prayer name
            const prayerNameElement = countdownElement.querySelector('.next-prayer-name');
            if (prayerNameElement) {
              prayerNameElement.textContent = currentLanguage === 'ar' ? nextPrayer.name : nextPrayer.nameEn;
            }
            
            // Update countdown timer
            const timerElement = countdownElement.querySelector('.countdown-timer');
            if (timerElement) {
              timerElement.textContent = 
                `${nextPrayer.timeRemaining.hours.toString().padStart(2, '0')}:${nextPrayer.timeRemaining.minutes.toString().padStart(2, '0')}:${nextPrayer.timeRemaining.seconds.toString().padStart(2, '0')}`;
            }
            
            // Update progress bar
            const progressElement = countdownElement.querySelector('.countdown-progress-bar');
            if (progressElement) {
              progressElement.style.width = `${nextPrayer.progress}%`;
            }
          }
        } else {
          // If no cached prayer data, try to get it from existing prayer items in the same box
          const prayerItems = box.querySelectorAll('.prayer-item');
          if (prayerItems.length > 0) {
            const prayerTimes = {};
            prayerItems.forEach(item => {
              const nameElement = item.querySelector('.prayer-name');
              const timeElement = item.querySelector('.prayer-time');
              if (nameElement && timeElement) {
                const prayerName = nameElement.textContent.trim();
                const prayerTime = timeElement.textContent.trim();
                
                // Map prayer names to standard keys
                if (prayerName.includes('الفجر') || prayerName.includes('Fajr')) {
                  prayerTimes.Fajr = prayerTime;
                } else if (prayerName.includes('الظهر') || prayerName.includes('Dhuhr')) {
                  prayerTimes.Dhuhr = prayerTime;
                } else if (prayerName.includes('العصر') || prayerName.includes('Asr')) {
                  prayerTimes.Asr = prayerTime;
                } else if (prayerName.includes('المغرب') || prayerName.includes('Maghrib')) {
                  prayerTimes.Maghrib = prayerTime;
                } else if (prayerName.includes('العشاء') || prayerName.includes('Isha')) {
                  prayerTimes.Isha = prayerTime;
                }
              }
            });
            
            if (Object.keys(prayerTimes).length > 0) {
              const nextPrayer = getNextPrayerFromTimes(prayerTimes, now.toJSDate());
              
              if (nextPrayer) {
                // Update next prayer name
                const prayerNameElement = countdownElement.querySelector('.next-prayer-name');
                if (prayerNameElement) {
                  prayerNameElement.textContent = currentLanguage === 'ar' ? nextPrayer.name : nextPrayer.nameEn;
                }
                
                // Update countdown timer
                const timerElement = countdownElement.querySelector('.countdown-timer');
                if (timerElement) {
                  timerElement.textContent = 
                    `${nextPrayer.timeRemaining.hours.toString().padStart(2, '0')}:${nextPrayer.timeRemaining.minutes.toString().padStart(2, '0')}:${nextPrayer.timeRemaining.seconds.toString().padStart(2, '0')}`;
                }
                
                // Update progress bar
                const progressElement = countdownElement.querySelector('.countdown-progress-bar');
                if (progressElement) {
                  progressElement.style.width = `${nextPrayer.progress}%`;
                }
              }
            }
          }
        }
      });
    }

    // Open country modal
    function openCountryModal(country, weather, prayers) {
      const modal = document.getElementById('country-modal');
      document.getElementById('modal-country-name').textContent = currentLanguage === 'ar' ? country.name : country.nameEn;
      document.getElementById('modal-country-flag').textContent = country.name.split(' ')[0];
      const details = document.getElementById('country-details');
      details.innerHTML = `
        <div class="detail-item">
          <div class="detail-label">${translations[currentLanguage].description}</div>
          <div class="detail-value">${currentLanguage === 'ar' ? country.description : country.descriptionEn}</div>
        </div>
        <div class="detail-item">
          <div class="detail-label">${translations[currentLanguage].leader}</div>
          <div class="detail-value">${currentLanguage === 'ar' ? country.leader : country.leaderEn}</div>
        </div>
        <div class="detail-item">
          <div class="detail-label">${translations[currentLanguage].population}</div>
          <div class="detail-value">${currentLanguage === 'ar' ? country.population : country.populationEn}</div>
        </div>
        <div class="detail-item">
          <div class="detail-label">${translations[currentLanguage].capital}</div>
          <div class="detail-value">${currentLanguage === 'ar' ? country.capital : country.capitalEn}</div>
        </div>
        <div class="detail-item">
          <div class="detail-label">${translations[currentLanguage].timezone}</div>
          <div class="detail-value">${country.zone}</div>
        </div>
        <div class="detail-item">
          <div class="detail-label">${translations[currentLanguage].coordinates}</div>
          <div class="detail-value">${country.coordinates}</div>
        </div>
        <div class="detail-item">
          <div class="detail-label">${translations[currentLanguage].area}</div>
          <div class="detail-value">${currentLanguage === 'ar' ? country.area : country.areaEn}</div>
        </div>
        <div class="detail-item">
          <div class="detail-label">${translations[currentLanguage].currency}</div>
          <div class="detail-value">${currentLanguage === 'ar' ? country.currency : country.currencyEn}</div>
        </div>
        <div class="detail-item">
          <div class="detail-label">${translations[currentLanguage].language}</div>
          <div class="detail-value">${currentLanguage === 'ar' ? country.language : country.languageEn}</div>
        </div>
        <div class="detail-item">
          <div class="detail-label">${translations[currentLanguage].weatherTemp}</div>
          <div class="detail-value">${weather.temp}</div>
        </div>
        <div class="detail-item">
          <div class="detail-label">${translations[currentLanguage].weatherCondition}</div>
          <div class="detail-value">${weather.condition}</div>
        </div>
        <div class="detail-item">
          <div class="detail-label">${translations[currentLanguage].weatherHumidity}</div>
          <div class="detail-value">${weather.humidity}</div>
        </div>
        <div class="detail-item">
          <div class="detail-label">${translations[currentLanguage].weatherWind}</div>
          <div class="detail-value">${weather.wind}</div>
        </div>
        <div class="detail-item">
          <div class="detail-label">${translations[currentLanguage].prayerTimes}</div>
          <div class="detail-value">
            ${translations[currentLanguage].fajr}: ${prayers.fajr}<br>
            ${translations[currentLanguage].dhuhr}: ${prayers.dhuhr}<br>
            ${translations[currentLanguage].asr}: ${prayers.asr}<br>
            ${translations[currentLanguage].maghrib}: ${prayers.maghrib}<br>
            ${translations[currentLanguage].isha}: ${prayers.isha}
          </div>
        </div>
      `;
      modal.style.display = 'flex';
    }

    // Close modal
    function closeModal() {
      document.getElementById('country-modal').style.display = 'none';
      document.getElementById('about-modal').style.display = 'none';
    }

    // Open about modal
    function openAboutModal() {
      const modal = document.getElementById('about-modal');
      document.querySelector('#about-modal .modal-title').textContent = translations[currentLanguage].aboutTitle;
      toggleAboutLang(currentLanguage);
      modal.style.display = 'flex';
    }

    // Toggle about modal language
    function toggleAboutLang(lang) {
      const arContent = document.getElementById('about-content-ar');
      const enContent = document.getElementById('about-content-en');
      if (lang === 'ar') {
        arContent.style.display = 'block';
        enContent.style.display = 'none';
        document.querySelector('#about-content-ar .lang-switch button').textContent = '🌐 English Version';
      } else {
        arContent.style.display = 'none';
        enContent.style.display = 'block';
        document.querySelector('#about-content-en .lang-switch button').textContent = '🌐 النسخة العربية';
      }
    }

    // Toggle fullscreen
    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen().then(() => {
          showNotification(translations[currentLanguage].notifications.fullscreenOn);
        }).catch(() => {
          showNotification(translations[currentLanguage].notifications.fullscreenError);
        });
      } else {
        document.exitFullscreen().then(() => {
          showNotification(translations[currentLanguage].notifications.fullscreenOff);
        });
      }
    }

    // Export data as CSV
    function exportData() {
      const headers = [
        translations[currentLanguage].name,
        translations[currentLanguage].leader,
        translations[currentLanguage].population,
        translations[currentLanguage].timezone,
        translations[currentLanguage].capital,
        translations[currentLanguage].continent,
        translations[currentLanguage].coordinates,
        translations[currentLanguage].area,
        translations[currentLanguage].currency,
        translations[currentLanguage].language,
        translations[currentLanguage].description,
        translations[currentLanguage].prayerTimes
      ];
      const rows = countries.map(country => {
        const prayerDate = DateTime.now().toFormat('dd-MM-yyyy');
        const prayerCacheKey = `${country.coordinates}|${prayerDate}`;
        const prayers = prayerCache[prayerCacheKey]?.data || {
          Fajr: 'N/A', Dhuhr: 'N/A', Asr: 'N/A', Maghrib: 'N/A', Isha: 'N/A'
        };
        return [
          currentLanguage === 'ar' ? country.name : country.nameEn,
          currentLanguage === 'ar' ? country.leader : country.leaderEn,
          currentLanguage === 'ar' ? country.population : country.populationEn,
          country.zone,
          currentLanguage === 'ar' ? country.capital : country.capitalEn,
          translations[currentLanguage][country.continent],
          country.coordinates,
          currentLanguage === 'ar' ? country.area : country.areaEn,
          currentLanguage === 'ar' ? country.currency : country.currencyEn,
          currentLanguage === 'ar' ? country.language : country.languageEn,
          currentLanguage === 'ar' ? country.description : country.descriptionEn,
          `${translations[currentLanguage].fajr}: ${prayers.Fajr}, ` +
          `${translations[currentLanguage].dhuhr}: ${prayers.Dhuhr}, ` +
          `${translations[currentLanguage].asr}: ${prayers.Asr}, ` +
          `${translations[currentLanguage].maghrib}: ${prayers.Maghrib}, ` +
          `${translations[currentLanguage].isha}: ${prayers.Isha}`
        ].map(field => `"${field.replace(/"/g, '""')}"`).join(',');
      });

      const csv = [headers.join(','), ...rows].join('\n');
      const blob = new Blob([new Uint8Array([0xEF, 0xBB, 0xBF]), csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'world_clocks_data.csv';
      a.click();
      URL.revokeObjectURL(url);
      showNotification(translations[currentLanguage].notifications.dataExported);
    }

    // Refresh clocks
    function refreshClocks() {
      weatherCache = {};
      prayerCache = {};
      renderClocks();
      showNotification(translations[currentLanguage].notifications.clocksRefreshed);
    }

    // Toggle language
    function toggleLanguage() {
      currentLanguage = currentLanguage === 'ar' ? 'en' : 'ar';
      document.documentElement.lang = currentLanguage;
      document.documentElement.dir = currentLanguage === 'ar' ? 'rtl' : 'ltr';
      document.querySelector('.project-title').innerHTML = `
        <i class="fas fa-globe-americas project-icon"></i>
        ${translations[currentLanguage].title}
      `;
      document.querySelector('.subtitle').textContent = translations[currentLanguage].subtitle;
      document.querySelector('.search-input').placeholder = translations[currentLanguage].searchPlaceholder;
      document.querySelector('.copyright p').textContent = translations[currentLanguage].copyright;
      
      // Update continent buttons with new structure
      document.querySelectorAll('.continent-btn').forEach((btn, index) => {
        const continents = ['all', 'asia', 'africa', 'europe', 'america', 'oceania'];
        const continentNameElement = btn.querySelector('.continent-name');
        if (continentNameElement) {
          continentNameElement.textContent = translations[currentLanguage][continents[index]];
        }
      });
      
      document.querySelectorAll('.btn').forEach((btn, index) => {
        const btnKeys = ['aboutBtn', 'fullscreenBtn', 'exportBtn', 'refreshBtn', 'langBtn'];
        btn.innerHTML = translations[currentLanguage][btnKeys[index]];
      });
      
      renderClocks();
      updateLocalClock();
      if (document.getElementById('about-modal').style.display === 'flex') {
        toggleAboutLang(currentLanguage);
        document.querySelector('#about-modal .modal-title').textContent = translations[currentLanguage].aboutTitle;
      }
      showNotification(translations[currentLanguage].notifications.langChanged);
    }

    // Function to add missing flag codes to countries
    function addMissingFlagCodes() {
      countries.forEach(country => {
        if (!country.flagCode) {
          country.flagCode = getFlagCode(country.nameEn);
        }
      });
    }

    // Initialize
    function init() {
      if (!window.luxon) {
        showNotification('فشل تحميل مكتبة Luxon. تحقق من الاتصال بالإنترنت.');
        return;
      }
      addMissingFlagCodes(); // Add missing flag codes
      updateLocalClock();
      setInterval(updateLocalClock, 1000);
      renderClocks();
      setInterval(updateClocks, 1000); // Update clocks every second
      setInterval(updatePrayerCountdowns, 1000); // Update prayer countdowns every second
    }

    init();
  </script>
</body>
</html>